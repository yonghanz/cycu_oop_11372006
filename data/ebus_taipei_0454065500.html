
<!DOCTYPE html>
<!--[if lt IE 8]> <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9 oldie" lang="en"> <![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<head>
    <script>
        var SitePath = '/';
    </script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="format-detection" content="telephone=no" />
    <title>大臺北公車</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=4, minimum-scale=0.5, user-scalable=yes">

    <link rel="stylesheet" href="/styles/html5reset-1.6.1.min.css" />
    <link href="/web/css?v=sRaS4eVeEUiSbsmDNyPCQX6_bGwBuAfoNm1EFEuVJsQ1" rel="stylesheet"/>

    <link rel="stylesheet" type="text/css" media="screen and (max-width:768px)" href="/pad/css?v=-VA-V4vm8GvG2qYKGZXk3Qi1cWfbcBMLSWm5uytMv8A1">

    <link rel="stylesheet" type="text/css" media="screen and (max-width:480px)" href="/phone/css?v=tNT4bc9cbLmN5rC7jOPAfHE2gTc_N47eqhKenWJ5sQk1">

    
    
    
    <link href="/sweetAlert/css?v=Q7l7a83fZdl7_6jt13P3HsHoLWvbYv1YpqCreuQlPuQ1" rel="stylesheet"/>

    <script src="/sweetAlert2/css?v=fJb18S8FvSIfJsXWl8pwQn02lsvJyZVA2V9a_xRxskI1"></script>

    
    <link href="/CustomScrollbar/css?v=cTpwHD23PH7gbg8rY79THNO6JzhoW_RwUaR7zeCFjOI1" rel="stylesheet"/>

    <link href="/toastr/css?v=bUMX5PdhipTCZJVvmdqKc60mrvySkxFZQUqXQRjL8kI1" rel="stylesheet"/>

    <link href="/simpleRouteMap/css?v=eN0OvNIAPpKksgTz7sjIy-B4L9bOLNcs7ckhBHKid1Q1" rel="stylesheet"/>




    <script>
        var viccknCulture = null;
        function Mybus(event, _elem) {
            event.preventDefault();
            var islogin = jQuery('a.login-link');
            if (islogin.length>0) {
                //
                alert(i18n._('Please Login'));
            } else {
                window.location.replace(_elem.href);
            }
        }
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>

    <script src="/bundles/jquery?v=q7mEgdXrcJJy32YRlrFef8zHiCgDFSUdNzefyodQYIQ1"></script>

    

    

</head>
<body class="tebus">
    <!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or
    <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->
    <a href="javascript:void(0);" class="tebus-up web-none" title="置頂"></a>  
    <!-- being header web-->
    <header class="tebus-main-header-c  pad-none">
        <div class="teBUS-main-header">
            <div class="teBUS-logo-c">
                <a href="/Dybus.aspx" class="teBUS-logo" title="首頁"></a>
                <p class="teBUS-visite">到訪人數<span class="teBUS-visite-number">231492963</span></p>
            </div>
            <nav class="teBUS-nav-language-marquee-c">
                <ul class="teBUS-nav-language-c">
                    
                            <li class="pad-none">
                               
                            <a class="nav-language-link" href="https://e-bus.tpc.gov.tw" target="_blank">無障礙 </a> /
                            </li>


                    <li><a class="nav-language-link" href="/Home/SetCulture?culture=zh-TW&amp;returnURL=%2FRoute%2FStopsOfRoute%3Frouteid%3D0454065500">中文</a> / </li>
                        <li><a class="nav-language-link" href="/Home/SetCulture?culture=en&amp;returnURL=%2FRoute%2FStopsOfRoute%3Frouteid%3D0454065500">English</a> / </li>
                    <li><a class="nav-language-link login-link" href="javascript:void(0);" alt="會員登入">會員登入</a>/</li>
                    <li><a href="/MyBus" class="nav-language-link" onclick="Mybus(event, this)">我的公車</a></li>
                    <li>/<a class="nav-language-link" href="https://www.pto.gov.taipei/Questionnaire_Content.aspx?n=63FD5A257079935F&s=E4505D512A861F41&sms=7F78FC0503254E9A" target="_blank">滿意度調查</a> </li>

                      
                    
                </ul>
                <input id="marqueeSpeed" name="marqueeSpeed" type="hidden" value="6" />
                
                <marquee scrollamount="6"><div class='teBUS-marquee2' ></div></marquee>
            </nav>
        </div>
    </header>
    <!-- end header web-->
    <!-- being header pad-->
    <header class="teBUS-pad-main-header-c web-none">

        <div class="teBUS-pad-main-nav-icon">
            <ul class="teBUS-nav-main-language-pad-c">
                <li class="nav-main-language-title">語言</li>

                <li>
                    <span class="label-checkbox-language-c">

<form action="/Home/SetCulture?returnURL=%2FRoute%2FStopsOfRoute%3Frouteid%3D0454065500" id="SetCultureForm" method="get" role="form">                            <label class="label-radio label-checkbox-language">
                                <input checked="checked" class="radio fast-search-radio" id="culture" name="culture" type="radio" value="zh-TW" />
                                中文
                            </label>
                            <label class="label-radio label-checkbox-language">
                                <input class="radio fast-search-radio" id="culture" name="culture" type="radio" value="en" />
                                English
                            </label>
<input id="returnURL" name="returnURL" type="hidden" value="/Route/StopsOfRoute?routeid=0454065500" /></form>                    </span>
                </li>
                <li class="nav-main-language-title">功能選單</li>
                
                <li><a href="/ebus" class="main-nav-pad">公車動態</a></li>
                <li><a href="/Query/BusRoute" class="main-nav-pad">GIS動態</a></li>
                <li><a href="/Transfer/TransPlan" class="main-nav-pad">轉乘規劃</a></li>
                
                    <li><a href="https://pda.5284.gov.taipei" class="main-nav-pad">PDA</a></li>
                    <li><a href="/projectbus" class="main-nav-pad">專區</a></li>
                        <li><a href="/RelatedLinks" class="main-nav-pad">相關連結</a></li>
                        <li></li>
                
            </ul>
        </div>
        <div class="teBUS-main-nav-pad-c">
            <a href=javascript:history.back(); class="teBUS-pad-main-come-back-icon" title="回上一頁"></a>
            <a href="/Dybus.aspx" class="teBUS-logo-pad" title="logo" alt="logo"></a>
            <a href=javascript:toggleMenu(); class="teBUS-pad-main-nav-icon-c" title=""></a>
        </div>
    </header>
    <!-- end header pad-->
    <!-- being content -->
    <div class="teBUS-main-container">

        <!--begin main list-->
        <div class="teBUS-main-nav-c pad-none">

    <ul class="teBUS-main-nav-pool">
        <li class="main-nav-typt"><a href="javascript:void(0)" onclick="history.go(-1)" class="main-nav" title="回上一頁"><img src="/images/nav_011.svg" width="100%" alt="回上一頁"></a></li>
       
            <li class="main-nav-typt"><a href="/ebus" class="main-nav"><img src="/images/nav_013.svg" width="100%" alt="公車動態">公車動態</a></li>
        <li class="main-nav-typt"><a href="/Query/BusRoute" class="main-nav" title="GIS動態"><img src="/images/nav_002.svg" width="100%" alt="GIS動態">GIS動態</a></li>
        <li class="main-nav-typt"><a href="/Transfer/TransPlan" class="main-nav" title="轉乘規劃"><img src="/images/nav_003.svg" width="100%" alt="轉乘規劃">轉乘規劃</a></li>

       
        <li class="main-nav-typt"><a href="https://pda.5284.gov.taipei" target="_blank" class="main-nav"><img src="/images/atk-PDA.svg" width="100%" alt="PDA">PDA</a></li>
        <li class="main-nav-typt">
            <a href="/Query/NearBus" class="main-nav"><img src="/images/atk-nearbystop.svg" width="100%" alt="附近站牌">附近站牌</a>
        </li>
        

        
        <li class="main-nav-typt"><a href="/RelatedLinks" class="main-nav" title="相關連結"><img src="/images/nav_008.svg" width="100%" alt="相關連結">相關連結</a></li>
        
        <li class="main-nav-typt"><a href="/projectbus" class="main-nav" title="專區"><img src="/images/nav_012.svg" width="100%" alt="專區">專區</a></li>

        
    </ul>
</div>
<div id="Login_DL" class="teBus-dialog-c" style="display:none">
    <form id="LoginForm">
        <div class="teBus-dialog login-c">
            <h1 class="teBus-dialog-h1"><span class="teBus-dialog-title-img login-img" alt=" "></span>會員登入</h1>
            <span class="teBus-dialog-close-icon-c"><a href='javascript: void(0);' class="teBus-dialog-close-icon" title="關閉" alt="關閉"></a></span>

            <ul class="teBus-dialog-ul">
                <li class="teBus-dialog-li">
                    
                </li>
                <li class="teBus-dialog-li">
                    <span class="teBus-dialog-li-title">電子郵件</span>
                    <label><input autocomplete="off" class="teBus-dialog-input-text-one" data-val="true" data-val-email="電子郵件欄位不是有效的電子郵件地址。" data-val-required="電子郵件是必要項" id="Email" name="Email" type="text" value="" /></label>
                    <span class="field-validation-valid teBus-diolag-note" data-valmsg-for="Email" data-valmsg-replace="true"></span>
                </li>
                <li class="teBus-dialog-li">
                    <span class="teBus-dialog-li-title">密碼</span>
                    <label><input autocomplete="off" class="teBus-dialog-input-text-one" data-val="true" data-val-required="密碼是必要項" id="Password" name="Password" type="password" /></label>
                    <span class="field-validation-valid teBus-diolag-note" data-valmsg-for="Password" data-valmsg-replace="true"></span>
                </li>
                <li class="teBus-dialog-li" style=" margin:0 auto;width: 50%;">
                    

                   
                        <div class="h-captcha" data-sitekey="e57803e5-35a9-40c1-92dc-889ae1a81fc8"></div>
                        <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
                    
                </li>

                <li>
                    <label class="teBus-login-dialog-enter-c">
                        <input class="teBus-dialog-checkbox-one login-enter-checkbox" data-val="true" data-val-required="記住我 欄位是必要項。" id="RememberMe" name="RememberMe" type="checkbox" value="true" /><input name="RememberMe" type="hidden" value="false" />
                        <label for="RememberMe">記住我</label>
                        
                        <a href="javascript:void(0)" class="teBus-dialog-submit login-enter-submit">登入</a>
                        <!--input type="submit" value="登入" class="teBus-dialog-submit login-enter-submit"-->
                    </label>
                </li>
            </ul>

            <div class="teBus-login-dialog-link-pool ">
                <a href="javascript:void(0)" class="teBus-login-dialog-link-one register-link"><img src="/images/dialog_register_icon.svg" width="100%">註冊</a>
                <a href="javascript:void(0)" class="teBus-login-dialog-link-one forgot-password-link"><img src="/images/dialog_forgot_password_icon.svg" width="100%">忘記密碼</a>
                
    <a href="javascript:void(0)" class="teBus-login-dialog-link-one resend-confirm-email-link"><img src="/images/atk-resendmail.svg" width="100%">重發確認信</a>
                
                
            </div>
        </div>

    </form>
<form action="/Account/ExternalLogin?ReturnUrl=%2FRoute%2FStopsOfRoute%3Frouteid%3D0454065500" class="form-horizontal" id="ExternalLoginForm" method="post" role="form">        <input type="hidden" name="__RequestVerificationToken" class="verification-token" />
        <input type="hidden" name="provider" />
</form></div>

<script>
    function OpenLoginDialog() {
        $("#Login_DL").dialog('open');
        // Press enter key to submit
        $(".teBus-dialog-input-text-one").keyup(function (event) {
            if (event.keyCode == 13) {
                $(".login-enter-submit").click();
            }
        });
    }
    function CloseLoginDialog() {
        $("#Login_DL").dialog('close');
    }
    $(function () {
        $("#Login_DL").show();
        $("#Login_DL").dialog({
            autoOpen: false,
            modal: true,
            width: $("#Login_DL").find('.teBus-dialog').width(),
            show: {
                effect: "clip",
                duration: 300
            },
            hide: {
                effect: "clip",
                duration: 300
            },
            close: function (event, ui) {
                $("#LoginForm").find('input[name="Email"]').val('');
                $("#LoginForm").find('input[name="Password"]').val('');
            },
            position: { my: "center", at: "center", of: window }
        });
        // Form subnit action
        $('.login-enter-submit').click(function () {
            if ($('#LoginForm').valid()) {
 
                    $.ajax({
                        url: '/Account/Login?ReturnUrl=%2FRoute%2FStopsOfRoute%3Frouteid%3D0454065500',
                        dataType: "json",
                        type: "post",
                        data: {
                            '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                            'X-Requested-With': 'XMLHttpRequest',
                            "Email": $("#LoginForm").find('input[name="Email"]').val(),
                            "Password": $("#LoginForm").find('input[name="Password"]').val(),
                            "RememberMe": $('input[name="RememberMe"]').is(":checked"),
                            "RecaptchaToken": $('[name=h-captcha-response]').val()
                            //"RecaptchaToken": $('#LoginForm textarea').val()
                        },
                        success: function (data) {
                            if (data.ErrorCode === 100) window.location.replace(data.Msg);
                            if (data.ErrorCode === 101 || data.ErrorCode === 103) $("#LoginForm").find('input[name="Email"]').closest('.teBus-dialog-li').find('.teBus-diolag-note').text(data.Msg);
                            if (data.ErrorCode === 102) $("#LoginForm").find('input[name="Password"]').closest('.teBus-dialog-li').find('.teBus-diolag-note').text(data.Msg);
                        }
                    });
            }
        });

        // Register, forgot password link clicked
        $(".register-link,.forgot-password-link,.resend-confirm-email-link").click(function () {
            var startDate = new Date('2015-12-11 10:29:00');
            var endDate = new Date('2015-12-11 10:29:30');
            var now = new Date();
            if (now > startDate && now < endDate) {
                swal({
                    title: "HTML <small>系統公告</small>!",
                    text: "<h3>親愛的使用者您好</h3> <label> 由於系統設備將於2015/12/12進行維護，</label><label>會影響本系統部分功能的使用，</label><label>造成不便敬請見諒</label>",
                    html: true
                });
            } else {
                if ($(this).hasClass('register-link')) {
                    CloseLoginDialog();
                    setTimeout(function () {
                        OpenRegisterDialog();
                    }, 400);

                }
                if ($(this).hasClass('forgot-password-link')) {
                    CloseLoginDialog();
                    setTimeout(function () {
                        OpenForgotPasswordDialog();
                    }, 400);

                }
                if ($(this).hasClass('resend-confirm-email-link')) {
                    CloseLoginDialog();
                    setTimeout(function () {
                        OpenResendConfirmEmailDialog();
                    }, 400);

                }
            }

        });

        // External Login
        $('.facebook-login, .g-login').click(function () {
            if ($(this).hasClass('facebook-login')) {
                $('#ExternalLoginForm').find('input[name="provider"]').val('Facebook');
            }
            if ($(this).hasClass('g-login')) {
                $('#ExternalLoginForm').find('input[name="provider"]').val('Google');
            }
            $('#ExternalLoginForm').submit();

        });
    });
</script>


<!-- dialog_會員註冊 BEGIN-->
<div id="Register_DL" class="teBus-dialog-c" style="display:none">
    <form id="RegisterForm">
        
        <div class="teBus-dialog register-c">
            <h1 class="teBus-dialog-h1"><span class="teBus-dialog-title-img register-img" alt=" "></span>註冊</h1>
            <span class="teBus-dialog-close-icon-c"><a href="javascript:void(0)" class="teBus-dialog-close-icon" title="關閉" alt="關閉"></a></span>
            <ul class="teBus-dialog-ul">
                <li class="teBus-dialog-li">
                    <span class="teBus-dialog-li-title"> 電子郵件</span>
                    <label><input autocomplete="off" class="teBus-dialog-input-text-one" data-val="true" data-val-email="電子郵件欄位不是有效的電子郵件地址。" data-val-required="電子郵件是必要項" id="Email" name="Email" title="ex. ebus-taipei@mail.com" type="text" value="" /></label>
                    <a href="javascript:void(0)" class="register-a-one-icon register-check-icon" style="display:none"></a>
                    <span class="field-validation-valid teBus-diolag-note" data-valmsg-for="Email" data-valmsg-replace="true"></span>
           
                </li>
                <li class="teBus-dialog-li">
                    <span class="teBus-dialog-li-title">名稱</span>
                    <label><input autocomplete="off" class="teBus-dialog-input-text-one" data-val="true" data-val-required="名稱是必要項" id="Nickname" name="Nickname" type="text" value="" /></label>
                    <span class="field-validation-valid teBus-diolag-note" data-valmsg-for="Nickname" data-valmsg-replace="true"></span>
                </li>
                <li class="teBus-dialog-li">
                    <span class="teBus-dialog-li-title">密碼</span>
                    <label><input autocomplete="off" class="teBus-dialog-input-text-one" data-val="true" data-val-length="密碼必須至少6個字元長度" data-val-length-max="100" data-val-length-min="6" data-val-required="密碼是必要項" id="Password" name="Password" type="password" /></label>
                    <span class="field-validation-valid teBus-diolag-note" data-valmsg-for="Password" data-valmsg-replace="true"></span>
                </li>
                <li class="teBus-dialog-li">
                    <span class="teBus-dialog-li-title">確認密碼</span>
                    <label><input autocomplete="off" class="teBus-dialog-input-text-one" data-val="true" data-val-equalto="兩次密碼輸入並不相同" data-val-equalto-other="*.Password" id="ConfirmPassword" name="ConfirmPassword" type="password" /></label>
                    <span class="field-validation-valid teBus-diolag-note" data-valmsg-for="ConfirmPassword" data-valmsg-replace="true"></span>
                </li>
                <!--li class="teBus-dialog-li">
                    <span class="teBus-dialog-li-title">上傳照片</span>
                    <label><input name="" type="text" value="" class="teBus-dialog-input-text-one"></label>
                    <a href="javascript:void(0);" class="register-a-one-icon register-browse-icon">瀏覽</a>
                    <div class="teBus-dialog-gust-photo-img" title="預覽照片" ><img src="images/dialog_gust_photo_img.svg" width="100%" alt="預覽照片"></div>
                </li-->
                <li class="teBus-dialog-li"  style=" margin:0 auto;width: 50%;">
                    <span class="teBus-dialog-li-title">認證</span>
                    <p class="teBus-diolag-note"></p>
                    <div class="col-md-10">
                        <div class="h-captcha" data-sitekey="e57803e5-35a9-40c1-92dc-889ae1a81fc8"></div>
                        <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
                        </div>

</li>
            </ul>
            <!--input type="submit" value="註冊" class="teBus-dialog-submit register-enter-submit"-->
            <!--input type="submit" value="取消" class="teBus-dialog-submit register-close-submit"-->
            <a href="javascript:void(0)" class="teBus-dialog-submit register-enter-submit">註冊</a>
            <a href="javascript:void(0)" class="teBus-dialog-submit register-close-submit">取消</a>
        </div>
      
    </form>
</div>
<!-- dialog_會員註冊 END-->

<script>
    function OpenRegisterDialog() {
        $("#Register_DL").dialog('open');
    }
    function CloseRegisterDialog() {
        $("#Register_DL").dialog('close');
    }
    function verifyCallback(token) {
        alert(token)
    }

    $(function () {
        $("#Register_DL").show();
        $("#Register_DL").dialog({
            autoOpen: false,
            modal: true,
            width: $("#Register_DL").find('.teBus-dialog').width(),
            show: {
                effect: "clip",
                duration: 300
            },
            hide: {
                effect: "clip",
                duration: 300
            },
            close: function (event, ui) {
                $("#RegisterForm").find('input[name="Email"]').val('');
                $("#RegisterForm").find('input[name="Nickname"]').val('');
                $("#RegisterForm").find('input[name="Password"]').val('');
                $("#RegisterForm").find('input[name="ConfirmPassword"]').val('');
            },
            position: { my: "center", at: "center", of: window }
        });
        // Form subnit action
        $(".register-enter-submit").click(function () {
            debugger;
            //$("#RegisterForm").find('input[name="recaptcha_challenge_field"]').closest('.teBus-dialog-li').find('.teBus-diolag-note').text('');
            if ($('#RegisterForm').valid()) {
                
                $.ajax({
                    url: '/Account/Register',
                    dataType: "json",
                    type: "post",
                    data: {
                        '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                        'X-Requested-With': 'XMLHttpRequest',
                        "Email": $("#RegisterForm").find('input[name="Email"]').val(),
                        "Nickname": $("#RegisterForm").find('input[name="Nickname"]').val(),
                        "Password": $("#RegisterForm").find('input[name="Password"]').val(),
                        "ConfirmPassword": $("#RegisterForm").find('input[name="ConfirmPassword"]').val(),
                        "Tel": '',
                        "RecaptchaToken":$('#RegisterForm textarea').val()
                            //$('.h-captcha iframe').data("hcaptcha-response")
                            //$("iframe").attr("data-hcaptcha-response")
                          //  $('[name=h-captcha-response]').val()
                      
                    },
                    success: function (data) {
                        if (data.ErrorCode === 200) {
                            $(".register-close-submit").trigger('click');
                            alert('Welcome! 歡迎申請[大台北公車]會員');
                        }
                        if (data.ErrorCode === 201) $("#RegisterForm").find('input[name="recaptcha_challenge_field"]').closest('.teBus-dialog-li').find('.teBus-diolag-note').text(data.Msg);
                        if (data.ErrorCode === 202) $("#RegisterForm").find('input[name="Password"]').closest('.teBus-dialog-li').find('.teBus-diolag-note').text(data.Msg);
                    }
                });


            }
        });

        $("#RegisterForm").find('input[name="Email"]').focusout(function () {
            if ($("#RegisterForm").find('input[name="Email"]').valid())
            $.ajax({
                url: '/Account/AccountAvailable',
                dataType: "json",
                type: "post",
                data: {
                    '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                    'X-Requested-With': 'XMLHttpRequest',
                    "account": $("#RegisterForm").find('input[name="Email"]').val()
                },
                success: function (data) {
                    if (data.ErrorCode === 100) {
                        $(".register-check-icon").css("background-color", "#75bc59");
                        $(".register-check-icon").text('✔');
                        $(".register-check-icon").show();
                    }
                    if (data.ErrorCode === 101) {
                        $(".register-check-icon").css("background-color", "#FF0000");
                        $(".register-check-icon").text('✘');
                        $(".register-check-icon").show();
                    }
                }
            });
        });

        $(".register-close-submit").click(function () {

            CloseRegisterDialog();

        });
    });
</script>

<!-- dialog_忘記密碼 BEGIN-->
<div id="ForgetPw_DL" class="teBus-dialog-c" style="display:none">
    <form id="ForgotPasswordForm">
        <div class="teBus-dialog forgot-password-c">
            <h1 class="teBus-dialog-h1"><span class="teBus-dialog-title-img forgot-password-img" alt=" "></span>忘記密碼</h1>
            <span class="teBus-dialog-close-icon-c"><a href="javascript:void(0)" class="teBus-dialog-close-icon" title="關閉" alt="關閉"></a></span>
            <ul class="teBus-dialog-ul">
                <li class="teBus-dialog-li">
                    <span class="teBus-dialog-li-title">電子郵件 </span>
                    <label><input class="teBus-dialog-input-text-one" data-val="true" data-val-email="電子郵件欄位不是有效的電子郵件地址。" data-val-required="電子郵件是必要項" id="Email" name="Email" type="text" value="" /></label>
                    <span class="field-validation-valid teBus-diolag-note" data-valmsg-for="Email" data-valmsg-replace="true"></span>
                </li>
                <li class="teBus-dialog-li"  style=" margin:0 auto;width: 50%;">
                    
                    
                    <div class="h-captcha" data-sitekey="e57803e5-35a9-40c1-92dc-889ae1a81fc8"></div>
                    <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
                </li>
            </ul>
            <a href="javascript:void(0)" class="teBus-dialog-submit forgot-password-enter-submit">送出</a>
            <a href="javascript:void(0)" class="teBus-dialog-submit forgot-password-close-submit">取消</a>
        </div>
    </form>
</div>
<!-- dialog_忘記密碼 END-->

<script>
    function OpenForgotPasswordDialog() {
        $("#ForgetPw_DL").dialog('open');
    }
    function CloseForgotPasswordDialog() {
        $("#ForgetPw_DL").dialog('close');
    }

    $(function () {
        $("#ForgetPw_DL").show();
        $("#ForgetPw_DL").dialog({
            autoOpen: false,
            modal: true,
            width: $("#ForgetPw_DL").find('.teBus-dialog').width(),
            show: {
                effect: "clip",
                duration: 300
            },
            hide: {
                effect: "clip",
                duration: 300
            },
            close: function (event, ui) {
                $("#ForgotPasswordForm").find('input[name="Email"]').val('');
            },
            position: { my: "center", at: "center", of: window }
        });
        $('.forgot-password-enter-submit').click(function () {
            if ($('#ForgotPasswordForm').valid()) {
                $.ajax({
                    url: '/Account/ForgotPassword',
                    dataType: "json",
                    type: "post",
                    data: {
                        '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                        'X-Requested-With': 'XMLHttpRequest',
                        "Email": $("#ForgotPasswordForm").find('input[name="Email"]').val(),
                        "RecaptchaToken": $('#ForgotPasswordForm textarea').val()
                    },
                    success: function (data) {
                        if (data.ErrorCode === 300) {
                            $(".forgot-password-close-submit").trigger('click');
                            alert(data.Msg);
                        }
                        if (data.ErrorCode === 301 || data.ErrorCode === 103) $("#ForgotPasswordForm").find('input[name="Email"]').closest('.teBus-dialog-li').find('.teBus-diolag-note').text(data.Msg);
                    }
                });
            }
        });

        $(".forgot-password-close-submit").click(function () {
            CloseForgotPasswordDialog();
        });
    });
</script>


<script>
    $(function () {
        // Login link clicked
        $(".login-link").click(function () { OpenLoginDialog(); });
    });
</script>

        <!--end main list -->
        
<input name="__RequestVerificationToken" type="hidden" value="pbz_iai-tK2aDWdDwUnTUXbG75ugnwweWZ7imHvx8zjKr-Zf4WPhpn8MKKFeBRr4f8z005nk1Pkd_p3aDCE9S67Mbto1" />
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54651832-1', { 'cookieDomain': 'none' });
  ga('set', 'language', 'zh-TW');
  ga('set', 'screenResolution', screen.width + 'x' + screen.height);
  ga('set', 'viewportSize', screen.availWidth + 'x' + screen.availHeight);
  ga('set', 'screenColors', screen.colorDepth + '-bits');
  ga('set', 'hostname', location.hostname);

  ga('send', 'pageview');
  ga('send', 'event', {
      'eventCategory': 'PageView',
      'eventAction': 'Inter',
      'eventLabel': document.location.pathname,
      'eventValue': 1
  });

</script>

<script>
    $(function () {
        var token = $('input[name=__RequestVerificationToken]').filter(function () { return $(this).val() !== '' });
        $('input[name=__RequestVerificationToken]').val(token.val());
    });
</script>

    <script>
        $(function () {
            $('#sectionMain').show();
        });
    </script>

<script>
    $(function () {
    var alertPageNum = '2';
        $.ajax({
            url: '/NewsAlert/GetAlertNews',
            type: 'post',
            dataType: 'json',
            data: {
                '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                'X-Requested-With': 'XMLHttpRequest'
            },
            error: function (response) {
            },
            success: function (response) {
                response.forEach(function (info) {
                    var s = info.AlertPageList.split(';');
                    s.forEach(function (v) {
                        if (v == alertPageNum) {
                            var img = '';
                            if (info.AlertPicLink != null && info.AlertPicLink.length > 0)
                            {
                                //img = '<img src="' + info.AlertPicLink + '"   ><br/>';
                                img = '<img class="swal2-image" src="' + info.AlertPicLink + '" alt="">';
                                //img = info.AlertPicLink;
                            }

                            if (localStorage.getItem("FnAlertId" + info.Id) != "true")
                                Swal.fire({
                                    title: '<font color="#E78838">' + info.AlertContent + '</font>',
                                    html: img,
                                    //imageUrl: img,
                                    async: false,
                                    confirmButtonText: '確定',
                                    input: 'checkbox',
                                    inputPlaceholder: '不再提示'
                                }).then((result) => {
                                    /* Read more about isConfirmed, isDenied below */
                                    if (result.isConfirmed) {
                                        if (result.value) {
                                            localStorage.setItem("FnAlertId" + info.Id, "true");
                                        } else { }
                                    } else if (result.isDenied) {
                                        //Swal.fire('Changes are not saved', '', 'info')
                                    }
                                });//end swal
                        }
                    });

                });//for
            },
            complete: function () {
              
            }
        });
    });

</script>
<section class="info-c route-list" id="sectionMain" style="display:none;">
    <div id="findPanel" class="word-info-c stationlist-c">
        <h2>查詢結果</h2>
        <div class="search-c">
            <div class="stationlist-text-c">
                                <img src="/images/new_taipei_city.svg" width="100%" class="vipstop-city" alt="新北市">                
 <span class="stationlist-title">F655 </span>                 

                        <a href="../EBus/VsSimpleMap?routeid=0454065500" class="stationlist-move-route-icon stationlist-move-table-icon @*pad-none*@" title="動態簡圖" alt="動態簡圖"></a>
                    <a href="../MapOverview?nid=0454065500" target="_blank" class="stationlist-move-route-icon stationlist-route-list-icon" style="width:90px;height:30px;position:relative;" title="路線圖" alt="路線圖"></a>
                        <a href="javascript:void(0);" class="stationlist-move-route-icon stationlist-bus-info-table-icon " title="公車資訊" alt="公車資訊"></a>
                        <a href="javascript:void(0);" class="stationlist-move-route-icon stationlist-bus-time-icon" title="時刻表" alt="時刻表"></a>

                    <br />


                            <a style="color:#4CAF50;">新北市政府交通局公車申訴服務電話02-89682460</a></div>
            <ul class="stationlist-move-route-bus-info" style="display: none;">
                <li>
                    <span class="stationlist-move-route-bus-item">起迄站名 :</span>
                    <span class="stationlist-move-route-bus-content">鶯歌區公所 - 長庚醫院(總院)</span>
                </li>
                <li>
                    <span class="stationlist-move-route-bus-item-02">頭末班車 :</span>
                    <span class="stationlist-move-route-bus-content">
                        [平日] 0700 - 1640 <br>
                        [假日] 0700 - 1640
                    </span>
                </li>
                <li>
                    <span class="stationlist-move-route-bus-item-02">發車間隔 :</span>
                    <span class="stationlist-move-route-bus-content">
[平日] <br /> F655長庚醫院(總院)班表:0800 1015 1215 1415 1545 1750<br/>F655鶯歌區公所班表:0700 0930 1130 1330 1500 1640<br>
[假日]<br /> F655長庚醫院(總院)班表:0800 1015 1215 1415 1545 1750<br/>F655鶯歌區公所班表:0700 0930 1130 1330 1500 1640<br>
                    </span>
                </li>
                <li>
                    <span class="stationlist-move-route-bus-item">分段緩衝 :</span>
                    <span class="stationlist-move-route-bus-content"></span>
                </li>
                <li>
                    <span class="stationlist-move-route-bus-item">收費方式 :</span>
                    <span class="stationlist-move-route-bus-content"></span>
                </li>
                <li>
                    <span class="stationlist-move-route-bus-item">業者服務電話 :</span>
                        <span class="stationlist-move-route-bus-content">鶯歌區公所鶯歌區公所站:(02)2678 0202</span>
                </li>

            </ul>
                <p class="stationlist-come-go-c">
                    <a href="javascript:void(0);" class="stationlist-come-go stationlist-go">去程往 長庚醫院(總院)</a>
                    <a href="javascript:void(0);" class="stationlist-come-go-gray stationlist-come">返程往 鶯歌區公所</a>
                </p>


            <p> 
</p>
        </div>

        <div id="GoDirectionRoute" class="auto-list-pool-c stationlist-list-pool-c" >
            <ul class="auto-list-pool stationlist-list-pool">

                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 1</span>
                                    <span class="auto-list-stationlist-place">鶯歌區公所</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394105760" />
                                    <input data-val="true" data-val-number="欄位 Latitude 必須是數字。" data-val-required="Latitude 欄位是必要項。" id="item_Latitude" name="item.Latitude" type="hidden" value="24.955716" />
                                    <input data-val="true" data-val-number="欄位 Longitude 必須是數字。" data-val-required="Longitude 欄位是必要項。" id="item_Longitude" name="item.Longitude" type="hidden" value="121.354322" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 2</span>
                                    <span class="auto-list-stationlist-place">林長壽圖書館</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394301160" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.95714" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.34916" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 3</span>
                                    <span class="auto-list-stationlist-place">中山路249巷</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394300260" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.957108" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.345631" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 4</span>
                                    <span class="auto-list-stationlist-place">中山路292號</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394300360" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.957039" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.3440394" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 5</span>
                                    <span class="auto-list-stationlist-place">余厝巷口</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394102800" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.961765" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.342772" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 6</span>
                                    <span class="auto-list-stationlist-place">大湖路148號</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394100400" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.964552" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.342796" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 7</span>
                                    <span class="auto-list-stationlist-place">名湖社區</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394101910" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.970288" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.345167" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 8</span>
                                    <span class="auto-list-stationlist-place">鶯歌幼兒園</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394102320" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.971586" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.346246" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 9</span>
                                    <span class="auto-list-stationlist-place">大湖路358號</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394100520" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.972515" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.346362" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 10</span>
                                    <span class="auto-list-stationlist-place">中湖街70號</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394100920" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.972732" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.347966" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 11</span>
                                    <span class="auto-list-stationlist-place">大竹圍</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394100260" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.977766" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.347457" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 12</span>
                                    <span class="auto-list-stationlist-place">長庚醫院(分院)</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="3337800120" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.029849" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.366444" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 13</span>
                                    <span class="auto-list-stationlist-place">長庚醫院</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="3337500340" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.059661" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.3678435" />
                                </span>
                            </a>
                        </li>
            </ul>
        </div>
        <div id="BackDirectionRoute" class="auto-list-pool-c stationlist-list-pool-c"   style = "display:none">
            <ul class="auto-list-pool stationlist-list-pool">

                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 1</span>
                                    <span class="auto-list-stationlist-place">長庚醫院</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="3337500340" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.059661" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.3678435" />
                                   
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 2</span>
                                    <span class="auto-list-stationlist-place">長庚醫院(分院)</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="3337800120" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.029849" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.366444" />
                                   
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 3</span>
                                    <span class="auto-list-stationlist-place">大竹圍</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394100220" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.977619" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.347433" />
                                   
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 4</span>
                                    <span class="auto-list-stationlist-place">中湖街70號</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394100960" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.972882" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.347204" />
                                   
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 5</span>
                                    <span class="auto-list-stationlist-place">鶯歌幼兒園</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394102340" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.971618" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.346124" />
                                   
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 6</span>
                                    <span class="auto-list-stationlist-place">名湖社區</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394101960" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.970548" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.345214" />
                                   
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 7</span>
                                    <span class="auto-list-stationlist-place">大湖路148號</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394100450" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.964371" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.342634" />
                                   
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 8</span>
                                    <span class="auto-list-stationlist-place">余厝巷口</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394102840" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.962079" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.342625" />
                                   
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 9</span>
                                    <span class="auto-list-stationlist-place">中山路292號</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394300320" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.956926" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.34399" />
                                   
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 10</span>
                                    <span class="auto-list-stationlist-place">中山路249巷</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394300220" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.95692" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.345616" />
                                   
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 11</span>
                                    <span class="auto-list-stationlist-place">林長壽圖書館</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394301120" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.956931" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.349945" />
                                   
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 12</span>
                                    <span class="auto-list-stationlist-place">鶯歌區公所</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2394105731" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="24.955708" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.354072" />
                                   
                                </span>
                            </a>
                        </li>
            </ul>
        </div>
    </div>
    <!-- being 地圖區塊縮合 -->
    

<link href="/jss/leaflet/leaflet.css" rel="stylesheet" />
<script src="/jss/leaflet/leaflet.js"></script>
<script src="/jss/leaflet/wicket.js"></script>
<script src="/jss/leaflet/wicket-leaflet.js"></script>
<script src="/jss/LMap.js"></script>
<script src="/jss/LMapLayerToggle.js"></script>


<!-- being 地圖區塊縮合 -->
<div class="map-s-c">
    <a href="javascript:void(0);" id="close-open-map" class="open-map-icon pad-none" title="展開地圖" alt="展開地圖"></a>
    <div class="map-date">
        <div class="map-icon-pool-c">
            <div class="map-icon-pool">
                <a href="javascript:void(0);" class="map-icon map-youbike" title="YouBike" alt="YouBike"></a>
                
                <a href="javascript:void(0);" class="map-icon map-my-place" title="&lt;我的位置&gt;" alt="&lt;我的位置&gt;"></a>
               <!-- <a href="javascript:void(0);" id="MapButton" class="map-icon map-map" title="開啟地圖" alt="開啟地圖"></a>-->
            </div>
        </div>
        <div id="map_canvas" class="map">
            <a href="javascript:void(0);"  style="color: #0094ff" id="maplink" title="開啟地圖" alt="開啟地圖">開啟地圖</a>
           
        </div>
    </div>
</div>
<style>
    .word-info-none {
        display: none;
    }
</style>
<script>
    $('#close-open-map').click(function () {
        $('#close-open-map').toggleClass("close-map-icon pad-none");
        $('.map-s-c').toggleClass("map-b-c pad-none");
        $('#findPanel').toggleClass("word-info-none");

        var cls = $('#close-open-map').attr('class');
        if (cls == "open-map-icon close-map-icon") {
            $('#close-open-map').attr("title", i18n._('Shrink the map'));
            $('#close-open-map').attr("alt", i18n._('Shrink the map'));
        }
        else{
            $('#close-open-map').attr("title", i18n._('Enlarge the map'));
            $('#close-open-map').attr("alt", i18n._('Enlarge the map'));
        }

        MoveCenter();
    });

    //地圖縮放用
    function MoveCenter() {
        map.invalidateSize();
    };

    $('.map-youbike').click(function () {
        $('.map-youbike').toggleClass("map-youbike-o");
        var bl = $('.map-youbike').hasClass("map-youbike-o");

        if (bl) YoubikeFetch();
        else StopFetchYoubike();
    });

    $('.map-newbike').click(function () {
        $('.map-newbike').toggleClass("map-newbike-o");
        var bl = $('.map-newbike').hasClass("map-newbike-o");

        if (bl) NewbikeFetch();
        else StopFetchNewbike();
    });

    $('.map-my-place').click(function () {
        $('.map-my-place').toggleClass("map-my-place-o");
        var bl = $('.map-my-place').hasClass("map-my-place-o");

        if (bl) getLocation();
        else clearNowLocMarkers()
    });

    function newloadmap()
    {

    }

    $('.map-map').click(function () {
        var options = {
            zoom: 10,
            center: centerPoint,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            mapTypeControl: false,
            zoomControl: true,
            zoomControlOptions: {
                style: google.maps.ZoomControlStyle.SMALL
            },
            styles: [{ featureType: "landscape", stylers: [{ saturation: -100 }, { lightness: 60 }] }, { featureType: "road.local", stylers: [{ saturation: -100 }, { lightness: 40 }, { visibility: "on" }] }, { featureType: "transit", stylers: [{ saturation: -100 }, { visibility: "simplified" }] }, { featureType: "administrative.province", stylers: [{ visibility: "off" }] }, { featureType: "water", stylers: [{ visibility: "on" }, { lightness: 30 }] }, { featureType: "road.highway", elementType: "geometry.fill", stylers: [{ color: "#ef8c25" }, { lightness: 40 }] }, { featureType: "road.highway", elementType: "geometry.stroke", stylers: [{ visibility: "off" }] }, { featureType: "poi.park", elementType: "geometry.fill", stylers: [{ color: "#b6c54c" }, { lightness: 40 }, { saturation: -40 }] }, {}]
        };
        $("#MapButton").hide();
        map = new google.maps.Map(document.getElementById("map_canvas"), options);

        // 畫路線軌跡
        drawRouteTrack();

        var routePathBounds = new google.maps.LatLngBounds();
        var path = new google.maps.MVCArray();

        if (objArr.RouteTracks.length != 0) {
            for (var i = 0; i < objArr.RouteTracks.length; i++) {
                var latlng = new google.maps.LatLng(objArr.RouteTracks[i]
                    .Latitude,
                    objArr.RouteTracks[i].Longitude);
                path.push(latlng);
                routePathBounds.extend(latlng);
            }
            routePath.setPath(path);
            if (map == null)
            { }
            else {
                map.fitBounds(routePathBounds);
            }
        }

        pointRouteStops(true);
        routePath.setOptions({ strokeColor: '#9863b6' });


        if (objArr.RouteTracks.length != 0) {
            if (map == null)
            { }
            else {
                map.fitBounds(routePathBounds);
            }
        }
        stopStationStatusReport();
        stationStatusReport();
        stopBusStatusReport();
        busStatusReport();

    });

    $('#maplink').click(function () {
        var options = {
            zoom: 10,
            center: centerPoint,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            mapTypeControl: false,
            zoomControl: true,
            zoomControlOptions: {
                style: google.maps.ZoomControlStyle.SMALL
            },
            styles: [{ featureType: "landscape", stylers: [{ saturation: -100 }, { lightness: 60 }] }, { featureType: "road.local", stylers: [{ saturation: -100 }, { lightness: 40 }, { visibility: "on" }] }, { featureType: "transit", stylers: [{ saturation: -100 }, { visibility: "simplified" }] }, { featureType: "administrative.province", stylers: [{ visibility: "off" }] }, { featureType: "water", stylers: [{ visibility: "on" }, { lightness: 30 }] }, { featureType: "road.highway", elementType: "geometry.fill", stylers: [{ color: "#ef8c25" }, { lightness: 40 }] }, { featureType: "road.highway", elementType: "geometry.stroke", stylers: [{ visibility: "off" }] }, { featureType: "poi.park", elementType: "geometry.fill", stylers: [{ color: "#b6c54c" }, { lightness: 40 }, { saturation: -40 }] }, {}]
        };
        $("#MapButton").hide();
        map = new google.maps.Map(document.getElementById("map_canvas"), options);

        // 畫路線軌跡
        drawRouteTrack();

        var routePathBounds = new google.maps.LatLngBounds();
        var path = new google.maps.MVCArray();

        if (objArr.RouteTracks.length != 0) {
            for (var i = 0; i < objArr.RouteTracks.length; i++) {
                var latlng = new google.maps.LatLng(objArr.RouteTracks[i]
                    .Latitude,
                    objArr.RouteTracks[i].Longitude);
                path.push(latlng);
                routePathBounds.extend(latlng);
            }
            routePath.setPath(path);
            if (map == null)
            { }
            else {
                map.fitBounds(routePathBounds);
            }
        }

        pointRouteStops(true);
        routePath.setOptions({ strokeColor: '#9863b6' });


        if (objArr.RouteTracks.length != 0) {
            if (map == null)
            { }
            else {
                map.fitBounds(routePathBounds);
            }
        }
        stopStationStatusReport();
        stationStatusReport();
        stopBusStatusReport();
        busStatusReport();

    });


</script>
    <!-- end 地圖區塊縮合 -->

</section>

<section class="info-c route-chart" style="display:none;">
    <!--路線簡圖-->
</section>

<div id="Toolbar" class="teBus-dialog-c" style="display:none">
    <div class="teBus-dialog tool-dialog-c">
        <h1 class="teBus-dialog-h1"><span class="teBus-dialog-title-img tool-dialog-img" alt=" "></span>快捷工具列</h1>
        <span class="teBus-dialog-close-icon-c"><a href="javascript:void(0);" class="teBus-dialog-close-icon" title="關閉"></a></span>
        <div class="tool-icon-pool">
            <a id="routeList" href=javascript:void(0) class="teBus-login-dialog-link-one"><img src="/images/dialog_route_icon.svg" width="100%" alt="行經路線">行經路線</a>
            <a id="busAlert" href=javascript:void(0) class="teBus-login-dialog-link-one"><img src="/images/dialog_remind_icon.svg" width="100%" alt="到站提醒">到站提醒</a>
            <a id="addToMybus" href=javascript:void(0) class="teBus-login-dialog-link-one"><img src="/images/dialog_add_bus_icon.svg" width="100%" alt="加入我的公車">加入我的公車</a>
            <a class="teBus-login-dialog-link-one-recent3" id="recent3">
                <font>
                    .</font><br />
                    <font>
                        .</font><br />
                        <font">.</font><br />
            </a>
</div>
    </div>
</div>

<input type="hidden" id="selected_stop_id" />
<input type="hidden" id="selected_stop_name" />
<div id="SetAlertTime" class="teBus-dialog-c" style="display:none">
    <div class="teBus-dialog news-dialog-c">
        <h1 class="teBus-dialog-h1"><span class="teBus-dialog-title-img remind-dialog-img" alt=" "></span>設定到站提醒通知</h1>
        <span class="teBus-dialog-close-icon-c"><a href="javascript:void(0);" class="teBus-dialog-close-icon" title="關閉" alt="關閉"></a></span>
        <div class="set-up-remind-dialog-c">
            <a href="javascript:setAlertConfirm(180);" class="set-up-remind-time-dialog">3分鐘前提醒</a>
            <a href="javascript:setAlertConfirm(300);" class="set-up-remind-time-dialog">5分鐘前提醒</a>
            <a href="javascript:setAlertConfirm(600);" class="set-up-remind-time-dialog">10分鐘前提醒</a>
            <a href="javascript:setAlertConfirm(900);" class="set-up-remind-time-dialog">15分鐘前提醒</a>
            <a href="javascript:setAlertConfirm(1200);" class="set-up-remind-time-dialog">20分鐘前提醒</a>
        </div>
    </div>
</div>
<div id="News_Detail_DL" class="teBus-dialog-c" style="display:none">
    <div class="teBus-dialog news-dialog-c">
        <h1 class="teBus-dialog-h1"><span class="teBus-dialog-title-img remind-dialog-img" alt=" "></span>到站提醒通知</h1>
        <span class="teBus-dialog-close-icon-c"><a href="javascript:void(0);" class="teBus-dialog-close-icon" title="關閉" alt="關閉"></a></span>
        <div class="remind-dialog-c">
        </div>
    </div>
</div>
<script>
    $(function () {
        window.setInterval(StartBusArrivalAlert, 1000 * 60);

        $("#News_Detail_DL").dialog({
            autoOpen: false,
            width: $('#News_Detail_DL').width(),
            modal: true,
            show: {
                effect: "clip",
                duration: 600
            },
            buttons: {},
            hide: {
                effect: "clip",
                duration: 500
            },
            close: function (event, ui) {
                $('#News_Detail_DL').find('.remind-dialog-c').html('');
            }
        });

        $(".ui-dialog-titlebar").hide();
    });
    function StartBusArrivalAlert() {
        if (localStorage.bus_alert !== undefined && !$("#News_Detail_DL").dialog("isOpen")) {
            var busAlert = JSON.parse(localStorage.bus_alert);
            var m = $.map(busAlert, function (value, index) {
                return { "UniStationId": value.StopId, "UniRouteId": value.RouteId, "UniBusId": "", "BusLicence": "", "BusType": 0, "RouteDirect": 0, "ETA": 0 };
            });
            $.ajax({
                url: '/Stop/StatusOfRutStp',
                type: 'post',
                dataType: 'json',
                data: {
                    '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                    'X-Requested-With': 'XMLHttpRequest',
                    'models': JSON.stringify(m)
                },
                error: function (response) {

                },
                success: function (response) {
                    $.each(busAlert, function (idx, val) {
                        $.each(response, function (index, value) {
                            if (value.ETA !== 0 && val.RouteId === value.UniRouteId &&
                                val.StopId === value.UniStationId && val.SetTime > value.ETA) {
                                $('#News_Detail_DL').find('.remind-dialog-c').append(
                                    $('<p/>', { 'class': 'remind-content-dialog', 'text': val.RouteName + " " + val.StopName }),
                                    $('<p/>', { 'class': 'remind-time-dialog', 'text': i18n._('Estimate') + Math.floor(value.ETA / 60) + i18n._('Arrives minute(s)') })
                                );
                                for (var i = 0; i < busAlert.length; i++) {
                                    if (busAlert[i].RouteId == value.UniRouteId && busAlert[i].StopId == value.UniStationId && val.SetTime > value.ETA) {
                                        busAlert.splice(i, 1);
                                    }
                                    AlertDelete(i);
                                }
                                localStorage.setItem('bus_alert', JSON.stringify(busAlert));
                            }
                        });
                        if ($('#News_Detail_DL').find('.remind-dialog-c').html().trim() !== '') {
                            if (!$("#News_Detail_DL").dialog("isOpen")) {
                                $("#News_Detail_DL").dialog("open");
                            }
                        }
                    });
                }
            });
        }
    }
</script>

<div id="AddToMyBus" class="teBus-dialog-c" style="display:none;">
    <div class="teBus-dialog alternative-route-dialog-c">
        <h1 class="teBus-dialog-h1">選擇公車群組</h1>
        <span class="teBus-dialog-close-icon-c"><a href="#" class="teBus-dialog-close-icon" title="關閉"></a></span>
        <ul class="dialog-chose-bos-group-pool"></ul>
    </div>
</div>





    </div>
    <!-- end content -->
    <!-- loading dialog -->
    <div id="Loading_DL" class="teBus-dialog-c" style="display: none;">
        <div class="teBus-dialog loading-dialog-c">
            <p class="loading-dialog-p"><img src="/images/dialog_loading_bus_img.gif" class="loading-dialog-img" width="100%" alt=" ">資料載入中，請稍候</p>
        </div>
    </div>
    <!-- end loading dialog -->
    
<footer class="teBUS-main-footer">
    <div class="teBUS-main-footer-logo">
                <a href="https://www.gov.taipei/" target="_blank" class="teBUS-main-footer-taipei" title="臺北市政府" alt="臺北市政府"><img src="/images/taipei_city.svg" width="100%" title="臺北市政府" alt="臺北市政府"></a>
                <a href="https://www.ntpc.gov.tw/" target="_blank" class="teBUS-main-footer-new-taipei" title="新北市政府" alt="新北市政府"><img src="/images/new_taipei_city.svg" width="100%" title="新北市政府" alt="新北市政府"></a>

      
        <span class="teBUS-main-footer-ebus-logo" title="大臺北公車"><img src="/images/logo_img02.svg" width="100%" title="大臺北公車" alt="大臺北公車"></span>
    </div>
    <div class="teBUS-main-footer-text">
        <p class="teBUS-main-footer-Copyright">本網站所有版權歸屬於臺北市政府與新北市政府 Copyright&#169;2014<span></span></p>
        <p>
            建議瀏覽器IE9.0以上版本/Firefox/Google Chrome (最佳螢幕解析1024*768) <br />
            如有大臺北公車網站服務任何問題，請撥1999為您服務
            聯絡地址:110210臺北市信義區松德路300號4樓
        </p>
    </div>
    <div class="teBUS-main-footer-link-pool">
        <a href="/Home/WebSite" class="teBUS-main-footer-link" target="_self">網站導覽</a>
        
        <a href="/Home/CopyrightNotice" class="teBUS-main-footer-link" target="_self">著作權聲明</a>
        <a href="/Home/SecurityPrivacyPolicy" class="teBUS-main-footer-link" target="_self">隱私權及網站安全政策</a>
        <p class="teBUS-main-footer-date">網站更新日期:<span>2025-06-02</span><br />網站檢視日期:2025-06-02</p>
    </div>
</footer>
<!-- end footer -->

    <script src="/bundles/modernizr?v=wBEWDufH_8Md-Pbioxomt90vm6tJN2Pyy9u9zHtWsPo1"></script>

    
    <script src="/jss/tebus-script.js"></script>
    <script src="/bundles/sweetAlert?v=cMcnF9PMfZnW6d_oMLsRilV8d-Fh8HT8X6rfi8S_EV41"></script>

    <script src="/sweetAlert/css?v=Q7l7a83fZdl7_6jt13P3HsHoLWvbYv1YpqCreuQlPuQ1"></script>

    <script src="/bundles/sweetAlert2?v=PwfQxO_e6ZEtKGd2oGReTt3SIS48xCdv8zRgwComWDA1"></script>

    <script src="/sweetAlert2/css?v=fJb18S8FvSIfJsXWl8pwQn02lsvJyZVA2V9a_xRxskI1"></script>

    
    <script src="/bundles/customScrollbar?v=FNWrR0EcYik_CfSZ44D3T7EmJWx0Sy8nttPc_daLKEU1"></script>

    <script src="/bundles/busInfoHelper?v=Bz-GVCVvhrGERqTqUhEyiA19qHoesHwpCKpDnLmBTC81"></script>

    <script src="/bundles/busArrivalAlert?v=MDKgeaTn7JrPx59avQagl_lTQuO4AjqKyXZGq_1HMcs1"></script>

    <script src="/bundles/jqueryval?v=kO9SZjRLUEvNZbFlwaT1hsJ0t0ngQHk32HeNdumCbRM1"></script>

    <script src="/bundles/toastr?v=nU7i1d5lsXeim4T9MB2Gdegj9fc8yXl1nK6hEZMOAm81"></script>

    
<style>
.marker-g {
    background-image: url("../images/mapIcon/station_01.png");
    background-size:24px 24px;
	/*background-color: rgba(218, 94, 94, 0.6);*/
	}
    .marker-b {
    background-image: url("../images/mapIcon/station_02.png");
    background-size:24px 24px;
	/*background-color: rgba(218, 94, 94, 0.6);*/
	}
    .custompopup .leaflet-popup-content-wrapper a {
    color: #ffffff;
}
    .custompopup .leaflet-popup-content p{
    margin: 0;
}
    


    </style>

<script src="/jss/VsSimpleMap.js"></script>

    <script>

        viccknCulture = 'zh-TW';
        //var InfoBox = new google.maps.InfoWindow({ content: " " });
        var routePath;
        var Marker_Bus_Status = [];
        var busFetchInterval = null;
        var stopFetchInterval = null;
        var goStopStationNum = []; //去程站位數量
        var backStopStationNum = []; //返程站位數量



        //#region 時刻表
        $('.stationlist-bus-time-icon').click(function () {
            var _date = new Date();
            var _nowDate = _date.getFullYear() + "/" +( _date.getMonth()+1) + "/" + _date.getDate();
            //var _url = "http://web.taiwanbus.tw/eBUS/subsystem/Timetable/TimeTableAPIByWeek.aspx?RouteId=" + "" + "&SearchDate=" + _nowDate;
            var _url = "../Route/RouteSchedule?routeid=0454065500";

            window.open(_url, "_blank");
        });
        //#endregion


        var existGoNum = 13;
        var existBackNum = 12;

        function getStopStationNum(goBack) {
            switch (goBack) {
                case 1:
                    var go = $("#GoDirectionRoute div > div > li > a > span > span.auto-list-stationlist-number")
                        .text()
                        .trim()
                        .split(' ')
                        .filter(function(v){return v!==''})
                        .map(function(item, index) { return parseInt(item) });

                    if (go && go.length === existGoNum) {
                        goStopStationNum = go;
                    }

                    goStopStationNum = $("#GoDirectionRoute div > div > li > a > span > span.auto-list-stationlist-number")
                        .text()
                        .trim()
                        .split(' ')
                        .filter(function(v){return v!==''})
                        .map(function(item, index) { return parseInt(item) });
                    break;
                case 2:
                    var back = $("#BackDirectionRoute div > div > li > a > span > span.auto-list-stationlist-number")
                        .text()
                        .trim()
                        .split(' ')
                        .filter(function(v){return v!==''})
                        .map(function(item, index) { return parseInt(item) });

                    if (back && back.length === existBackNum) {
                        backStopStationNum = back;
                    }

                    break;

            }
        }

        getStopStationNum(1);
        getStopStationNum(2);

        function bindInfoWindow(marker, map, InfoBox, content) {
            google.maps.event.addListener(marker,
                'click',
                function() {
                    InfoBox.setContent(content);
                    InfoBox.open(map, marker);
                });
        }

        function createBusMarker(lat, lng, title, icon) {
            var marker = new google.maps.Marker({
                position: new google.maps.LatLng(lat, lng),
                map: map,
                title: title,
                icon: icon
            });
            Marker_Bus_Status.push(marker);
        }

        function clearBusMarkers() {
            while (Marker_Bus_Status[0]) {
                Marker_Bus_Status.pop().setMap(null);
            }
        }

        function drawRouteTrack() {
            routePath = new google.maps.Polyline({
                geodesic: true,
                strokeColor: '#9863b6',
                strokeOpacity: 1.0,
                strokeWeight: 4
            });
            routePath.setMap(map);
        }


        function pointRouteStopsLMap(isGoDirection) {
            clearMarkers();
            var stops;
            var iconUrl;
            if (isGoDirection) {
                if (objArr.GoDirStops ==null)
                {stops = objArr.BackDirStops;
                    iconUrl = 'marker-g';
                }
                else
                {
                    stops = objArr.GoDirStops;
                    iconUrl = 'marker-g';
                }
                //stops = objArr.GoDirStops;
                //iconUrl = 'marker-g';
            } else {
                stops = objArr.BackDirStops;
                //iconUrl = "images/mapIcon/station_02.png";
                iconUrl = 'marker-b';
            }
            var arMarker = [];
            for (var i in stops) {
                infoLink =
                    "<div class='inforwindow-bike-c'><div class='inforwindow-1ocation-c'><p class='inforwindow-1ocation'>" + stops[i].Name + "</p><p class='inforwindow-1ocation-number'>"+ "</p></div><a class='inforwindow-transplan-start-end-icon02' href='" + SitePath + "Stop/RoutesOfStop?Stopid=" + stops[i].UniStopId + "'>" + i18n._('List of Routes') + "</a></div>";
                // "<div class='inforwindow-bike-c'><div class='inforwindow-1ocation-c'>" + "<p class='inforwindow-1ocation-number'>" + stops[i].PublicId + "</p></div><a class='inforwindow-transplan-start-end-icon02' href='" + SitePath + "Stop/RoutesOfStop?Stopid=" + stops[i].UniStopId + "'>" + i18n._('List of Routes') + "</a></div>";

                var GoStopsicon = new L.DivIcon({ html: '<div align="center"  valign="center"><span>' + (parseInt(i)+1) + '</span></div>', className:  iconUrl, iconSize: new L.Point(24, 24),iconAnchor: [12, 24], });
                //var GoStopsicon = L.icon({
                //    iconUrl: '/images/mapIcon/station_01.png',
                //    iconSize: [16, 16]
                //});
                m = L.marker([stops[i].Latitude, stops[i].Longitude], { icon: GoStopsicon });
                m.bindPopup(infoLink, {
                    maxWidth : 300,
                    maxHeight:170,
                    className:'custompopup'
                });
                setStationMarkers(m);
                //m.bindTooltip(data[i].tooltip);

                arMarker.push(m);
            }
            StoplayerGroup = L.layerGroup(arMarker).addTo(map)
            //layerMap.set('layername', L.layerGroup(arMarker).addTo(map));
        }

        function stopStatusRecent3Report(stopId) {
            (
                function startFatch() {
                    $.ajax({
                        // url: '/Route/StopStatusRecent3OfRoute?routeid=0454065500',
                        url: './StopStatusRecent3OfRoute?routeid=0454065500&stopid='+stopId,
                        type: 'post',
                        dataType: 'html',
                        data: {
                            '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                            'X-Requested-With': 'XMLHttpRequest'
                        },
                        error: function(xhr) {

                        },
                        success: function(response) {
                            // clearBusMarkers();
                            //var jsonObjArr = JSON.parse(response);// vic
                            // var jsonObjArr = response;
                            //  alert(response);
                            $('#recent3').empty();
                            $('#recent3').append(response);


                        }
                    });
                    //if (busFetchInterval == null) {
                    //    busFetchInterval = window.setInterval(startFatch, 1000 * 13);
                    //}
                })();
        }

        function busStatusReport() {
            (function startFatch() {
                $.ajax({
                    url: '/Route/BusStatusOfRoute?routeid=0454065500',
                    type: 'post',
                    dataType: 'json',
                    data: {
                        '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    error: function(xhr) {

                    },
                    success: function(response) {
                        clearBusMarkers();
                        var jsonObjArr = JSON.parse(response);// vic
                        // var jsonObjArr = response;
                        if (BuslayerGroup != null) {
                            BuslayerGroup.clearLayers();
                        }
                        var arMarker = [];
                        for (var i in jsonObjArr) {
                            if (($('.stationlist-go').hasClass('stationlist-come-go') ||
                                    $('.stationlist-come-go-c').length === 0) &&
                                jsonObjArr[i].RouteDirect === 1) {

                                m = L.marker([jsonObjArr[i].position.Latitude, jsonObjArr[i].position.Longitude], { icon:  L.icon({iconUrl: busIcon(jsonObjArr[i].BusType),iconAnchor: [16, 32]}) });
                                m.bindPopup(jsonObjArr[i].BusLicence);
                                arMarker.push(m);
                                //createBusMarker(value.position.Latitude,
                                //    value.position.Longitude,
                                //    value.BusLicence,
                                //    busIcon(value.BusType));
                            }
                            if ($('.stationlist-come').hasClass('stationlist-come-go') && jsonObjArr[i].RouteDirect === 2) {
                                m = L.marker([jsonObjArr[i].position.Latitude, jsonObjArr[i].position.Longitude], { icon:  L.icon({iconUrl: busIcon(jsonObjArr[i].BusType),iconAnchor: [16, 32]}) });
                                m.bindPopup(jsonObjArr[i].BusLicence);
                                arMarker.push(m);
                            }


                        }
                        BuslayerGroup = L.layerGroup(arMarker).addTo(map)
                        //$.each(jsonObjArr,
                        //    function(idx, value) {
                        //        if (($('.stationlist-go').hasClass('stationlist-come-go') ||
                        //                $('.stationlist-come-go-c').length === 0) &&
                        //            value.RouteDirect === 1) {
                        //            //createBusMarker(value.position.Latitude,
                        //            //    value.position.Longitude,
                        //            //    value.BusLicence,
                        //            //    busIcon(value.BusType));
                        //        }
                        //        if ($('.stationlist-come').hasClass('stationlist-come-go') && value.RouteDirect === 2) {
                        //            //createBusMarker(value.position.Latitude,
                        //            //    value.position.Longitude,
                        //            //    value.BusLicence,
                        //            //    busIcon(value.BusType));
                        //        }
                        //    });
                    }
                });
                if (busFetchInterval == null) {
                    busFetchInterval = window.setInterval(startFatch, 1000 * 13);
                }
            })();
        }

        function stopBusStatusReport() {
            clearBusMarkers();
            clearInterval(busFetchInterval);
            busFetchInterval = null;
        }

        function busIcon(btype) {
            var url;
            if (btype === 2) {
                url = SitePath + "images/mapIcon/LowFloorBus06.png";
                return url;
            }
            if (btype === 51) {
                url = SitePath + "images/mapIcon/FukangBus06.png";
                return url;
            }
            if (btype === 52) {
                url = SitePath + "images/mapIcon/YuanZaiBus06.png";
                return url;
            }
            if (btype === 6) {
                url = SitePath + "images/mapIcon/AccMiniBus06.png";
                return url;
            }
            url = SitePath + "images/mapIcon/NormalBus06.png";
            return url;
        }

        //依據清單，過濾重複項目
        function unique(list) {
            var result = [];
            $.each(list,
                function(i, e) {
                    if ($.inArray(e, result) === -1) result.push(e);
                });
            return result;
        }

        function stationStatusReport() {
            (function startFatch() {
                $.ajax({
                    url: '/Route/StopStatusOfRoute?routeid=0454065500',
                    type: 'post',
                    dataType: 'json',
                    data: {
                        '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    error: function(xhr) {

                    },
                    success: function(response) {
                        // Clearing
                        $('.auto-list-stationlist-bus').remove();
                        $('.auto-list-stationlist-position')
                            .removeClass('auto-list-stationlist-position-none auto-list-stationlist-position-now auto-list-stationlist-position-time')
                            .html('');
                        
                        var jsonObjArr = JSON.parse(response);
                        var goStationList = []; //去程站位及站序
                        var backStationList = []; //返程站位及站序
                        var uniStation = []; //取得車號
                        var tempduplicate = [];//重複站牌編號項目(暫存)
                        var duplicateStation; //重複站排項目
                        var filterDuplicate;//取得有重複的站位及公車編號

                        if (jsonObjArr.length !== 0) {

                            var hasSeq = jsonObjArr[0].StopSequence !== 65535;
                            //hasSeq = jsonObjArr[0].UniRouteId[9] =='0' ?hasSeq:false;
                            // if ($('.stationlist-go').hasClass('stationlist-come-go') ||$('.stationlist-go').hasClass('stationlist-go')) {
                            if ($('.stationlist-go').hasClass('stationlist-come-go') ||objArr.BackDirStops === null) {
                                //if ($('.stationlist-go').hasClass('stationlist-come-go') ||!($('.stationlist-come-go-c').length == 0)) {

                                //取得去程站位及站序
                                $.each( $('#GoDirectionRoute li  '), function( index, item ){
                                    var uniStopId = $(item).find('input#item_UniStopId').val();
                                    var stopSeq =parseInt($(item).find('.auto-list-stationlist-number').text().trim());
                                    goStationList.push({ stopSeq: stopSeq, uniStopId: uniStopId });
                                });

                                //取得相同站牌編號
                                $.grep(jsonObjArr,function(item) {

                                    if (($.inArray(item.UniStationId, uniStation) === -1)) {
                                        //未重複
                                        uniStation.push(item.UniStationId);
                                        
                                    } else {
                                        //有重複
                                        tempduplicate.push(item.UniStationId);
                                    }
                                });

                                if (tempduplicate.length==0)
                                {hasSeq=false;
                                }

                                //重複站排項目
                                duplicateStation = unique(tempduplicate);

                                //取得有重複的站位及公車編號
                                filterDuplicate = $.grep(jsonObjArr,function(item) {

                                    //取得有重複站位
                                    if (($.inArray(item.UniStationId, duplicateStation) !== -1)) {

                                        //確定該站位，有在站位列表中
                                        var result = $.grep(goStationList,function(e) { return e.uniStopId === item.UniStationId; });

                                        if (result && result.length > 0) {

                                            //在資料內找出該站位的進站公車，是否有重複
                                            if (item.Vehicles && item.Vehicles.length > 0) {

                                                //依據該公車編號，取得是否有重複的
                                                var busIdDuplicate = $.grep(item.Vehicles,function(value) {

                                                    var getVehicles = $.grep(jsonObjArr,function(data) {

                                                        //找出有重複的公車編號
                                                        var filterVehicles = $.grep(data.Vehicles,function(vehicles) {
                                                            return value.UniBusId === vehicles.UniBusId;
                                                        });

                                                        //若相同公車編號找尋結果，有2筆以上，則回傳該項目
                                                        if (filterVehicles && filterVehicles.length > 0) {
                                                            return data;
                                                        }
                                                    });

                                                    if (getVehicles && getVehicles.length > 0) {
                                                        return value;
                                                    }
                                                });

                                                if (busIdDuplicate && busIdDuplicate.length > 0) {
                                                    return item;
                                                }


                                            }


                                        }

                                    }
                                });

                                //去程
                                $('#GoDirectionRoute li').map(function(index, item) {

                                    //站排編號
                                    var _UniStopId = $(item).find('input#item_UniStopId').val();
                                    //站牌站序
                                    var _StopSeq =parseInt($(item).find('.auto-list-stationlist-number').text().trim());

                                    var tmp = jsonObjArr.filter(function(item) {

                                        if (hasSeq) {
                                            if (item.UniStationId == _UniStopId &&
                                                item.StopSequence == (_StopSeq - 1))
                                                return true;
                                        } else {
                                            if (item.UniStationId == _UniStopId)
                                                return true;
                                        }
                                        return false;
                                    });

                                    if (tmp && tmp.length > 0) {

                                        var value = tmp[0];

                                        //依據有重複的站位及公車編號，取得下一站位的等待時間
                                        var  filterBusId = filterDuplicate.filter(function(item) {
                                            if (item.UniStationId === value.UniStationId) {
                                                return true;
                                            }
                                            return false;
                                        }).map(function(dirItem) {

                                            var nextStation = jsonObjArr.filter(function (station) {
                                                if ( station.StopSequence ===( parseInt(dirItem.StopSequence) +1)) {

                                                    return true;
                                                }
                                                return false;
                                            });

                                            if (nextStation && nextStation.length > 0 ) {
                                                dirItem.NextETA = nextStation[0].ETA;
                                            }

                                            return dirItem;

                                        });

                                        //若公車站編號相同超過1個以上，表示有重複
                                        if (filterBusId && filterBusId.length > 1) {

                                            //車號編號
                                            var busArray= [];
                                            //重複車號編號
                                            var tempbusArray= [];

                                            //取得重複車號
                                            $.each(filterBusId , function(index, item) {
                                                $.each(item.Vehicles , function(iVehicles, vehicles) {

                                                    if (($.inArray(vehicles.UniBusId, busArray) !== -1)) {
                                                        //未重複
                                                        busArray.push(vehicles.UniBusId);
                                                    } else {
                                                        //有重複
                                                        tempbusArray.push(vehicles.UniBusId);
                                                    }
                                                });
                                            });

                                            //過濾收集重複車號項目
                                            var duplicateBus = unique(tempbusArray);

                                            if (duplicateBus.length > 0 ) {

                                                //依進站時間排序
                                                filterBusId.sort(function (a, b) {
                                                    if (a.NextETA> b.NextETA) {
                                                        return 1;
                                                    }
                                                    if (a.ETA< b.ETA) {
                                                        return -1;
                                                    }
                                                    // a must be equal to b
                                                    return 0;
                                                });

                                                for (var i = 0; i < filterBusId.length; i++) {

                                                    if (i !==0) {
                                                        filterBusId[i].Vehicles =  $.grep(filterBusId[i].Vehicles, function(iVehicles, vehicles) {

                                                            if (($.inArray(vehicles.UniBusId, duplicateBus) === -1)) {
                                                                //未重複
                                                                return vehicles;
                                                            }

                                                        });
                                                    }
                                                }
                                            }
                                        }

                                        if (value.Vehicles.length > 0) {

                                            var _html = "<span class='auto-list-stationlist-bus'>";

                                            for (var i = 0; i < value.Vehicles.length; i++) {
                                                //'<img src=\"../images/seats/seat00.png\">'
                                                var dogimg=""
                                                if($('#doglink').attr('dognum')!=null)
                                                {
                                                    if (value.Vehicles[i].BusLicence.indexOf($('#doglink').attr('dognum')) > -1) {
                                                        value.Vehicles[i].BusLicence=value.Vehicles[i].BusLicence.replace($('#doglink').attr('dognum'), '');
                                                        dogimg="<img src='" +
                                                            SitePath +
                                                            "images/stationlist_dogwhite_bus.png' class='bus-number-img' alt=''>";
                                                    }
                                                }
                                                if (value.Vehicles[i].BusType == 2) {
                                                    _html = _html +
                                                        "<p class='bus-number'><img src='" +
                                                        SitePath +
                                                        "images/stationlist_accessibility_bus.svg' class='bus-number-img' alt='" +
                                                        i18n._('Accessibility Bus') +
                                                        "'>" +
                                                                                                                value.Vehicles[i].BusLicence +setSeatImg(value.Vehicles[i].bSetL)+
                                                        "</p>";
                                                } else {
                                                    _html =
                                                        _html +
                                                        "<p class='bus-number'>" +
                                                                                                                value.Vehicles[i].BusLicence +setSeatImg(value.Vehicles[i].bSetL)+
                                                        "</p>";
                                                }
                                            }
                                            $(item)
                                                .find('span.auto-list-stationlist')
                                                .append(_html.concat("</span>"));
                                        }
                                        if(value.NextDepTime!='FF')
                                        {
                                           
                                            $(item).find('span.auto-list-stationlist-position').addClass('auto-list-stationlist-position-now').html('預計'+value.NextDepTime+'發車');
                                        }
                                        else{
                                            FormatETA($(item).find('span.auto-list-stationlist-position'), value.ETA);
                                        }
                                    }else
                                    {
                                        if (jsonObjArr[0].UniRouteId[9] =='0')
                                        {
                                            FormatETA($(item).find('span.auto-list-stationlist-position'), 65535);
                                        }else
                                        {
                                            FormatETA($(item).find('span.auto-list-stationlist-position'), 65529);
                                        }
                                    }

                                    return item;
                                });

                            } else {

                                //取得返程站位及站序
                                $.each( $('#BackDirectionRoute li  '), function( index, item ){
                                    var uniStopId = $(item).find('input#item_UniStopId').val();
                                    var stopSeq =parseInt($(item).find('.auto-list-stationlist-number').text().trim());
                                    backStationList.push({ stopSeq: stopSeq, uniStopId: uniStopId });
                                });

                                //取得相同站牌編號
                                $.grep(jsonObjArr,function(item) {

                                    if (($.inArray(item.UniStationId, uniStation) === -1)) {
                                        //未重複
                                        uniStation.push(item.UniStationId);
                                    } else {
                                        //有重複
                                        tempduplicate.push(item.UniStationId);
                                    }
                                });

                                //重複站排項目
                                duplicateStation = unique(tempduplicate);

                                //取得有重複的站位及公車編號
                                filterDuplicate = $.grep(jsonObjArr,function(item) {

                                    //取得有重複站位
                                    if (($.inArray(item.UniStationId, duplicateStation) !== -1)) {

                                        //確定該站位，有在站位列表中
                                        var result = $.grep(backStationList,function(e) { return e.uniStopId === item.UniStationId; });

                                        if (result && result.length > 0) {

                                            //在資料內找出該站位的進站公車，是否有重複
                                            if (item.Vehicles && item.Vehicles.length > 0) {

                                                //依據該公車編號，取得是否有重複的
                                                var busIdDuplicate = $.grep(item.Vehicles,function(value) {

                                                    var getVehicles = $.grep(jsonObjArr,function(data) {

                                                        //找出有重複的公車編號
                                                        var filterVehicles = $.grep(data.Vehicles,function(vehicles) {
                                                            return value.UniBusId === vehicles.UniBusId;
                                                        });

                                                        //若相同公車編號找尋結果，有2筆以上，則回傳該項目
                                                        if (filterVehicles && filterVehicles.length > 0) {
                                                            return data;
                                                        }
                                                    });

                                                    if (getVehicles && getVehicles.length > 0) {
                                                        return value;
                                                    }
                                                });

                                                if (busIdDuplicate && busIdDuplicate.length > 0) {
                                                    return item;
                                                }


                                            }


                                        }

                                    }
                                });

                                hasSeq = jsonObjArr[0].UniRouteId[9] =='0' ?hasSeq:false;
                                //返程
                                $('#BackDirectionRoute li').map(function(index, item) {

                                    var _UniStopId = $(item).find('input#item_UniStopId').val();

                                  if ($('.stationlist-come-go-c').length === 0)
                                    { var _StopSeq =parseInt($(item).find('.auto-list-stationlist-number').text().trim()) +objArr.BackDirStops.length;
                                    }
                                    else
                                    {
                                        var _StopSeq =parseInt($(item).find('.auto-list-stationlist-number').text().trim()) +objArr.GoDirStops.length;
                                    }

                                    var tmp = jsonObjArr.filter(function(item) {
                                        if (hasSeq) {
                                            if (item.UniStationId == _UniStopId &&
                                                item.StopSequence == (_StopSeq - 1))
                                                return true;
                                        } else {
                                            if (item.UniStationId == _UniStopId)
                                                return true;
                                        }
                                    });

                                    if (tmp && tmp.length > 0) {

                                        var value = tmp[0];

                                        //依據有重複的站位及公車編號，取得下一站位的等待時間
                                        var  filterBusId = filterDuplicate.filter(function(item) {
                                            if (item.UniStationId === value.UniStationId) {
                                                return true;
                                            }
                                            return false;
                                        }).map(function(dirItem) {

                                            var nextStation = jsonObjArr.filter(function (station) {
                                                if ( station.StopSequence ===( parseInt(dirItem.StopSequence) +1)) {

                                                    return true;
                                                }
                                                return false;
                                            });

                                            if (nextStation && nextStation.length > 0 ) {
                                                dirItem.NextETA = nextStation[0].ETA;
                                            }

                                            return dirItem;

                                        });

                                        //若公車站編號相同超過1個以上，表示有重複
                                        if (filterBusId && filterBusId.length > 1) {

                                            //車號編號
                                            var busArray= [];
                                            //重複車號編號
                                            var tempbusArray= [];

                                            //取得重複車號
                                            $.each(filterBusId , function(index, item) {
                                                $.each(item.Vehicles , function(iVehicles, vehicles) {

                                                    if (($.inArray(vehicles.UniBusId, busArray) !== -1)) {
                                                        //未重複
                                                        busArray.push(vehicles.UniBusId);
                                                    } else {
                                                        //有重複
                                                        tempbusArray.push(vehicles.UniBusId);
                                                    }
                                                });
                                            });

                                            //過濾收集重複車號項目
                                            var duplicateBus = unique(tempbusArray);

                                            if (duplicateBus.length > 0 ) {

                                                //依進站時間排序
                                                filterBusId.sort(function (a, b) {
                                                    if (a.NextETA> b.NextETA) {
                                                        return 1;
                                                    }
                                                    if (a.ETA< b.ETA) {
                                                        return -1;
                                                    }
                                                    // a must be equal to b
                                                    return 0;
                                                });

                                                for (var i = 0; i < filterBusId.length; i++) {

                                                    if (i !==0) {
                                                        filterBusId[i].Vehicles =  $.grep(filterBusId[i].Vehicles, function(iVehicles, vehicles) {

                                                            if (($.inArray(vehicles.UniBusId, duplicateBus) === -1)) {
                                                                //未重複
                                                                return vehicles;
                                                            }

                                                        });
                                                    }
                                                }

                                            }
                                        }


                                        if (value.Vehicles.length > 0) {
                                            var _html = "<span class='auto-list-stationlist-bus'>";
                                            for (var i = 0; i < value.Vehicles.length; i++) {
                                                var dogimg=""
                                                if($('#doglink').attr('dognum')!=null)
                                                { if (value.Vehicles[i].BusLicence.indexOf($('#doglink').attr('dognum')) > -1) {
                                                    value.Vehicles[i].BusLicence=value.Vehicles[i].BusLicence.replace($('#doglink').attr('dognum'), '');
                                                    dogimg="<img src='" +
                                                        SitePath +
                                                        "images/stationlist_dogwhite_bus.png' class='bus-number-img' alt=''>";
                                                }
                                                }
                                                if (value.Vehicles[i].BusType == 2) {
                                                    _html =
                                                        _html +
                                                        "<p class='bus-number'><img src='" +
                                                        SitePath +
                                                        "images/stationlist_accessibility_bus.svg' class='bus-number-img' alt='" +
                                                        i18n._('Accessibility Bus') +
                                                       "'>" +
                                                                                                               value.Vehicles[i].BusLicence +setSeatImg(value.Vehicles[i].bSetL)+
                                                        "</p>";
                                                } else {
                                                    _html =
                                                        _html +
                                                        "<p class='bus-number'>" +
                                                                                                                value.Vehicles[i].BusLicence +setSeatImg(value.Vehicles[i].bSetL)+
                                                        "</p>";
                                                }
                                            }
                                            $(item)
                                                .find('span.auto-list-stationlist')
                                                .append(_html.concat("</span>"));
                                        }

                                        //轉為時間
                                        if(value.NextDepTime!='FF')
                                        {
                                            $(item).find('span.auto-list-stationlist-position').addClass('auto-list-stationlist-position-now').html('預計'+value.NextDepTime+'發車');
                                        }
                                        else{
                                            FormatETA($(item).find('span.auto-list-stationlist-position'), value.ETA);
                                        }
                                    }else{
                                        //if( jsonObjArr[0].UniRouteId[9] !='0')
                                        //    FormatETA($(item).find('span.auto-list-stationlist-position'), 65529);
                                        if (jsonObjArr[0].UniRouteId[9] =='0')
                                        {
                                            FormatETA($(item).find('span.auto-list-stationlist-position'), 65535);
                                        }else
                                        {
                                            FormatETA($(item).find('span.auto-list-stationlist-position'), 65529);
                                        }
                                    }

                                    return item;
                                });
                            }

                        }
                        else{
                            //去程
                            $('#GoDirectionRoute li').map(function(index, item) {
                                FormatETA($(item).find('span.auto-list-stationlist-position'), 65529);
                                return item;
                            });

                            //返程
                            $('#BackDirectionRoute li').map(function(index, item) {
                                FormatETA($(item).find('span.auto-list-stationlist-position'), 65529);
                                return item;
                            });
                        }

                    }

                });
                if (stopFetchInterval === null) {
                    stopFetchInterval = window.setInterval(startFatch, 1000 * 15);
                }
            })();

        }

        function setSeatImg(lv)
        {
            var s = '';
            if (lv>-1)
            {
                //s = '<img src=\"../images/seats/seat'+lv+'.png\" class="bus-number-img" >';
                s = '&ensp;<img width="20px" src=\"../images/seats/people'+lv+'_B.svg\" class="bus-number-img" >';
            }
            return s;
        }

        function stopStationStatusReport() {
            clearInterval(stopFetchInterval);
            stopFetchInterval = null;
        }

        function shownewchart(_id) {

            AptsBusMap.init({
                AptsSpringWebHome: SitePath,
                uniRouteId: _id,
                goBack: 0
            });
            AptsBusMap.load('myMap');

            $('.route-list').hide();
            $('.route-chart').show();

        }

        function hidenewchart() {
            $('.route-list').show();
            $('.route-chart').hide();
            //clearInterval(AptsBusMap.......interval);//沒有停止方法
        }

        function toggleRouteListAndChart() {
            if ($('.route-chart').is(":visible")) {
                $('.route-list').toggle();
                $('.route-chart').toggle();
                google.maps.event.trigger(map, "resize");
                $('.route-chart').html('');
                busStatusReport();
                stationStatusReport();
            } else {
                stopBusStatusReport();
                stopStationStatusReport();
                $('.route-chart')
                    .html('<button onclick="toggleRouteListAndChart()">back</button><div id="myMap" class="left" style="width:900px;margin-top:30px;"></div>');
                shownewchart('0454065500');

            }
        }

        function FormatETA(elem, eta) {
            if (eta < 0) {
                elem.addClass('auto-list-stationlist-position-none').html(ConvertETA(eta));
                return;
            }
            if (eta >= 0 && eta <= 180) {
                elem.addClass('auto-list-stationlist-position-now').html(ConvertETA(eta));
                return;
            }
            if ( eta === 65535 ||
                 eta === 65529 ||
                 eta === 65534 ||
                eta === 65532 ||
                eta === 65533 ||
                eta === 65531 ||
                eta === 65530
               ) {
                elem.addClass('auto-list-stationlist-position-none').html(ConvertETA(eta));
                return;
            }
            elem.addClass('auto-list-stationlist-position-time').html(ConvertETA(eta) + i18n._('Mins'));
        }


        function addToMyBus(routeid, stopid, groupid) {
            $.ajax({
                url: '/MyBus/NewContentOfGroup',
                type: 'post',
                dataType: 'html',
                data: {
                    '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                    'X-Requested-With': 'XMLHttpRequest',
                    'unirouteid': routeid,
                    'unistationid': stopid,
                    'groupid': groupid
                },
                beforeSend: function() {
                    $('#ProcessIconSpan').show();
                },
                error: function(response) {
                    toastr["warning"](i18n._('Added Failure'), "");
                },
                success: function(response) {
                    toastr["info"](i18n._('Added Success'), "");
                },
                complete: function() {
                    $('#ProcessIconSpan').hide();
                }
            });
        }

        var routeJsonString = JSON.stringify({"UniRouteId":"0454065500","Name":"F655","BeginStop":"鶯歌區公所","GoDirStops":[{"UniStopId":"2394105760","Name":"鶯歌區公所","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.354322,"Latitude":24.955716,"PublicId":"2394105760"},{"UniStopId":"2394301160","Name":"林長壽圖書館","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.34916,"Latitude":24.95714,"PublicId":"2394301160"},{"UniStopId":"2394300260","Name":"中山路249巷","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.345631,"Latitude":24.957108,"PublicId":"2394300260"},{"UniStopId":"2394300360","Name":"中山路292號","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.3440394,"Latitude":24.957039,"PublicId":"2394300360"},{"UniStopId":"2394102800","Name":"余厝巷口","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.342772,"Latitude":24.961765,"PublicId":"2394102800"},{"UniStopId":"2394100400","Name":"大湖路148號","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.342796,"Latitude":24.964552,"PublicId":"2394100400"},{"UniStopId":"2394101910","Name":"名湖社區","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.345167,"Latitude":24.970288,"PublicId":"2394101910"},{"UniStopId":"2394102320","Name":"鶯歌幼兒園","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.346246,"Latitude":24.971586,"PublicId":"2394102320"},{"UniStopId":"2394100520","Name":"大湖路358號","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.346362,"Latitude":24.972515,"PublicId":"2394100520"},{"UniStopId":"2394100920","Name":"中湖街70號","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.347966,"Latitude":24.972732,"PublicId":"2394100920"},{"UniStopId":"2394100260","Name":"大竹圍","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.347457,"Latitude":24.977766,"PublicId":"2394100260"},{"UniStopId":"3337800120","Name":"長庚醫院(分院)","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.366444,"Latitude":25.029849,"PublicId":"3337800120"},{"UniStopId":"3337500340","Name":"長庚醫院","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.3678435,"Latitude":25.059661,"PublicId":"3337500340"}],"LastStop":"長庚醫院(總院)","BackDirStops":[{"UniStopId":"3337500340","Name":"長庚醫院","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.3678435,"Latitude":25.059661,"PublicId":"3337500340"},{"UniStopId":"3337800120","Name":"長庚醫院(分院)","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.366444,"Latitude":25.029849,"PublicId":"3337800120"},{"UniStopId":"2394100220","Name":"大竹圍","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.347433,"Latitude":24.977619,"PublicId":"2394100220"},{"UniStopId":"2394100960","Name":"中湖街70號","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.347204,"Latitude":24.972882,"PublicId":"2394100960"},{"UniStopId":"2394102340","Name":"鶯歌幼兒園","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.346124,"Latitude":24.971618,"PublicId":"2394102340"},{"UniStopId":"2394101960","Name":"名湖社區","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.345214,"Latitude":24.970548,"PublicId":"2394101960"},{"UniStopId":"2394100450","Name":"大湖路148號","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.342634,"Latitude":24.964371,"PublicId":"2394100450"},{"UniStopId":"2394102840","Name":"余厝巷口","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.342625,"Latitude":24.962079,"PublicId":"2394102840"},{"UniStopId":"2394300320","Name":"中山路292號","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.34399,"Latitude":24.956926,"PublicId":"2394300320"},{"UniStopId":"2394300220","Name":"中山路249巷","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.345616,"Latitude":24.95692,"PublicId":"2394300220"},{"UniStopId":"2394301120","Name":"林長壽圖書館","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.349945,"Latitude":24.956931,"PublicId":"2394301120"},{"UniStopId":"2394105731","Name":"鶯歌區公所","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.354072,"Latitude":24.955708,"PublicId":"2394105731"}],"RouteMapUrl":"../MapOverview?nid=0454065500","RouteTracks":null,"StopDirection":null,"TicketPrice":"","BusTimeDesc":"0700 - 1640","HeadwayDesc":"F655長庚醫院(總院)班表:0800 1015 1215 1415 1545 1750;F655鶯歌區公所班表:0700 0930 1130 1330 1500 1640","HolidayBusTimeDesc":"0700 - 1640","HolidayHeadwayDesc":"F655長庚醫院(總院)班表:0800 1015 1215 1415 1545 1750;F655鶯歌區公所班表:0700 0930 1130 1330 1500 1640","RouteNote":"","SegmentBuffer":"","StopLng":0,"StopLat":0,"IsNtpcMainLine":false,"orgphone":"鶯歌區公所鶯歌區公所站:(02)2678 0202","aliasName":null,"aliasEname":null,"memo":null,"memoEn":null,"showBusTimeDesc":true,"RouteStatus":1,"wkt":"LINESTRING (121.354296854501 24.9556370249853, 121.353595332742 24.9564269902172, 121.353524321559 24.9565630205243, 121.353522030876 24.9571491952051, 121.351335776821 24.9571093746028, 121.349191780438 24.9570920835343, 121.34288495665 24.9570328950475, 121.342981165349 24.9588012686141, 121.342955967832 24.9594897125222, 121.3429193169 24.9600930063563, 121.342960549199 24.9607435427798, 121.342903282117 24.96113604354, 121.342788747952 24.9613816154691, 121.342653597637 24.9623607832366, 121.342531618752 24.9633321556525, 121.342561397635 24.9639115489111, 121.342779012548 24.9645189743986, 121.342985174045 24.9651341843364, 121.343313314427 24.9659222715611, 121.343865941772 24.9662836063086, 121.344056068486 24.9664725798058, 121.344179765384 24.9667804398541, 121.344218707 24.9669611061006, 121.343898011338 24.968512332956, 121.343936952954 24.968780732673, 121.344392798931 24.9697385566778, 121.344613277198 24.9699758051572, 121.345016901397 24.9702251468236, 121.345261513804 24.9704497977882, 121.345374356723 24.9707244067691, 121.345486600205 24.9708614595529, 121.34608045985 24.9713022078113, 121.346243098364 24.9716121323197, 121.346375957995 24.9719075202785, 121.346412608928 24.9720881789969, 121.346293493396 24.9726348257447, 121.346183540598 24.9728736260308, 121.347415355541 24.9728196364414, 121.347882654934 24.972778105972, 121.348781175457 24.9728881616854, 121.348978174221 24.9729463042867, 121.34967969598 24.973563548601, 121.349333802803 24.9739778117614, 121.349251338204 24.9741190139233, 121.349195216463 24.9751551836532, 121.349152552487 24.9752893763391, 121.349035727639 24.9754368064325, 121.348649747503 24.9757799440997, 121.348422969857 24.9760213338668, 121.348387464265 24.9761389138722, 121.34840464439 24.9763579809554, 121.348422969857 24.9768044197751, 121.348339359916 24.9769404275586, 121.347996330092 24.9772399556203, 121.347822238162 24.9775036642978, 121.346891648072 24.9781291914784, 121.34638254371 24.978200309305, 121.346163783455 24.9785932734887, 121.346161492771 24.9788707355543, 121.346481043091 24.9792278794434, 121.345987114505 24.9795045614235, 121.345378284465 24.9798987293078, 121.345065400814 24.9801287806778, 121.344992957954 24.9802268905261, 121.344839482174 24.9806704602656, 121.344394803278 24.9817719805396, 121.345191388395 24.9825817629496, 121.345852250526 24.9832054474974, 121.345958194629 24.9834566853228, 121.345929561088 24.9835470062338, 121.345794410773 24.9838223807856, 121.345102338082 24.9842700902156, 121.344428304522 24.9851618706344, 121.343729073445 24.9861849704704, 121.343644318163 24.9863842948661, 121.34365577158 24.9865825807933, 121.343711893321 24.9869490455658, 121.343835590219 24.9873814310668, 121.343879809173 24.9876231541406, 121.343860787735 24.9878735077941, 121.343814206787 24.9881099571415, 121.343417540517 24.9884579761158, 121.3434473194 24.9885150732274, 121.343446174058 24.9885752846981, 121.34342670325 24.9886168098332, 121.34419436849 24.9892965223938, 121.344780210743 24.9898096133494, 121.344601537446 24.9901267580285, 121.344202958552 24.9907491066653, 121.343717333693 24.991397404772, 121.343302017271 24.9918764628255, 121.343198493927 24.9920026183333, 121.341994739854 24.9930459040114, 121.341806903824 24.9932203031415, 121.341219916229 24.9940767238495, 121.340300779556 24.9953234541161, 121.339626173325 24.9963838396395, 121.339161164615 24.9971774359368, 121.339539127359 24.9974270881269, 121.339941714949 24.9977701644256, 121.340351935298 24.9981654120164, 121.340622620559 24.9984415220061, 121.341398589526 24.9993804303212, 121.342340633032 25.000477111823, 121.342758682734 25.0014702411214, 121.343290693929 25.0016280200044, 121.34626457352 25.0016633126216, 121.346977548696 25.0017172895459, 121.34762145498 25.0018224218612, 121.348117163636 25.0018714350548, 121.349437742557 25.0018402945636, 121.349547840931 25.0025061318703, 121.350120938851 25.0029878164534, 121.350772065578 25.0037170140748, 121.351136856893 25.0042635202019, 121.351661423368 25.0053544491888, 121.351986700396 25.0060633921379, 121.353204198569 25.0071252419321, 121.353770570014 25.0079268130792, 121.354179170647 25.0084787497695, 121.355120641482 25.0094648082045, 121.356417740899 25.01092312222, 121.356919466759 25.0110638190079, 121.358878507431 25.0123450914534, 121.359970018022 25.0131826962813, 121.360144109953 25.0134234936379, 121.360501456547 25.0146394092847, 121.360622862762 25.0148428391519, 121.361035758426 25.0153021119749, 121.361357026759 25.0156954764846, 121.362104362184 25.0172746302946, 121.362486906295 25.0195019135959, 121.362457127412 25.0201775633098, 121.363438685205 25.0216217391307, 121.365728795831 25.0232838435598, 121.367508656753 25.0245302773832, 121.367820189682 25.024654816287, 121.368348192182 25.0247762415965, 121.368139740002 25.0265509054885, 121.368201588451 25.0269271101806, 121.367919261734 25.0269686223519, 121.367678739988 25.0269333370072, 121.367509229424 25.0268399345753, 121.367023604565 25.0263791482042, 121.366823742447 25.0263480139276, 121.366615290267 25.0263708457312, 121.36644348902 25.026480853453, 121.366347280321 25.0266406758164, 121.366289619337 25.0269338183351, 121.366232173486 25.0270563167674, 121.366060372239 25.0272099115692, 121.365840466642 25.0272825576922, 121.365466512594 25.0272721796773, 121.365319908863 25.0273552037723, 121.365221409481 25.0274989391039, 121.365196211965 25.0276566845449, 121.365237444264 25.027785371465, 121.365342815696 25.0279036802885, 121.36549858216 25.0279514189044, 121.36588799832 25.0279887795473, 121.366087860438 25.0281740259003, 121.366126802054 25.0283629042468, 121.366092441805 25.0285081950848, 121.365981916336 25.0286415511668, 121.365831303909 25.0287323577545, 121.365697871607 25.0287411789623, 121.365548977192 25.0287266499139, 121.365150398299 25.0285564523608, 121.365042736184 25.0285668302671, 121.364937364752 25.028614568625, 121.36485948152 25.0287058941273, 121.36483886537 25.0288325043705, 121.365200793331 25.0293358306844, 121.365661220674 25.0297986815138, 121.366025439318 25.0294831959361, 121.366355297713 25.0294831959361, 121.366538552377 25.0296471655152, 121.36658952008 25.0298241071254, 121.366562031881 25.0299714717907, 121.366532252998 25.0300835518401, 121.366422300199 25.0301831784649, 121.366362742434 25.0302080851084, 121.36615199957 25.0302205384283, 121.366113057954 25.0302848805608, 121.366237514619 25.0305582778457, 121.366289440568 25.0309127334703, 121.366289440568 25.0314611940854, 121.366449788399 25.0321528632482, 121.366465823182 25.032971653361, 121.366417718833 25.0332378368025, 121.366391351246 25.0335140490061, 121.366468113865 25.0339357224206, 121.366724670395 25.0344618580984, 121.366637624429 25.0345324244476, 121.365135296975 25.0373324409604, 121.363897932543 25.0398036865428, 121.363187392961 25.0411975338667, 121.362931298855 25.0416459267873, 121.362201716224 25.0426789328273, 121.361229893836 25.0441062412699, 121.360473968348 25.0460736272014, 121.359880108703 25.0477104972925, 121.359794061737 25.0477910543338, 121.359348097507 25.0483112827975, 121.359242726075 25.0483797659324, 121.359235854025 25.0502562927054, 121.359180877626 25.0516482347059, 121.359057180728 25.0524585939583, 121.358848155877 25.0534510432861, 121.360306175796 25.0543874556969, 121.361904500067 25.0554426619955, 121.362950196992 25.0561077381907, 121.36421350883 25.0569159928582, 121.364426542377 25.0571089771382, 121.367102060468 25.0588416718446, 121.370274656835 25.0609291732874, 121.370140079191 25.0610858382136, 121.368887075427 25.0602397414805, 121.36726298097 25.0591819826571, 121.365839893971 25.0582186308503, 121.364058315037 25.0570430927542, 121.362925572146 25.0563152495254, 121.361687457824 25.0555173665218, 121.360419564619 25.0547236286011, 121.358842429169 25.0536829422061, 121.358608779473 25.0535708837224, 121.358824103703 25.05268634441, 121.358966126067 25.0516165880452, 121.359027974516 25.0498381363375, 121.359037137249 25.048375096629, 121.359243298746 25.0483481184279, 121.359341798128 25.0482817105229, 121.359767865221 25.0477711985524, 121.359839449074 25.0476233364566, 121.360327937287 25.0462770049595, 121.360754577051 25.0451719125678, 121.361169190728 25.0440792621295, 121.361971502553 25.0429092956195, 121.362892929909 25.0415795152525, 121.363420359738 25.0406694660666, 121.363945498884 25.0395996048533, 121.365108020658 25.0372746220969, 121.366034029381 25.0355187924777, 121.366587229397 25.0344815751707, 121.366355870384 25.033918599624, 121.366303184668 25.0336633140086, 121.366300893985 25.0334827458136, 121.366314638084 25.0332850544677, 121.366353579701 25.0329301432207, 121.366346707651 25.0323147537419, 121.366328382184 25.0320942297795, 121.366211557336 25.0315084124343, 121.366188650503 25.0313169445113, 121.36618635982 25.0308810814584, 121.366135964787 25.0306875370112, 121.366076407022 25.0304088947373, 121.365997951119 25.030294220545, 121.365665802041 25.0299206206234, 121.365988788385 25.0295989086682, 121.366057508884 25.0295553218223, 121.366316356097 25.0295553218223, 121.366444634362 25.0296362688095, 121.366467541195 25.0297691047754, 121.366458378461 25.0299600562244, 121.366433180945 25.0300596829493, 121.366375913863 25.0301240251662, 121.366320937464 25.0301406296038, 121.366036892735 25.0301634607018, 121.365938393353 25.0302132739919, 121.365523779676 25.0298085404251, 121.365266650476 25.0295527273667, 121.364752964747 25.0289482177162, 121.36472776723 25.0287738693151, 121.36474151133 25.0286410322719, 121.364810231829 25.0285061195027, 121.364954544877 25.0284417764374, 121.36518590389 25.0284168694353, 121.365426425636 25.0285434799767, 121.365703598315 25.0286202764709, 121.365857074096 25.0286098985691, 121.365953282794 25.028510270667, 121.36599909646 25.0283213925473, 121.365957864161 25.0281761014881, 121.365742539931 25.0280702464653, 121.365421844269 25.0280551984399, 121.365236298922 25.0279597212705, 121.36514467159 25.0278720275005, 121.365082823141 25.0277329626953, 121.365073660408 25.0276208804988, 121.365085113825 25.0274631350118, 121.365227136189 25.0272778875857, 121.365499727502 25.0271554269487, 121.36583187658 25.0271658049735, 121.365996805777 25.0271263684746, 121.366150281558 25.0269956052557, 121.366210411994 25.0267169545983, 121.366237900194 25.0265633591796, 121.366302039326 25.0264616539992, 121.366424018212 25.0263391925478, 121.366552296477 25.0262748483464, 121.366698900208 25.0262374871817, 121.366882154871 25.0262416384228, 121.367010433136 25.0262644702462, 121.367169062954 25.0263620243531, 121.367586539985 25.0267522400052, 121.367742306449 25.026818659567, 121.367861421981 25.0268414912831, 121.36810423441 25.0267729961221, 121.368072164844 25.0265426030272, 121.368255992179 25.0248883263911, 121.36752068284 25.0246849131699, 121.366486439332 25.0239304132264, 121.36519277594 25.023049292566, 121.363306398244 25.0216736315857, 121.362301933619 25.0201920933704, 121.362352328651 25.0195039893304, 121.362086609389 25.0180037430934, 121.361969784541 25.0172990206149, 121.361205841661 25.0157157155216, 121.360456215552 25.0148184483438, 121.360380050332 25.0146679517609, 121.360066226721 25.0136290013533, 121.359889844107 25.0132968675007, 121.359747249072 25.0131759497969, 121.3587593919 25.0124109998471, 121.356907374454 25.0111665188516, 121.356402851458 25.0110455990502, 121.356317523505 25.0109957779815, 121.354043447662 25.0085124834783, 121.353919178093 25.0084019406749, 121.353071052602 25.0072030897963, 121.352880925888 25.0070266345666, 121.351899940766 25.0061536964365, 121.351831220268 25.0060618351667, 121.351026617759 25.0043621297855, 121.350616585449 25.0037351790849, 121.350001536984 25.0030573628902, 121.349591504674 25.0027521886812, 121.349424284793 25.0025300545965, 121.349308605287 25.0020162382356, 121.348222821404 25.0020266183854, 121.347913006488 25.0020328464748, 121.346920567949 25.0018605358838, 121.346211601469 25.0018231672901, 121.343653480897 25.0018086350561, 121.343345956664 25.0017795705829, 121.343201643616 25.0017525821374, 121.342894692054 25.0016633126216, 121.342763550436 25.0016212728854, 121.342305413776 25.0004955368191, 121.34202308706 25.0001768618502, 121.340565067141 24.9984267298609, 121.340329126762 24.9981900552942, 121.339888742898 24.9977660122221, 121.3395079168 24.9974457730938, 121.33909101244 24.9971738027411, 121.33927884847 24.9968348770127, 121.339592672082 24.9963049468564, 121.340014157808 24.9956421416718, 121.340234636076 24.9952845264265, 121.340679601306 24.9947130665234, 121.341195577719 24.9940061342472, 121.341804899476 24.9931247988867, 121.342552234902 24.9924640527429, 121.343152966596 24.9919590181421, 121.343710175308 24.9913044943646, 121.344205535571 24.9906162284887, 121.344574908253 24.9900317704282, 121.344698605151 24.9897930034583, 121.34339864238 24.9886495108672, 121.343316177781 24.9886640446573, 121.343263492065 24.9886640446573, 121.3432039343 24.9886162907692, 121.343171864733 24.9885311642268, 121.343213097033 24.9884605714397, 121.343277236165 24.9884356563287, 121.343380316913 24.9884356563287, 121.343790349224 24.9880842489125, 121.343827000156 24.9878844082057, 121.343845325623 24.9875958065077, 121.34380867469 24.9873918124528, 121.343657489592 24.9868057818472, 121.34360022251 24.9863630128497, 121.343719338041 24.9861237196797, 121.344063513207 24.9856539562453, 121.344420859801 24.9851078864391, 121.345014719446 24.9843183648743, 121.345333697095 24.9840603807262, 121.345762627543 24.9838003196992, 121.345918394007 24.9834655097826, 121.345813022575 24.9832142719752, 121.344836046149 24.9822825074431, 121.344342976569 24.9817753546442, 121.344758162917 24.9807693483277, 121.344964897084 24.9801827670591, 121.345084012616 24.9800727178723, 121.345888042453 24.9795266232808, 121.346417762966 24.9792167187126, 121.34612226482 24.978877743475, 121.346113102087 24.9786846361838, 121.346131427553 24.9785558978212, 121.346312391534 24.9782148443303, 121.346378821349 24.9781712392495, 121.346907969191 24.9780777997388, 121.347786446236 24.9774849763, 121.347926177917 24.9772773316878, 121.34797714562 24.9771999839801, 121.348309294698 24.9769217394752, 121.34838717793 24.9767820978727, 121.348357399047 24.976301916431, 121.348350526997 24.976123340368, 121.348375724514 24.9760091346104, 121.348494840045 24.9758762405045, 121.349001653725 24.9754147438419, 121.349120769256 24.9752693902037, 121.349159710872 24.9751240363939, 121.349171164289 24.9749428630118, 121.349216977955 24.9741216095499, 121.349260500937 24.9739949429147, 121.349593222686 24.9735895049804, 121.348953549375 24.9730028894706, 121.348813817694 24.9729530529798, 121.348188461154 24.9728637625499, 121.34776182139 24.9728450738471, 121.347433681008 24.9728741451614, 121.346090767925 24.9729338451602, 121.346219046189 24.9726353448763, 121.346308382838 24.9722755861803, 121.346331289671 24.9720783154531, 121.346278603955 24.9718805252749, 121.34600372196 24.9713255689825, 121.345400699582 24.9708656126653, 121.345299336846 24.9707280407465, 121.345207709514 24.970472623795, 121.344971769134 24.9702670439123, 121.344790232483 24.9701730792556, 121.344508478437 24.9699654223012, 121.344302316941 24.9697183100687, 121.34390602873 24.9688928685517, 121.343853343014 24.9687220689552, 121.343835017548 24.9685061031685, 121.343938098296 24.9679698211021, 121.344153422526 24.966967855122, 121.34412135296 24.9667970528535, 121.343977039912 24.966493865264, 121.343835017548 24.966327215603, 121.343241157903 24.9659529019904, 121.342800774039 24.9648512400635, 121.342711437391 24.9645470093488, 121.342477787694 24.9639032422171, 121.342466334278 24.9633560375075, 121.342519019994 24.9627657389971, 121.342690821241 24.9616349745781, 121.342720600124 24.9613395619601, 121.342809936772 24.9611277366587, 121.342878657271 24.9605810387919, 121.342858041122 24.9601527125561, 121.342851169072 24.9600109751825, 121.342899273421 24.9593500511358, 121.342899273421 24.9588884924898, 121.342899273421 24.9584269321131, 121.342878657271 24.9580401338393, 121.342837424972 24.9575308043257, 121.342835134289 24.9569010188431, 121.343721628725 24.9569010188431, 121.345780380338 24.9569321707152, 121.348905445026 24.9569529386255, 121.351551184234 24.9569799369037, 121.353467913483 24.957004858386, 121.353486811621 24.9565619821257, 121.353560113486 24.9564124526182, 121.353887681198 24.9560464160784, 121.354266216612 24.9556014595567)","wkt0":"LINESTRING (121.354296854501 24.9556370249853, 121.353595332742 24.9564269902172, 121.353524321559 24.9565630205243, 121.353523216662 24.9571066134689, 121.351329403211 24.9570827352273, 121.349189315804 24.9570648265461, 121.34286456655 24.9569902070409, 121.342981165349 24.9588012686141, 121.342955967832 24.9594897125222, 121.3429193169 24.9600930063563, 121.342960549199 24.9607435427798, 121.342903282117 24.96113604354, 121.342769053584 24.9613763415522, 121.342625784134 24.9623672885802, 121.342512362486 24.9633224182458, 121.342530271167 24.9639283286274, 121.342779012548 24.9645189743986, 121.342985174045 24.9651341843364, 121.343313314427 24.9659222715611, 121.343865941772 24.9662836063086, 121.344056068486 24.9664725798058, 121.344179765384 24.9667804398541, 121.344218707 24.9669611061006, 121.343898011338 24.968512332956, 121.343936952954 24.968780732673, 121.344392798931 24.9697385566778, 121.344613277198 24.9699758051572, 121.345016901397 24.9702251468236, 121.345261513804 24.9704497977882, 121.345374356723 24.9707244067691, 121.345486600205 24.9708614595529, 121.34608045985 24.9713022078113, 121.346243098364 24.9716121323197, 121.346375957995 24.9719075202785, 121.346412608928 24.9720881789969, 121.346293493396 24.9726348257447, 121.346183540598 24.9728736260308, 121.347415355541 24.9728196364414, 121.347882654934 24.972778105972, 121.348781175457 24.9728881616854, 121.348978174221 24.9729463042867, 121.34967969598 24.973563548601, 121.349333802803 24.9739778117614, 121.349251338204 24.9741190139233, 121.349195216463 24.9751551836532, 121.349152552487 24.9752893763391, 121.349035727639 24.9754368064325, 121.348649747503 24.9757799440997, 121.348422969857 24.9760213338668, 121.348387464265 24.9761389138722, 121.34840464439 24.9763579809554, 121.348422969857 24.9768044197751, 121.348339359916 24.9769404275586, 121.347996330092 24.9772399556203, 121.347822238162 24.9775036642978, 121.346891648072 24.9781291914784, 121.34638254371 24.978200309305, 121.346163783455 24.9785932734887, 121.346161492771 24.9788707355543, 121.346481043091 24.9792278794434, 121.345987114505 24.9795045614235, 121.345378284465 24.9798987293078, 121.345065400814 24.9801287806778, 121.344992957954 24.9802268905261, 121.344839482174 24.9806704602656, 121.344394803278 24.9817719805396, 121.345191388395 24.9825817629496, 121.345852250526 24.9832054474974, 121.345958194629 24.9834566853228, 121.345929561088 24.9835470062338, 121.345794410773 24.9838223807856, 121.345102338082 24.9842700902156, 121.344428304522 24.9851618706344, 121.343729073445 24.9861849704704, 121.343644318163 24.9863842948661, 121.34365577158 24.9865825807933, 121.343711893321 24.9869490455658, 121.343835590219 24.9873814310668, 121.343879809173 24.9876231541406, 121.343860787735 24.9878735077941, 121.343814206787 24.9881099571415, 121.343417540517 24.9884579761158, 121.3434473194 24.9885150732274, 121.343446174058 24.9885752846981, 121.34342670325 24.9886168098332, 121.34419436849 24.9892965223938, 121.344780210743 24.9898096133494, 121.344601537446 24.9901267580285, 121.344202958552 24.9907491066653, 121.343717333693 24.991397404772, 121.343302017271 24.9918764628255, 121.343198493927 24.9920026183333, 121.341994739854 24.9930459040114, 121.341806903824 24.9932203031415, 121.341219916229 24.9940767238495, 121.340300779556 24.9953234541161, 121.339626173325 24.9963838396395, 121.339161164615 24.9971774359368, 121.339539127359 24.9974270881269, 121.339941714949 24.9977701644256, 121.340351935298 24.9981654120164, 121.340622620559 24.9984415220061, 121.341398589526 24.9993804303212, 121.342340633032 25.000477111823, 121.342758682734 25.0014702411214, 121.343290693929 25.0016280200044, 121.34626457352 25.0016633126216, 121.346977548696 25.0017172895459, 121.34762145498 25.0018224218612, 121.348117163636 25.0018714350548, 121.349437742557 25.0018402945636, 121.349547840931 25.0025061318703, 121.350120938851 25.0029878164534, 121.350772065578 25.0037170140748, 121.351136856893 25.0042635202019, 121.351661423368 25.0053544491888, 121.351986700396 25.0060633921379, 121.353204198569 25.0071252419321, 121.353770570014 25.0079268130792, 121.354179170647 25.0084787497695, 121.355120641482 25.0094648082045, 121.356417740899 25.01092312222, 121.356919466759 25.0110638190079, 121.358878507431 25.0123450914534, 121.359970018022 25.0131826962813, 121.360144109953 25.0134234936379, 121.360501456547 25.0146394092847, 121.360622862762 25.0148428391519, 121.361035758426 25.0153021119749, 121.361357026759 25.0156954764846, 121.362104362184 25.0172746302946, 121.362486906295 25.0195019135959, 121.362457127412 25.0201775633098, 121.363438685205 25.0216217391307, 121.365728795831 25.0232838435598, 121.367508656753 25.0245302773832, 121.367820189682 25.024654816287, 121.368348192182 25.0247762415965, 121.368139740002 25.0265509054885, 121.368201588451 25.0269271101806, 121.367919261734 25.0269686223519, 121.367678739988 25.0269333370072, 121.367509229424 25.0268399345753, 121.367023604565 25.0263791482042, 121.366823742447 25.0263480139276, 121.366615290267 25.0263708457312, 121.36644348902 25.026480853453, 121.366347280321 25.0266406758164, 121.366289619337 25.0269338183351, 121.366232173486 25.0270563167674, 121.366060372239 25.0272099115692, 121.365840466642 25.0272825576922, 121.365466512594 25.0272721796773, 121.365319908863 25.0273552037723, 121.365221409481 25.0274989391039, 121.365196211965 25.0276566845449, 121.365237444264 25.027785371465, 121.365342815696 25.0279036802885, 121.36549858216 25.0279514189044, 121.36588799832 25.0279887795473, 121.366087860438 25.0281740259003, 121.366126802054 25.0283629042468, 121.366092441805 25.0285081950848, 121.365981916336 25.0286415511668, 121.365831303909 25.0287323577545, 121.365697871607 25.0287411789623, 121.365548977192 25.0287266499139, 121.365150398299 25.0285564523608, 121.365042736184 25.0285668302671, 121.364937364752 25.028614568625, 121.36485948152 25.0287058941273, 121.36483886537 25.0288325043705, 121.365200793331 25.0293358306844, 121.365661220674 25.0297986815138, 121.366025439318 25.0294831959361, 121.366333893302 25.0294815638791, 121.366387619345 25.029654681131, 121.366387619345 25.0300367329972, 121.366362742434 25.0302080851084, 121.36615199957 25.0302205384283, 121.366113057954 25.0302848805608, 121.366237514619 25.0305582778457, 121.366289440568 25.0309127334703, 121.366289440568 25.0314611940854, 121.366449788399 25.0321528632482, 121.366465823182 25.032971653361, 121.366417718833 25.0332378368025, 121.366391351246 25.0335140490061, 121.366468113865 25.0339357224206, 121.366724670395 25.0344618580984, 121.366637624429 25.0345324244476, 121.365135296975 25.0373324409604, 121.363897932543 25.0398036865428, 121.363187392961 25.0411975338667, 121.362931298855 25.0416459267873, 121.362201716224 25.0426789328273, 121.361229893836 25.0441062412699, 121.360473968348 25.0460736272014, 121.359880108703 25.0477104972925, 121.359794061737 25.0477910543338, 121.359348097507 25.0483112827975, 121.359242726075 25.0483797659324, 121.359235854025 25.0502562927054, 121.359180877626 25.0516482347059, 121.359057180728 25.0524585939583, 121.358848155877 25.0534510432861, 121.360306175796 25.0543874556969, 121.361904500067 25.0554426619955, 121.362950196992 25.0561077381907, 121.364426542377 25.0571089771382, 121.368402345984 25.0597054482346, 121.368300863457 25.0598367785636, 121.366987560167 25.058953283623)","wkt1":"LINESTRING (121.368369513402 25.0598934893876, 121.367259175165 25.0591592334571, 121.365839893971 25.0582186308503, 121.364058315037 25.0570430927542, 121.362925572146 25.0563152495254, 121.361687457824 25.0555173665218, 121.360419564619 25.0547236286011, 121.358842429169 25.0536829422061, 121.358608779473 25.0535708837224, 121.358824103703 25.05268634441, 121.358966126067 25.0516165880452, 121.359027974516 25.0498381363375, 121.359037137249 25.048375096629, 121.359243298746 25.0483481184279, 121.359341798128 25.0482817105229, 121.359767865221 25.0477711985524, 121.359839449074 25.0476233364566, 121.360327937287 25.0462770049595, 121.360754577051 25.0451719125678, 121.361169190728 25.0440792621295, 121.361971502553 25.0429092956195, 121.362892929909 25.0415795152525, 121.363420359738 25.0406694660666, 121.363945498884 25.0395996048533, 121.365108020658 25.0372746220969, 121.366034029381 25.0355187924777, 121.366587229397 25.0344815751707, 121.366355870384 25.033918599624, 121.366303184668 25.0336633140086, 121.366300893985 25.0334827458136, 121.366314638084 25.0332850544677, 121.366353579701 25.0329301432207, 121.366346707651 25.0323147537419, 121.366328382184 25.0320942297795, 121.366211557336 25.0315084124343, 121.366188650503 25.0313169445113, 121.36618635982 25.0308810814584, 121.366135964787 25.0306875370112, 121.366076407022 25.0304088947373, 121.365997951119 25.030294220545, 121.365665802041 25.0299206206234, 121.365988788385 25.0295989086682, 121.366057508884 25.0295553218223, 121.366316356097 25.0295553218223, 121.366375913863 25.0301240251662, 121.366320937464 25.0301406296038, 121.366036892735 25.0301634607018, 121.365938393353 25.0302132739919, 121.365523779676 25.0298085404251, 121.365266650476 25.0295527273667, 121.364752964747 25.0289482177162, 121.36472776723 25.0287738693151, 121.36474151133 25.0286410322719, 121.364810231829 25.0285061195027, 121.364954544877 25.0284417764374, 121.36518590389 25.0284168694353, 121.365426425636 25.0285434799767, 121.365703598315 25.0286202764709, 121.365857074096 25.0286098985691, 121.365953282794 25.028510270667, 121.36599909646 25.0283213925473, 121.365957864161 25.0281761014881, 121.365742539931 25.0280702464653, 121.365421844269 25.0280551984399, 121.365236298922 25.0279597212705, 121.36514467159 25.0278720275005, 121.365082823141 25.0277329626953, 121.365073660408 25.0276208804988, 121.365085113825 25.0274631350118, 121.365227136189 25.0272778875857, 121.365499727502 25.0271554269487, 121.36583187658 25.0271658049735, 121.365996805777 25.0271263684746, 121.366150281558 25.0269956052557, 121.366210411994 25.0267169545983, 121.366237900194 25.0265633591796, 121.366302039326 25.0264616539992, 121.366424018212 25.0263391925478, 121.366552296477 25.0262748483464, 121.366698900208 25.0262374871817, 121.366882154871 25.0262416384228, 121.367010433136 25.0262644702462, 121.367169062954 25.0263620243531, 121.367586539985 25.0267522400052, 121.367742306449 25.026818659567, 121.367861421981 25.0268414912831, 121.36810423441 25.0267729961221, 121.368072164844 25.0265426030272, 121.368255992179 25.0248883263911, 121.36752068284 25.0246849131699, 121.366486439332 25.0239304132264, 121.36519277594 25.023049292566, 121.363306398244 25.0216736315857, 121.362301933619 25.0201920933704, 121.362352328651 25.0195039893304, 121.362086609389 25.0180037430934, 121.361969784541 25.0172990206149, 121.361205841661 25.0157157155216, 121.360456215552 25.0148184483438, 121.360380050332 25.0146679517609, 121.360066226721 25.0136290013533, 121.359889844107 25.0132968675007, 121.359747249072 25.0131759497969, 121.3587593919 25.0124109998471, 121.356907374454 25.0111665188516, 121.356402851458 25.0110455990502, 121.356317523505 25.0109957779815, 121.354043447662 25.0085124834783, 121.353919178093 25.0084019406749, 121.353071052602 25.0072030897963, 121.352880925888 25.0070266345666, 121.351899940766 25.0061536964365, 121.351831220268 25.0060618351667, 121.351026617759 25.0043621297855, 121.350616585449 25.0037351790849, 121.350001536984 25.0030573628902, 121.349591504674 25.0027521886812, 121.349424284793 25.0025300545965, 121.349308605287 25.0020162382356, 121.348222821404 25.0020266183854, 121.347913006488 25.0020328464748, 121.346920567949 25.0018605358838, 121.346211601469 25.0018231672901, 121.343653480897 25.0018086350561, 121.343345956664 25.0017795705829, 121.343201643616 25.0017525821374, 121.342894692054 25.0016633126216, 121.342763550436 25.0016212728854, 121.342305413776 25.0004955368191, 121.34202308706 25.0001768618502, 121.340565067141 24.9984267298609, 121.340329126762 24.9981900552942, 121.339888742898 24.9977660122221, 121.3395079168 24.9974457730938, 121.33909101244 24.9971738027411, 121.33927884847 24.9968348770127, 121.339592672082 24.9963049468564, 121.340014157808 24.9956421416718, 121.340234636076 24.9952845264265, 121.340679601306 24.9947130665234, 121.341195577719 24.9940061342472, 121.341804899476 24.9931247988867, 121.342552234902 24.9924640527429, 121.343152966596 24.9919590181421, 121.343710175308 24.9913044943646, 121.344205535571 24.9906162284887, 121.344574908253 24.9900317704282, 121.344698605151 24.9897930034583, 121.34339864238 24.9886495108672, 121.343316177781 24.9886640446573, 121.343263492065 24.9886640446573, 121.3432039343 24.9886162907692, 121.343171864733 24.9885311642268, 121.343213097033 24.9884605714397, 121.343277236165 24.9884356563287, 121.343380316913 24.9884356563287, 121.343790349224 24.9880842489125, 121.343827000156 24.9878844082057, 121.343845325623 24.9875958065077, 121.34380867469 24.9873918124528, 121.343657489592 24.9868057818472, 121.34360022251 24.9863630128497, 121.343719338041 24.9861237196797, 121.344063513207 24.9856539562453, 121.344420859801 24.9851078864391, 121.345014719446 24.9843183648743, 121.345333697095 24.9840603807262, 121.345762627543 24.9838003196992, 121.345918394007 24.9834655097826, 121.345813022575 24.9832142719752, 121.344836046149 24.9822825074431, 121.344342976569 24.9817753546442, 121.344758162917 24.9807693483277, 121.344964897084 24.9801827670591, 121.345084012616 24.9800727178723, 121.345888042453 24.9795266232808, 121.346417762966 24.9792167187126, 121.34612226482 24.978877743475, 121.346113102087 24.9786846361838, 121.346131427553 24.9785558978212, 121.346312391534 24.9782148443303, 121.346378821349 24.9781712392495, 121.346907969191 24.9780777997388, 121.347786446236 24.9774849763, 121.347926177917 24.9772773316878, 121.34797714562 24.9771999839801, 121.348309294698 24.9769217394752, 121.34838717793 24.9767820978727, 121.348357399047 24.976301916431, 121.348350526997 24.976123340368, 121.348375724514 24.9760091346104, 121.348494840045 24.9758762405045, 121.349001653725 24.9754147438419, 121.349120769256 24.9752693902037, 121.349159710872 24.9751240363939, 121.349171164289 24.9749428630118, 121.349216977955 24.9741216095499, 121.349260500937 24.9739949429147, 121.349593222686 24.9735895049804, 121.348953549375 24.9730028894706, 121.348813817694 24.9729530529798, 121.348207323117 24.9728558062205, 121.347783484328 24.9728170040778, 121.347422325923 24.9728647605611, 121.346103053072 24.972906547484, 121.346219046189 24.9726353448763, 121.346308382838 24.9722755861803, 121.346331289671 24.9720783154531, 121.346278603955 24.9718805252749, 121.34600372196 24.9713255689825, 121.345400699582 24.9708656126653, 121.345299336846 24.9707280407465, 121.345207709514 24.970472623795, 121.344971769134 24.9702670439123, 121.344790232483 24.9701730792556, 121.344508478437 24.9699654223012, 121.344302316941 24.9697183100687, 121.34390602873 24.9688928685517, 121.343853343014 24.9687220689552, 121.343835017548 24.9685061031685, 121.343938098296 24.9679698211021, 121.344153422526 24.966967855122, 121.34412135296 24.9667970528535, 121.343977039912 24.966493865264, 121.343835017548 24.966327215603, 121.343241157903 24.9659529019904, 121.342819794847 24.9648476409306, 121.342494453805 24.9639044503858, 121.342470575563 24.9633433117072, 121.342533255947 24.9627612795673, 121.34271234276 24.9616300478696, 121.342819794847 24.9611465134764, 121.342878657271 24.9605810387919, 121.342858041122 24.9601527125561, 121.342851169072 24.9600109751825, 121.342899273421 24.9593500511358, 121.342899273421 24.9588884924898, 121.342899273421 24.9584269321131, 121.342819794847 24.9569260342666, 121.345792635931 24.956961851629, 121.348923670366 24.9569827450905, 121.351553261727 24.9570066233321, 121.353475460179 24.9570185624529, 121.353486811621 24.9565619821257, 121.353560113486 24.9564124526182, 121.353887681198 24.9560464160784, 121.354266216612 24.9556014595567)","CustomRouteInfo":null,"CustomRouteInfoEN":null});
        var objArr = jQuery.parseJSON(routeJsonString);
        var TrackObj=null;
        var layerWkt=null;
        var layerWkt0=null;
        var layerWkt1=null;

        $(function() {
            // Configure toastr options
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": true,
                "progressBar": true,
                "positionClass": "toast-top-right",
                "preventDuplicates": false,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            }

            // Init Map
            initialize();
            //// 畫去程的站點
            pointRouteStopsLMap(true);
            //// 畫路線軌跡
            //drawRouteTrack();

            //var routePathBounds = new google.maps.LatLngBounds();
            //var path = new google.maps.MVCArray();

            if ((objArr.wkt != null && objArr.wkt.length != 0)||(objArr.wkt0 != null && objArr.wkt0.length != 0)) {
                var latlngs = [];
                //for (var i = 0; i < objArr.RouteTracks.length; i++) {
                //    var pointA = [objArr.RouteTracks[i]
                //        .Latitude,
                //        objArr.RouteTracks[i].Longitude];
                //    latlngs.push(pointA);
                //}
                if (TrackObj != null)
                {
                    map.removeLayer(TrackObj);
                }
                var wkt = new Wkt.Wkt();
                if (objArr.wkt0==null)
                {
                    wkt.read(objArr.wkt);}
                else{
                    wkt.read(objArr.wkt0);
                }

                if( map==null)
                {}
                else{
                    //map.defaults.color = '#9863b6';
                    TrackObj= wkt.toObject({
                        color: '#9863b6',
                        strokeColor: '#9863b6',
                        strokeOpacity: 0.8,
                        strokeWeight: 2,
                        fillColor: '#9863b6',
                        fillOpacity: 0.35,
                        editable: false
                    }); // Make an object
                    TrackObj.addTo(map);

                    //var firstpolyline = L.polyline(latlngs ,{ color: '#9863b6',
                    //    weight: 4,
                    //    opacity: 1.0,
                    //    smoothFactor: 1}).addTo(map);
                    //map.fitBounds(firstpolyline.getBounds());
                    //routePath=firstpolyline;

                }
            }

            $('.stationlist-go, .stationlist-come')
                .click(function() {
                    if ($(this).hasClass('stationlist-go')) {
                        if ($(this).hasClass('stationlist-come-go')) {
                            event.preventDefault();
                        } else {
                            $('.stationlist-go, .stationlist-come').toggleClass('stationlist-come-go-gray');
                            $('.stationlist-go, .stationlist-come').toggleClass('stationlist-come-go');

                            $('#GoDirectionRoute').toggle("left");
                            $('#BackDirectionRoute').toggle("left");

                            pointRouteStopsLMap(true);

                            TrackObj.setStyle({
                                color: '#9863b6'
                            });
                            TrackObj.options.color="#9863b6";
                            if ((objArr.wkt != null && objArr.wkt.length != 0)||(objArr.wkt0 != null && objArr.wkt0.length != 0)){ if( map==null)
                            {}
                            else{
                                if( map==null)
                                {}
                                else{
                                    if (TrackObj != null)
                                    {
                                        map.removeLayer(TrackObj);
                                    }
                                    var wkt = new Wkt.Wkt();
                                    if (objArr.wkt0==null)
                                    {
                                        wkt.read(objArr.wkt);}
                                    else{
                                        wkt.read(objArr.wkt0);
                                    }
                                    TrackObj= wkt.toObject({
                                        color: '#9863b6',
                                        strokeColor: '#9863b6',
                                        strokeOpacity: 0.8,
                                        strokeWeight: 2,
                                        fillColor: '#9863b6',
                                        fillOpacity: 0.35,
                                        editable: false
                                    }); // Make an object
                                    TrackObj.setStyle({
                                        color: '#9863b6'
                                    });
                                    TrackObj.options.color="#9863b6";
                                    TrackObj.addTo(map);
                                }



                            }
                            }
                            stopStationStatusReport();
                            stationStatusReport();
                            stopBusStatusReport();
                            busStatusReport();


                        }

                    }
                    if ($(this).hasClass('stationlist-come')) {
                        if ($(this).hasClass('stationlist-come-go')) {
                            event.preventDefault();
                        } else {
                            $('.stationlist-go, .stationlist-come').toggleClass('stationlist-come-go-gray');
                            $('.stationlist-go, .stationlist-come').toggleClass('stationlist-come-go');

                            $('#GoDirectionRoute').toggle("right");
                            $('#BackDirectionRoute').toggle("right");
                            pointRouteStopsLMap(false);

                            TrackObj.setStyle({
                                color: '#916955'
                            });
                            TrackObj.options.color="#916955";
                            if ((objArr.wkt != null && objArr.wkt.length != 0)||(objArr.wkt1 != null && objArr.wkt1.length != 0)) {if( map==null)
                            {}
                            else{
                                if (TrackObj != null)
                                {
                                    map.removeLayer(TrackObj);
                                }
                                var wkt = new Wkt.Wkt();
                                if (objArr.wkt1==null)
                                {
                                    wkt.read(objArr.wkt);}
                                else{
                                    wkt.read(objArr.wkt1);
                                }
                                TrackObj= wkt.toObject({
                                    color: '#9863b6',
                                    strokeColor: '#9863b6',
                                    strokeOpacity: 0.8,
                                    strokeWeight: 2,
                                    fillColor: '#9863b6',
                                    fillOpacity: 0.35,
                                    editable: false
                                }); // Make an object
                                TrackObj.setStyle({
                                    color: '#916955'
                                });
                                TrackObj.options.color="#916955";
                                TrackObj.addTo(map);
                            }}

                            stopStationStatusReport();
                            stationStatusReport();
                            stopBusStatusReport();
                            busStatusReport();
                        }

                    }
                });

            $('.stationlist-list-pool li a')
                .click(function() {
                    var idx = $(this).find('.auto-list-stationlist-number').text();
                    var activedMarker = overlays[(parseInt(idx) - 1)];
                    map.flyTo(activedMarker._latlng);
                    activedMarker.openPopup();
                    //google.maps.event.trigger(activedMarker, 'click');
                    //centerMapTo(activedMarker.getPosition().lat(), activedMarker.getPosition().lng());

                    var stopId = $(this).find('input[name="item.UniStopId"]').val();
                    document.getElementById("routeList").href = SitePath + "Stop/RoutesOfStop?stopid=" + stopId;
                    if('0454065500'=='0100020200' || '0454065500'=='0100027700')
                    {
                        stopStatusRecent3Report(stopId);//vic
                    }
                    //Set value to bus arrival alert dialog
                    $('#selected_stop_id').val(stopId);
                    $('#selected_stop_name').val($(this).find('.auto-list-stationlist-place').text());

                    $("#Toolbar")
                        .dialog({
                            autoOpen: true,
                            width: $('#Login_DL').width(),
                            modal: true,
                            show: {
                                effect: "clip",
                                duration: 600
                            },
                            buttons: {},
                            hide: {
                                effect: "clip",
                                duration: 500
                            }
                        });
                    $(".ui-dialog-titlebar").hide();
                });

            $('#busAlert')
                .click(function() {
                    $("#Toolbar").dialog("close");
                    $("#Toolbar").dialog("destroy");
                    $("#Toolbar").hide();

                    $("#SetAlertTime")
                        .dialog({
                            autoOpen: true,
                            width: 500,
                            modal: true,
                            show: {
                                effect: "clip",
                                duration: 600
                            },
                            buttons: {},
                            hide: {
                                effect: "clip",
                                duration: 500
                            }
                        });
                    $(".ui-dialog-titlebar").hide();
                });


            $('#addToMybus')
                .click(function() {
                    $("#Toolbar").dialog("close");
                    $("#Toolbar").dialog("destroy");
                    $("#Toolbar").hide();
                    var isSuccess = true;
                    $('#AddToMyBus').find('ul').html('');
                    $.ajax({
                        url: '/MyBus/MyBusGroup',
                        type: 'post',
                        dataType: 'json',
                        beforeSend: function() {
                        },
                        error: function(response) {
                            isSuccess = false;
                            toastr["error"](i18n._('Not log in'), "");
                        },
                        success: function(response) {
                            $.each(response,
                                function(idx, value) {
                                    $('#AddToMyBus')
                                        .find('ul')
                                        .append(
                                            $('<li></li>')
                                            .append($('<a>')
                                                .attr({ href: "javascript:AddMyBus('" + value.GroupId + "');" })
                                                .addClass('dialog-chose-bos-group')
                                                .append(value.GroupName))
                                        );
                                });
                        },
                        complete: function() {
                            if (isSuccess) {
                                $("#AddToMyBus")
                                    .dialog({
                                        autoOpen: true,
                                        modal: true,
                                        width: $('#Login_DL').width(),
                                        show: {
                                            effect: "clip",
                                            duration: 600
                                        },
                                        buttons: {},
                                        hide: {
                                            effect: "clip",
                                            duration: 500
                                        }
                                    });
                                $(".ui-dialog-titlebar").hide();
                            }
                        }
                    });
                });

            //$('.stationlist-move-table-icon')
            //    .click(function() {
            //        toggleRouteListAndChart();
            //    });

            $('.stationlist-bus-info-table-icon')
                .click(function() {
                    $('.stationlist-move-route-bus-info').slideToggle();
                });

            stationStatusReport();
            busStatusReport();


        });

        function AddMyBus(gid) {
            var RouteId = objArr.UniRouteId;
            var StopId = $('#selected_stop_id').val();
            $('#AddToMyBus').dialog("close");
            $('#AddToMyBus').dialog("destroy");
            $('#AddToMyBus').hide();
            addToMyBus(RouteId, StopId, gid);

        }

        function setAlertConfirm(stime) {
            var RouteId = objArr.UniRouteId;
            var RouteName = objArr.Name;
            var StopId = $('#selected_stop_id').val();
            var StopName = $('#selected_stop_name').val();
            var direction = $('.stationlist-back').hasClass('stationlist-come-go') ? 0 : 1;
            $('#SetAlertTime').dialog("close");
            $('#SetAlertTime').dialog("destroy");
            $('#SetAlertTime').hide();
            AlertAdd(RouteId, RouteName, StopId, StopName, direction, stime);
        }
    </script>


    <script>
       
        $(function () {
            window.alert = sweetAlert;

            // Selected language radio button
            $('input[name=culture]').click(function () {
                $('.teBUS-pad-main-nav-icon').slideToggle({
                    complete: function () {
                        $('#SetCultureForm').submit();
                    }
                })
            });
            $('#Loading_DL').show();
            $('#Loading_DL').dialog({
                autoOpen: false,
                modal: true,
                width: $('#Loading_DL').width(),
                minHeight: 60,
                show: false,
                buttons: {},
                hide: false
            });
            $(".ui-dialog-titlebar").hide();

            // Scroll to Top Action
            $('a.tebus-up').click(function () {
                $('body, html').animate({
                    scrollTop: 0
                }, 700);
                return false;
            });
        });

        function OpenLoadingDialog() {
            if ($('#Loading_DL').dialog("instance") !== undefined) {
                $('#Loading_DL').dialog("open");
            }
        }

        function CloseLoadingDialog() {
            $('#Loading_DL').dialog("close");
        }

        function toggleMenu() {
            $('.teBUS-pad-main-nav-icon').slideToggle();
        }

        function goTop() {
            window.document.body.scrollTop = 0;
        }

        //$(".nav-language-link").click(function () {
        //    href = $(this).attr('href');
        //    lang = href.match('(^|/?)?culture=([^&]*)(&|$)');

        //    localStorage["culture"] = lang[2];
        //});
    </script>
</body>


</html>
