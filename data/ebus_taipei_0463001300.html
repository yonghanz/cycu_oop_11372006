
<!DOCTYPE html>
<!--[if lt IE 8]> <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if IE 9]>    <html class="no-js ie9 oldie" lang="en"> <![endif]-->
<!--[if gt IE 9]><!-->
<html class="no-js" lang="en">
<!--<![endif]-->
<!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
<head>
    <script>
        var SitePath = '/';
    </script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="format-detection" content="telephone=no" />
    <title>大臺北公車</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=4, minimum-scale=0.5, user-scalable=yes">

    <link rel="stylesheet" href="/styles/html5reset-1.6.1.min.css" />
    <link href="/web/css?v=sRaS4eVeEUiSbsmDNyPCQX6_bGwBuAfoNm1EFEuVJsQ1" rel="stylesheet"/>

    <link rel="stylesheet" type="text/css" media="screen and (max-width:768px)" href="/pad/css?v=-VA-V4vm8GvG2qYKGZXk3Qi1cWfbcBMLSWm5uytMv8A1">

    <link rel="stylesheet" type="text/css" media="screen and (max-width:480px)" href="/phone/css?v=tNT4bc9cbLmN5rC7jOPAfHE2gTc_N47eqhKenWJ5sQk1">

    
    
    
    <link href="/sweetAlert/css?v=Q7l7a83fZdl7_6jt13P3HsHoLWvbYv1YpqCreuQlPuQ1" rel="stylesheet"/>

    <script src="/sweetAlert2/css?v=fJb18S8FvSIfJsXWl8pwQn02lsvJyZVA2V9a_xRxskI1"></script>

    
    <link href="/CustomScrollbar/css?v=cTpwHD23PH7gbg8rY79THNO6JzhoW_RwUaR7zeCFjOI1" rel="stylesheet"/>

    <link href="/toastr/css?v=bUMX5PdhipTCZJVvmdqKc60mrvySkxFZQUqXQRjL8kI1" rel="stylesheet"/>

    <link href="/simpleRouteMap/css?v=eN0OvNIAPpKksgTz7sjIy-B4L9bOLNcs7ckhBHKid1Q1" rel="stylesheet"/>




    <script>
        var viccknCulture = null;
        function Mybus(event, _elem) {
            event.preventDefault();
            var islogin = jQuery('a.login-link');
            if (islogin.length>0) {
                //
                alert(i18n._('Please Login'));
            } else {
                window.location.replace(_elem.href);
            }
        }
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>

    <script src="/bundles/jquery?v=q7mEgdXrcJJy32YRlrFef8zHiCgDFSUdNzefyodQYIQ1"></script>

    

    

</head>
<body class="tebus">
    <!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or
    <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->
    <a href="javascript:void(0);" class="tebus-up web-none" title="置頂"></a>  
    <!-- being header web-->
    <header class="tebus-main-header-c  pad-none">
        <div class="teBUS-main-header">
            <div class="teBUS-logo-c">
                <a href="/Dybus.aspx" class="teBUS-logo" title="首頁"></a>
                <p class="teBUS-visite">到訪人數<span class="teBUS-visite-number">231493224</span></p>
            </div>
            <nav class="teBUS-nav-language-marquee-c">
                <ul class="teBUS-nav-language-c">
                    
                            <li class="pad-none">
                               
                            <a class="nav-language-link" href="https://e-bus.tpc.gov.tw" target="_blank">無障礙 </a> /
                            </li>


                    <li><a class="nav-language-link" href="/Home/SetCulture?culture=zh-TW&amp;returnURL=%2FRoute%2FStopsOfRoute%3Frouteid%3D0463001300">中文</a> / </li>
                        <li><a class="nav-language-link" href="/Home/SetCulture?culture=en&amp;returnURL=%2FRoute%2FStopsOfRoute%3Frouteid%3D0463001300">English</a> / </li>
                    <li><a class="nav-language-link login-link" href="javascript:void(0);" alt="會員登入">會員登入</a>/</li>
                    <li><a href="/MyBus" class="nav-language-link" onclick="Mybus(event, this)">我的公車</a></li>
                    <li>/<a class="nav-language-link" href="https://www.pto.gov.taipei/Questionnaire_Content.aspx?n=63FD5A257079935F&s=E4505D512A861F41&sms=7F78FC0503254E9A" target="_blank">滿意度調查</a> </li>

                      
                    
                </ul>
                <input id="marqueeSpeed" name="marqueeSpeed" type="hidden" value="6" />
                
                <marquee scrollamount="6"><div class='teBUS-marquee2' ></div></marquee>
            </nav>
        </div>
    </header>
    <!-- end header web-->
    <!-- being header pad-->
    <header class="teBUS-pad-main-header-c web-none">

        <div class="teBUS-pad-main-nav-icon">
            <ul class="teBUS-nav-main-language-pad-c">
                <li class="nav-main-language-title">語言</li>

                <li>
                    <span class="label-checkbox-language-c">

<form action="/Home/SetCulture?returnURL=%2FRoute%2FStopsOfRoute%3Frouteid%3D0463001300" id="SetCultureForm" method="get" role="form">                            <label class="label-radio label-checkbox-language">
                                <input checked="checked" class="radio fast-search-radio" id="culture" name="culture" type="radio" value="zh-TW" />
                                中文
                            </label>
                            <label class="label-radio label-checkbox-language">
                                <input class="radio fast-search-radio" id="culture" name="culture" type="radio" value="en" />
                                English
                            </label>
<input id="returnURL" name="returnURL" type="hidden" value="/Route/StopsOfRoute?routeid=0463001300" /></form>                    </span>
                </li>
                <li class="nav-main-language-title">功能選單</li>
                
                <li><a href="/ebus" class="main-nav-pad">公車動態</a></li>
                <li><a href="/Query/BusRoute" class="main-nav-pad">GIS動態</a></li>
                <li><a href="/Transfer/TransPlan" class="main-nav-pad">轉乘規劃</a></li>
                
                    <li><a href="https://pda.5284.gov.taipei" class="main-nav-pad">PDA</a></li>
                    <li><a href="/projectbus" class="main-nav-pad">專區</a></li>
                        <li><a href="/RelatedLinks" class="main-nav-pad">相關連結</a></li>
                        <li></li>
                
            </ul>
        </div>
        <div class="teBUS-main-nav-pad-c">
            <a href=javascript:history.back(); class="teBUS-pad-main-come-back-icon" title="回上一頁"></a>
            <a href="/Dybus.aspx" class="teBUS-logo-pad" title="logo" alt="logo"></a>
            <a href=javascript:toggleMenu(); class="teBUS-pad-main-nav-icon-c" title=""></a>
        </div>
    </header>
    <!-- end header pad-->
    <!-- being content -->
    <div class="teBUS-main-container">

        <!--begin main list-->
        <div class="teBUS-main-nav-c pad-none">

    <ul class="teBUS-main-nav-pool">
        <li class="main-nav-typt"><a href="javascript:void(0)" onclick="history.go(-1)" class="main-nav" title="回上一頁"><img src="/images/nav_011.svg" width="100%" alt="回上一頁"></a></li>
       
            <li class="main-nav-typt"><a href="/ebus" class="main-nav"><img src="/images/nav_013.svg" width="100%" alt="公車動態">公車動態</a></li>
        <li class="main-nav-typt"><a href="/Query/BusRoute" class="main-nav" title="GIS動態"><img src="/images/nav_002.svg" width="100%" alt="GIS動態">GIS動態</a></li>
        <li class="main-nav-typt"><a href="/Transfer/TransPlan" class="main-nav" title="轉乘規劃"><img src="/images/nav_003.svg" width="100%" alt="轉乘規劃">轉乘規劃</a></li>

       
        <li class="main-nav-typt"><a href="https://pda.5284.gov.taipei" target="_blank" class="main-nav"><img src="/images/atk-PDA.svg" width="100%" alt="PDA">PDA</a></li>
        <li class="main-nav-typt">
            <a href="/Query/NearBus" class="main-nav"><img src="/images/atk-nearbystop.svg" width="100%" alt="附近站牌">附近站牌</a>
        </li>
        

        
        <li class="main-nav-typt"><a href="/RelatedLinks" class="main-nav" title="相關連結"><img src="/images/nav_008.svg" width="100%" alt="相關連結">相關連結</a></li>
        
        <li class="main-nav-typt"><a href="/projectbus" class="main-nav" title="專區"><img src="/images/nav_012.svg" width="100%" alt="專區">專區</a></li>

        
    </ul>
</div>
<div id="Login_DL" class="teBus-dialog-c" style="display:none">
    <form id="LoginForm">
        <div class="teBus-dialog login-c">
            <h1 class="teBus-dialog-h1"><span class="teBus-dialog-title-img login-img" alt=" "></span>會員登入</h1>
            <span class="teBus-dialog-close-icon-c"><a href='javascript: void(0);' class="teBus-dialog-close-icon" title="關閉" alt="關閉"></a></span>

            <ul class="teBus-dialog-ul">
                <li class="teBus-dialog-li">
                    
                </li>
                <li class="teBus-dialog-li">
                    <span class="teBus-dialog-li-title">電子郵件</span>
                    <label><input autocomplete="off" class="teBus-dialog-input-text-one" data-val="true" data-val-email="電子郵件欄位不是有效的電子郵件地址。" data-val-required="電子郵件是必要項" id="Email" name="Email" type="text" value="" /></label>
                    <span class="field-validation-valid teBus-diolag-note" data-valmsg-for="Email" data-valmsg-replace="true"></span>
                </li>
                <li class="teBus-dialog-li">
                    <span class="teBus-dialog-li-title">密碼</span>
                    <label><input autocomplete="off" class="teBus-dialog-input-text-one" data-val="true" data-val-required="密碼是必要項" id="Password" name="Password" type="password" /></label>
                    <span class="field-validation-valid teBus-diolag-note" data-valmsg-for="Password" data-valmsg-replace="true"></span>
                </li>
                <li class="teBus-dialog-li" style=" margin:0 auto;width: 50%;">
                    

                   
                        <div class="h-captcha" data-sitekey="e57803e5-35a9-40c1-92dc-889ae1a81fc8"></div>
                        <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
                    
                </li>

                <li>
                    <label class="teBus-login-dialog-enter-c">
                        <input class="teBus-dialog-checkbox-one login-enter-checkbox" data-val="true" data-val-required="記住我 欄位是必要項。" id="RememberMe" name="RememberMe" type="checkbox" value="true" /><input name="RememberMe" type="hidden" value="false" />
                        <label for="RememberMe">記住我</label>
                        
                        <a href="javascript:void(0)" class="teBus-dialog-submit login-enter-submit">登入</a>
                        <!--input type="submit" value="登入" class="teBus-dialog-submit login-enter-submit"-->
                    </label>
                </li>
            </ul>

            <div class="teBus-login-dialog-link-pool ">
                <a href="javascript:void(0)" class="teBus-login-dialog-link-one register-link"><img src="/images/dialog_register_icon.svg" width="100%">註冊</a>
                <a href="javascript:void(0)" class="teBus-login-dialog-link-one forgot-password-link"><img src="/images/dialog_forgot_password_icon.svg" width="100%">忘記密碼</a>
                
    <a href="javascript:void(0)" class="teBus-login-dialog-link-one resend-confirm-email-link"><img src="/images/atk-resendmail.svg" width="100%">重發確認信</a>
                
                
            </div>
        </div>

    </form>
<form action="/Account/ExternalLogin?ReturnUrl=%2FRoute%2FStopsOfRoute%3Frouteid%3D0463001300" class="form-horizontal" id="ExternalLoginForm" method="post" role="form">        <input type="hidden" name="__RequestVerificationToken" class="verification-token" />
        <input type="hidden" name="provider" />
</form></div>

<script>
    function OpenLoginDialog() {
        $("#Login_DL").dialog('open');
        // Press enter key to submit
        $(".teBus-dialog-input-text-one").keyup(function (event) {
            if (event.keyCode == 13) {
                $(".login-enter-submit").click();
            }
        });
    }
    function CloseLoginDialog() {
        $("#Login_DL").dialog('close');
    }
    $(function () {
        $("#Login_DL").show();
        $("#Login_DL").dialog({
            autoOpen: false,
            modal: true,
            width: $("#Login_DL").find('.teBus-dialog').width(),
            show: {
                effect: "clip",
                duration: 300
            },
            hide: {
                effect: "clip",
                duration: 300
            },
            close: function (event, ui) {
                $("#LoginForm").find('input[name="Email"]').val('');
                $("#LoginForm").find('input[name="Password"]').val('');
            },
            position: { my: "center", at: "center", of: window }
        });
        // Form subnit action
        $('.login-enter-submit').click(function () {
            if ($('#LoginForm').valid()) {
 
                    $.ajax({
                        url: '/Account/Login?ReturnUrl=%2FRoute%2FStopsOfRoute%3Frouteid%3D0463001300',
                        dataType: "json",
                        type: "post",
                        data: {
                            '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                            'X-Requested-With': 'XMLHttpRequest',
                            "Email": $("#LoginForm").find('input[name="Email"]').val(),
                            "Password": $("#LoginForm").find('input[name="Password"]').val(),
                            "RememberMe": $('input[name="RememberMe"]').is(":checked"),
                            "RecaptchaToken": $('[name=h-captcha-response]').val()
                            //"RecaptchaToken": $('#LoginForm textarea').val()
                        },
                        success: function (data) {
                            if (data.ErrorCode === 100) window.location.replace(data.Msg);
                            if (data.ErrorCode === 101 || data.ErrorCode === 103) $("#LoginForm").find('input[name="Email"]').closest('.teBus-dialog-li').find('.teBus-diolag-note').text(data.Msg);
                            if (data.ErrorCode === 102) $("#LoginForm").find('input[name="Password"]').closest('.teBus-dialog-li').find('.teBus-diolag-note').text(data.Msg);
                        }
                    });
            }
        });

        // Register, forgot password link clicked
        $(".register-link,.forgot-password-link,.resend-confirm-email-link").click(function () {
            var startDate = new Date('2015-12-11 10:29:00');
            var endDate = new Date('2015-12-11 10:29:30');
            var now = new Date();
            if (now > startDate && now < endDate) {
                swal({
                    title: "HTML <small>系統公告</small>!",
                    text: "<h3>親愛的使用者您好</h3> <label> 由於系統設備將於2015/12/12進行維護，</label><label>會影響本系統部分功能的使用，</label><label>造成不便敬請見諒</label>",
                    html: true
                });
            } else {
                if ($(this).hasClass('register-link')) {
                    CloseLoginDialog();
                    setTimeout(function () {
                        OpenRegisterDialog();
                    }, 400);

                }
                if ($(this).hasClass('forgot-password-link')) {
                    CloseLoginDialog();
                    setTimeout(function () {
                        OpenForgotPasswordDialog();
                    }, 400);

                }
                if ($(this).hasClass('resend-confirm-email-link')) {
                    CloseLoginDialog();
                    setTimeout(function () {
                        OpenResendConfirmEmailDialog();
                    }, 400);

                }
            }

        });

        // External Login
        $('.facebook-login, .g-login').click(function () {
            if ($(this).hasClass('facebook-login')) {
                $('#ExternalLoginForm').find('input[name="provider"]').val('Facebook');
            }
            if ($(this).hasClass('g-login')) {
                $('#ExternalLoginForm').find('input[name="provider"]').val('Google');
            }
            $('#ExternalLoginForm').submit();

        });
    });
</script>


<!-- dialog_會員註冊 BEGIN-->
<div id="Register_DL" class="teBus-dialog-c" style="display:none">
    <form id="RegisterForm">
        
        <div class="teBus-dialog register-c">
            <h1 class="teBus-dialog-h1"><span class="teBus-dialog-title-img register-img" alt=" "></span>註冊</h1>
            <span class="teBus-dialog-close-icon-c"><a href="javascript:void(0)" class="teBus-dialog-close-icon" title="關閉" alt="關閉"></a></span>
            <ul class="teBus-dialog-ul">
                <li class="teBus-dialog-li">
                    <span class="teBus-dialog-li-title"> 電子郵件</span>
                    <label><input autocomplete="off" class="teBus-dialog-input-text-one" data-val="true" data-val-email="電子郵件欄位不是有效的電子郵件地址。" data-val-required="電子郵件是必要項" id="Email" name="Email" title="ex. ebus-taipei@mail.com" type="text" value="" /></label>
                    <a href="javascript:void(0)" class="register-a-one-icon register-check-icon" style="display:none"></a>
                    <span class="field-validation-valid teBus-diolag-note" data-valmsg-for="Email" data-valmsg-replace="true"></span>
           
                </li>
                <li class="teBus-dialog-li">
                    <span class="teBus-dialog-li-title">名稱</span>
                    <label><input autocomplete="off" class="teBus-dialog-input-text-one" data-val="true" data-val-required="名稱是必要項" id="Nickname" name="Nickname" type="text" value="" /></label>
                    <span class="field-validation-valid teBus-diolag-note" data-valmsg-for="Nickname" data-valmsg-replace="true"></span>
                </li>
                <li class="teBus-dialog-li">
                    <span class="teBus-dialog-li-title">密碼</span>
                    <label><input autocomplete="off" class="teBus-dialog-input-text-one" data-val="true" data-val-length="密碼必須至少6個字元長度" data-val-length-max="100" data-val-length-min="6" data-val-required="密碼是必要項" id="Password" name="Password" type="password" /></label>
                    <span class="field-validation-valid teBus-diolag-note" data-valmsg-for="Password" data-valmsg-replace="true"></span>
                </li>
                <li class="teBus-dialog-li">
                    <span class="teBus-dialog-li-title">確認密碼</span>
                    <label><input autocomplete="off" class="teBus-dialog-input-text-one" data-val="true" data-val-equalto="兩次密碼輸入並不相同" data-val-equalto-other="*.Password" id="ConfirmPassword" name="ConfirmPassword" type="password" /></label>
                    <span class="field-validation-valid teBus-diolag-note" data-valmsg-for="ConfirmPassword" data-valmsg-replace="true"></span>
                </li>
                <!--li class="teBus-dialog-li">
                    <span class="teBus-dialog-li-title">上傳照片</span>
                    <label><input name="" type="text" value="" class="teBus-dialog-input-text-one"></label>
                    <a href="javascript:void(0);" class="register-a-one-icon register-browse-icon">瀏覽</a>
                    <div class="teBus-dialog-gust-photo-img" title="預覽照片" ><img src="images/dialog_gust_photo_img.svg" width="100%" alt="預覽照片"></div>
                </li-->
                <li class="teBus-dialog-li"  style=" margin:0 auto;width: 50%;">
                    <span class="teBus-dialog-li-title">認證</span>
                    <p class="teBus-diolag-note"></p>
                    <div class="col-md-10">
                        <div class="h-captcha" data-sitekey="e57803e5-35a9-40c1-92dc-889ae1a81fc8"></div>
                        <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
                        </div>

</li>
            </ul>
            <!--input type="submit" value="註冊" class="teBus-dialog-submit register-enter-submit"-->
            <!--input type="submit" value="取消" class="teBus-dialog-submit register-close-submit"-->
            <a href="javascript:void(0)" class="teBus-dialog-submit register-enter-submit">註冊</a>
            <a href="javascript:void(0)" class="teBus-dialog-submit register-close-submit">取消</a>
        </div>
      
    </form>
</div>
<!-- dialog_會員註冊 END-->

<script>
    function OpenRegisterDialog() {
        $("#Register_DL").dialog('open');
    }
    function CloseRegisterDialog() {
        $("#Register_DL").dialog('close');
    }
    function verifyCallback(token) {
        alert(token)
    }

    $(function () {
        $("#Register_DL").show();
        $("#Register_DL").dialog({
            autoOpen: false,
            modal: true,
            width: $("#Register_DL").find('.teBus-dialog').width(),
            show: {
                effect: "clip",
                duration: 300
            },
            hide: {
                effect: "clip",
                duration: 300
            },
            close: function (event, ui) {
                $("#RegisterForm").find('input[name="Email"]').val('');
                $("#RegisterForm").find('input[name="Nickname"]').val('');
                $("#RegisterForm").find('input[name="Password"]').val('');
                $("#RegisterForm").find('input[name="ConfirmPassword"]').val('');
            },
            position: { my: "center", at: "center", of: window }
        });
        // Form subnit action
        $(".register-enter-submit").click(function () {
            debugger;
            //$("#RegisterForm").find('input[name="recaptcha_challenge_field"]').closest('.teBus-dialog-li').find('.teBus-diolag-note').text('');
            if ($('#RegisterForm').valid()) {
                
                $.ajax({
                    url: '/Account/Register',
                    dataType: "json",
                    type: "post",
                    data: {
                        '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                        'X-Requested-With': 'XMLHttpRequest',
                        "Email": $("#RegisterForm").find('input[name="Email"]').val(),
                        "Nickname": $("#RegisterForm").find('input[name="Nickname"]').val(),
                        "Password": $("#RegisterForm").find('input[name="Password"]').val(),
                        "ConfirmPassword": $("#RegisterForm").find('input[name="ConfirmPassword"]').val(),
                        "Tel": '',
                        "RecaptchaToken":$('#RegisterForm textarea').val()
                            //$('.h-captcha iframe').data("hcaptcha-response")
                            //$("iframe").attr("data-hcaptcha-response")
                          //  $('[name=h-captcha-response]').val()
                      
                    },
                    success: function (data) {
                        if (data.ErrorCode === 200) {
                            $(".register-close-submit").trigger('click');
                            alert('Welcome! 歡迎申請[大台北公車]會員');
                        }
                        if (data.ErrorCode === 201) $("#RegisterForm").find('input[name="recaptcha_challenge_field"]').closest('.teBus-dialog-li').find('.teBus-diolag-note').text(data.Msg);
                        if (data.ErrorCode === 202) $("#RegisterForm").find('input[name="Password"]').closest('.teBus-dialog-li').find('.teBus-diolag-note').text(data.Msg);
                    }
                });


            }
        });

        $("#RegisterForm").find('input[name="Email"]').focusout(function () {
            if ($("#RegisterForm").find('input[name="Email"]').valid())
            $.ajax({
                url: '/Account/AccountAvailable',
                dataType: "json",
                type: "post",
                data: {
                    '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                    'X-Requested-With': 'XMLHttpRequest',
                    "account": $("#RegisterForm").find('input[name="Email"]').val()
                },
                success: function (data) {
                    if (data.ErrorCode === 100) {
                        $(".register-check-icon").css("background-color", "#75bc59");
                        $(".register-check-icon").text('✔');
                        $(".register-check-icon").show();
                    }
                    if (data.ErrorCode === 101) {
                        $(".register-check-icon").css("background-color", "#FF0000");
                        $(".register-check-icon").text('✘');
                        $(".register-check-icon").show();
                    }
                }
            });
        });

        $(".register-close-submit").click(function () {

            CloseRegisterDialog();

        });
    });
</script>

<!-- dialog_忘記密碼 BEGIN-->
<div id="ForgetPw_DL" class="teBus-dialog-c" style="display:none">
    <form id="ForgotPasswordForm">
        <div class="teBus-dialog forgot-password-c">
            <h1 class="teBus-dialog-h1"><span class="teBus-dialog-title-img forgot-password-img" alt=" "></span>忘記密碼</h1>
            <span class="teBus-dialog-close-icon-c"><a href="javascript:void(0)" class="teBus-dialog-close-icon" title="關閉" alt="關閉"></a></span>
            <ul class="teBus-dialog-ul">
                <li class="teBus-dialog-li">
                    <span class="teBus-dialog-li-title">電子郵件 </span>
                    <label><input class="teBus-dialog-input-text-one" data-val="true" data-val-email="電子郵件欄位不是有效的電子郵件地址。" data-val-required="電子郵件是必要項" id="Email" name="Email" type="text" value="" /></label>
                    <span class="field-validation-valid teBus-diolag-note" data-valmsg-for="Email" data-valmsg-replace="true"></span>
                </li>
                <li class="teBus-dialog-li"  style=" margin:0 auto;width: 50%;">
                    
                    
                    <div class="h-captcha" data-sitekey="e57803e5-35a9-40c1-92dc-889ae1a81fc8"></div>
                    <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
                </li>
            </ul>
            <a href="javascript:void(0)" class="teBus-dialog-submit forgot-password-enter-submit">送出</a>
            <a href="javascript:void(0)" class="teBus-dialog-submit forgot-password-close-submit">取消</a>
        </div>
    </form>
</div>
<!-- dialog_忘記密碼 END-->

<script>
    function OpenForgotPasswordDialog() {
        $("#ForgetPw_DL").dialog('open');
    }
    function CloseForgotPasswordDialog() {
        $("#ForgetPw_DL").dialog('close');
    }

    $(function () {
        $("#ForgetPw_DL").show();
        $("#ForgetPw_DL").dialog({
            autoOpen: false,
            modal: true,
            width: $("#ForgetPw_DL").find('.teBus-dialog').width(),
            show: {
                effect: "clip",
                duration: 300
            },
            hide: {
                effect: "clip",
                duration: 300
            },
            close: function (event, ui) {
                $("#ForgotPasswordForm").find('input[name="Email"]').val('');
            },
            position: { my: "center", at: "center", of: window }
        });
        $('.forgot-password-enter-submit').click(function () {
            if ($('#ForgotPasswordForm').valid()) {
                $.ajax({
                    url: '/Account/ForgotPassword',
                    dataType: "json",
                    type: "post",
                    data: {
                        '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                        'X-Requested-With': 'XMLHttpRequest',
                        "Email": $("#ForgotPasswordForm").find('input[name="Email"]').val(),
                        "RecaptchaToken": $('#ForgotPasswordForm textarea').val()
                    },
                    success: function (data) {
                        if (data.ErrorCode === 300) {
                            $(".forgot-password-close-submit").trigger('click');
                            alert(data.Msg);
                        }
                        if (data.ErrorCode === 301 || data.ErrorCode === 103) $("#ForgotPasswordForm").find('input[name="Email"]').closest('.teBus-dialog-li').find('.teBus-diolag-note').text(data.Msg);
                    }
                });
            }
        });

        $(".forgot-password-close-submit").click(function () {
            CloseForgotPasswordDialog();
        });
    });
</script>


<script>
    $(function () {
        // Login link clicked
        $(".login-link").click(function () { OpenLoginDialog(); });
    });
</script>

        <!--end main list -->
        
<input name="__RequestVerificationToken" type="hidden" value="sCUcE2-WbmT4tEH8gd_G_fexDTm6Ta39XheOxeLf8OIdenpNfeP0bJJ4kX-C04M-exvqkUPfHSkIatvXmhnWrYZ0jso1" />
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54651832-1', { 'cookieDomain': 'none' });
  ga('set', 'language', 'zh-TW');
  ga('set', 'screenResolution', screen.width + 'x' + screen.height);
  ga('set', 'viewportSize', screen.availWidth + 'x' + screen.availHeight);
  ga('set', 'screenColors', screen.colorDepth + '-bits');
  ga('set', 'hostname', location.hostname);

  ga('send', 'pageview');
  ga('send', 'event', {
      'eventCategory': 'PageView',
      'eventAction': 'Inter',
      'eventLabel': document.location.pathname,
      'eventValue': 1
  });

</script>

<script>
    $(function () {
        var token = $('input[name=__RequestVerificationToken]').filter(function () { return $(this).val() !== '' });
        $('input[name=__RequestVerificationToken]').val(token.val());
    });
</script>

    <script>
        $(function () {
            $('#sectionMain').show();
        });
    </script>

<script>
    $(function () {
    var alertPageNum = '2';
        $.ajax({
            url: '/NewsAlert/GetAlertNews',
            type: 'post',
            dataType: 'json',
            data: {
                '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                'X-Requested-With': 'XMLHttpRequest'
            },
            error: function (response) {
            },
            success: function (response) {
                response.forEach(function (info) {
                    var s = info.AlertPageList.split(';');
                    s.forEach(function (v) {
                        if (v == alertPageNum) {
                            var img = '';
                            if (info.AlertPicLink != null && info.AlertPicLink.length > 0)
                            {
                                //img = '<img src="' + info.AlertPicLink + '"   ><br/>';
                                img = '<img class="swal2-image" src="' + info.AlertPicLink + '" alt="">';
                                //img = info.AlertPicLink;
                            }

                            if (localStorage.getItem("FnAlertId" + info.Id) != "true")
                                Swal.fire({
                                    title: '<font color="#E78838">' + info.AlertContent + '</font>',
                                    html: img,
                                    //imageUrl: img,
                                    async: false,
                                    confirmButtonText: '確定',
                                    input: 'checkbox',
                                    inputPlaceholder: '不再提示'
                                }).then((result) => {
                                    /* Read more about isConfirmed, isDenied below */
                                    if (result.isConfirmed) {
                                        if (result.value) {
                                            localStorage.setItem("FnAlertId" + info.Id, "true");
                                        } else { }
                                    } else if (result.isDenied) {
                                        //Swal.fire('Changes are not saved', '', 'info')
                                    }
                                });//end swal
                        }
                    });

                });//for
            },
            complete: function () {
              
            }
        });
    });

</script>
<section class="info-c route-list" id="sectionMain" style="display:none;">
    <div id="findPanel" class="word-info-c stationlist-c">
        <h2>查詢結果</h2>
        <div class="search-c">
            <div class="stationlist-text-c">
                                <img src="/images/new_taipei_city.svg" width="100%" class="vipstop-city" alt="新北市">                
 <span class="stationlist-title"><font style="border-style:solid;}">林口-板橋</font></span> 

                        <a href="../EBus/VsSimpleMap?routeid=0463001300" class="stationlist-move-route-icon stationlist-move-table-icon @*pad-none*@" title="動態簡圖" alt="動態簡圖"></a>
                    <a href="../MapOverview?nid=0463001300" target="_blank" class="stationlist-move-route-icon stationlist-route-list-icon" style="width:90px;height:30px;position:relative;" title="路線圖" alt="路線圖"></a>
                        <a href="javascript:void(0);" class="stationlist-move-route-icon stationlist-bus-info-table-icon " title="公車資訊" alt="公車資訊"></a>
                        <a href="javascript:void(0);" class="stationlist-move-route-icon stationlist-bus-time-icon" title="時刻表" alt="時刻表"></a>

                    <br />


                            <a style="color:#4CAF50;">新北市政府交通局公車申訴服務電話02-89682460</a></div>
            <ul class="stationlist-move-route-bus-info" style="display: none;">
                <li>
                    <span class="stationlist-move-route-bus-item">起迄站名 :</span>
                    <span class="stationlist-move-route-bus-content">林口站 - 捷運府中站</span>
                </li>
                <li>
                    <span class="stationlist-move-route-bus-item-02">頭末班車 :</span>
                    <span class="stationlist-move-route-bus-content">
                        [平日] 0645 - 0645 <br>
                        [假日] 停駛
                    </span>
                </li>
                <li>
                    <span class="stationlist-move-route-bus-item-02">發車間隔 :</span>
                    <span class="stationlist-move-route-bus-content">
[平日] <br /> 班表:0645<br>
[假日]<br /> <br>
                    </span>
                </li>
                <li>
                    <span class="stationlist-move-route-bus-item">分段緩衝 :</span>
                    <span class="stationlist-move-route-bus-content">國道1號</span>
                </li>
                <li>
                    <span class="stationlist-move-route-bus-item">收費方式 :</span>
                    <span class="stationlist-move-route-bus-content">二段票</span>
                </li>
                <li>
                    <span class="stationlist-move-route-bus-item">業者服務電話 :</span>
                        <span class="stationlist-move-route-bus-content">臺北客運林口站:02-2609-5110</span>
                </li>

            </ul>


            <p> 
</p>
        </div>

        <div id="GoDirectionRoute" class="auto-list-pool-c stationlist-list-pool-c" >
            <ul class="auto-list-pool stationlist-list-pool">

                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 1</span>
                                    <span class="auto-list-stationlist-place">林口站</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2444601100" />
                                    <input data-val="true" data-val-number="欄位 Latitude 必須是數字。" data-val-required="Latitude 欄位是必要項。" id="item_Latitude" name="item.Latitude" type="hidden" value="25.080542" />
                                    <input data-val="true" data-val-number="欄位 Longitude 必須是數字。" data-val-required="Longitude 欄位是必要項。" id="item_Longitude" name="item.Longitude" type="hidden" value="121.3690155" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 2</span>
                                    <span class="auto-list-stationlist-place">未來之丘</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2445900600" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.079054" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.3736201" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 3</span>
                                    <span class="auto-list-stationlist-place">文化三路中山路口</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2445900240" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.083582" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.377965" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 4</span>
                                    <span class="auto-list-stationlist-place">春城麗池</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2444601820" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.081946" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.3805347" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 5</span>
                                    <span class="auto-list-stationlist-place">馥都社區</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2445700160" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.077511" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.3805499" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 6</span>
                                    <span class="auto-list-stationlist-place">林口國中</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2444700860" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.074898" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.3780103" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 7</span>
                                    <span class="auto-list-stationlist-place">空間樂園社區</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2444802360" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.07574" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.373143" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 8</span>
                                    <span class="auto-list-stationlist-place">世貿芳鄰</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2444801140" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.073744" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.3708094" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 9</span>
                                    <span class="auto-list-stationlist-place">林口三井</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2444801240" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.070496" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.3670383" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 10</span>
                                    <span class="auto-list-stationlist-place">安敦新世界</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2444801640" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.068083" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.364914" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 11</span>
                                    <span class="auto-list-stationlist-place">昌平街口</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2425001140" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.059899" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.454573" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 12</span>
                                    <span class="auto-list-stationlist-place">頭前國中</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2425002540" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.0553" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.45958" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 13</span>
                                    <span class="auto-list-stationlist-place">捷運幸福站</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2425001040" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.050278" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.459672" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 14</span>
                                    <span class="auto-list-stationlist-place">臺北醫院</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2421300040" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.04304" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.45976" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 15</span>
                                    <span class="auto-list-stationlist-place">捷運頭前庄站(思源路)</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2421500040" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.040005" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.459856" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 16</span>
                                    <span class="auto-list-stationlist-place">捷運新埔站</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2204700240" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.023861" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.467161" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 17</span>
                                    <span class="auto-list-stationlist-place">致理科技大學</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2205000340" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.020964" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.466622" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 18</span>
                                    <span class="auto-list-stationlist-place">板橋車站(文化路)</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2205000260" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.016025" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.462646" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 19</span>
                                    <span class="auto-list-stationlist-place">萬坪公園</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2205000560" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.01352" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.460677" />
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);" class="auto-list-link auto-list-stationlist-link">
                                <span class="auto-list auto-list-stationlist">
                                    <span class="auto-list-stationlist-position auto-list-stationlist-position-time"></span>
                                    <span class="auto-list-stationlist-number"> 20</span>
                                    <span class="auto-list-stationlist-place">捷運府中站(府中路)</span>
                                    <input id="item_UniStopId" name="item.UniStopId" type="hidden" value="2205500420" />
                                    <input id="item_Latitude" name="item.Latitude" type="hidden" value="25.009036" />
                                    <input id="item_Longitude" name="item.Longitude" type="hidden" value="121.458454" />
                                </span>
                            </a>
                        </li>
            </ul>
        </div>
        <div id="BackDirectionRoute" class="auto-list-pool-c stationlist-list-pool-c"   style = "display:none">
            <ul class="auto-list-pool stationlist-list-pool">

            </ul>
        </div>
    </div>
    <!-- being 地圖區塊縮合 -->
    

<link href="/jss/leaflet/leaflet.css" rel="stylesheet" />
<script src="/jss/leaflet/leaflet.js"></script>
<script src="/jss/leaflet/wicket.js"></script>
<script src="/jss/leaflet/wicket-leaflet.js"></script>
<script src="/jss/LMap.js"></script>
<script src="/jss/LMapLayerToggle.js"></script>


<!-- being 地圖區塊縮合 -->
<div class="map-s-c">
    <a href="javascript:void(0);" id="close-open-map" class="open-map-icon pad-none" title="展開地圖" alt="展開地圖"></a>
    <div class="map-date">
        <div class="map-icon-pool-c">
            <div class="map-icon-pool">
                <a href="javascript:void(0);" class="map-icon map-youbike" title="YouBike" alt="YouBike"></a>
                
                <a href="javascript:void(0);" class="map-icon map-my-place" title="&lt;我的位置&gt;" alt="&lt;我的位置&gt;"></a>
               <!-- <a href="javascript:void(0);" id="MapButton" class="map-icon map-map" title="開啟地圖" alt="開啟地圖"></a>-->
            </div>
        </div>
        <div id="map_canvas" class="map">
            <a href="javascript:void(0);"  style="color: #0094ff" id="maplink" title="開啟地圖" alt="開啟地圖">開啟地圖</a>
           
        </div>
    </div>
</div>
<style>
    .word-info-none {
        display: none;
    }
</style>
<script>
    $('#close-open-map').click(function () {
        $('#close-open-map').toggleClass("close-map-icon pad-none");
        $('.map-s-c').toggleClass("map-b-c pad-none");
        $('#findPanel').toggleClass("word-info-none");

        var cls = $('#close-open-map').attr('class');
        if (cls == "open-map-icon close-map-icon") {
            $('#close-open-map').attr("title", i18n._('Shrink the map'));
            $('#close-open-map').attr("alt", i18n._('Shrink the map'));
        }
        else{
            $('#close-open-map').attr("title", i18n._('Enlarge the map'));
            $('#close-open-map').attr("alt", i18n._('Enlarge the map'));
        }

        MoveCenter();
    });

    //地圖縮放用
    function MoveCenter() {
        map.invalidateSize();
    };

    $('.map-youbike').click(function () {
        $('.map-youbike').toggleClass("map-youbike-o");
        var bl = $('.map-youbike').hasClass("map-youbike-o");

        if (bl) YoubikeFetch();
        else StopFetchYoubike();
    });

    $('.map-newbike').click(function () {
        $('.map-newbike').toggleClass("map-newbike-o");
        var bl = $('.map-newbike').hasClass("map-newbike-o");

        if (bl) NewbikeFetch();
        else StopFetchNewbike();
    });

    $('.map-my-place').click(function () {
        $('.map-my-place').toggleClass("map-my-place-o");
        var bl = $('.map-my-place').hasClass("map-my-place-o");

        if (bl) getLocation();
        else clearNowLocMarkers()
    });

    function newloadmap()
    {

    }

    $('.map-map').click(function () {
        var options = {
            zoom: 10,
            center: centerPoint,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            mapTypeControl: false,
            zoomControl: true,
            zoomControlOptions: {
                style: google.maps.ZoomControlStyle.SMALL
            },
            styles: [{ featureType: "landscape", stylers: [{ saturation: -100 }, { lightness: 60 }] }, { featureType: "road.local", stylers: [{ saturation: -100 }, { lightness: 40 }, { visibility: "on" }] }, { featureType: "transit", stylers: [{ saturation: -100 }, { visibility: "simplified" }] }, { featureType: "administrative.province", stylers: [{ visibility: "off" }] }, { featureType: "water", stylers: [{ visibility: "on" }, { lightness: 30 }] }, { featureType: "road.highway", elementType: "geometry.fill", stylers: [{ color: "#ef8c25" }, { lightness: 40 }] }, { featureType: "road.highway", elementType: "geometry.stroke", stylers: [{ visibility: "off" }] }, { featureType: "poi.park", elementType: "geometry.fill", stylers: [{ color: "#b6c54c" }, { lightness: 40 }, { saturation: -40 }] }, {}]
        };
        $("#MapButton").hide();
        map = new google.maps.Map(document.getElementById("map_canvas"), options);

        // 畫路線軌跡
        drawRouteTrack();

        var routePathBounds = new google.maps.LatLngBounds();
        var path = new google.maps.MVCArray();

        if (objArr.RouteTracks.length != 0) {
            for (var i = 0; i < objArr.RouteTracks.length; i++) {
                var latlng = new google.maps.LatLng(objArr.RouteTracks[i]
                    .Latitude,
                    objArr.RouteTracks[i].Longitude);
                path.push(latlng);
                routePathBounds.extend(latlng);
            }
            routePath.setPath(path);
            if (map == null)
            { }
            else {
                map.fitBounds(routePathBounds);
            }
        }

        pointRouteStops(true);
        routePath.setOptions({ strokeColor: '#9863b6' });


        if (objArr.RouteTracks.length != 0) {
            if (map == null)
            { }
            else {
                map.fitBounds(routePathBounds);
            }
        }
        stopStationStatusReport();
        stationStatusReport();
        stopBusStatusReport();
        busStatusReport();

    });

    $('#maplink').click(function () {
        var options = {
            zoom: 10,
            center: centerPoint,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            mapTypeControl: false,
            zoomControl: true,
            zoomControlOptions: {
                style: google.maps.ZoomControlStyle.SMALL
            },
            styles: [{ featureType: "landscape", stylers: [{ saturation: -100 }, { lightness: 60 }] }, { featureType: "road.local", stylers: [{ saturation: -100 }, { lightness: 40 }, { visibility: "on" }] }, { featureType: "transit", stylers: [{ saturation: -100 }, { visibility: "simplified" }] }, { featureType: "administrative.province", stylers: [{ visibility: "off" }] }, { featureType: "water", stylers: [{ visibility: "on" }, { lightness: 30 }] }, { featureType: "road.highway", elementType: "geometry.fill", stylers: [{ color: "#ef8c25" }, { lightness: 40 }] }, { featureType: "road.highway", elementType: "geometry.stroke", stylers: [{ visibility: "off" }] }, { featureType: "poi.park", elementType: "geometry.fill", stylers: [{ color: "#b6c54c" }, { lightness: 40 }, { saturation: -40 }] }, {}]
        };
        $("#MapButton").hide();
        map = new google.maps.Map(document.getElementById("map_canvas"), options);

        // 畫路線軌跡
        drawRouteTrack();

        var routePathBounds = new google.maps.LatLngBounds();
        var path = new google.maps.MVCArray();

        if (objArr.RouteTracks.length != 0) {
            for (var i = 0; i < objArr.RouteTracks.length; i++) {
                var latlng = new google.maps.LatLng(objArr.RouteTracks[i]
                    .Latitude,
                    objArr.RouteTracks[i].Longitude);
                path.push(latlng);
                routePathBounds.extend(latlng);
            }
            routePath.setPath(path);
            if (map == null)
            { }
            else {
                map.fitBounds(routePathBounds);
            }
        }

        pointRouteStops(true);
        routePath.setOptions({ strokeColor: '#9863b6' });


        if (objArr.RouteTracks.length != 0) {
            if (map == null)
            { }
            else {
                map.fitBounds(routePathBounds);
            }
        }
        stopStationStatusReport();
        stationStatusReport();
        stopBusStatusReport();
        busStatusReport();

    });


</script>
    <!-- end 地圖區塊縮合 -->

</section>

<section class="info-c route-chart" style="display:none;">
    <!--路線簡圖-->
</section>

<div id="Toolbar" class="teBus-dialog-c" style="display:none">
    <div class="teBus-dialog tool-dialog-c">
        <h1 class="teBus-dialog-h1"><span class="teBus-dialog-title-img tool-dialog-img" alt=" "></span>快捷工具列</h1>
        <span class="teBus-dialog-close-icon-c"><a href="javascript:void(0);" class="teBus-dialog-close-icon" title="關閉"></a></span>
        <div class="tool-icon-pool">
            <a id="routeList" href=javascript:void(0) class="teBus-login-dialog-link-one"><img src="/images/dialog_route_icon.svg" width="100%" alt="行經路線">行經路線</a>
            <a id="busAlert" href=javascript:void(0) class="teBus-login-dialog-link-one"><img src="/images/dialog_remind_icon.svg" width="100%" alt="到站提醒">到站提醒</a>
            <a id="addToMybus" href=javascript:void(0) class="teBus-login-dialog-link-one"><img src="/images/dialog_add_bus_icon.svg" width="100%" alt="加入我的公車">加入我的公車</a>
            <a class="teBus-login-dialog-link-one-recent3" id="recent3">
                <font>
                    .</font><br />
                    <font>
                        .</font><br />
                        <font">.</font><br />
            </a>
</div>
    </div>
</div>

<input type="hidden" id="selected_stop_id" />
<input type="hidden" id="selected_stop_name" />
<div id="SetAlertTime" class="teBus-dialog-c" style="display:none">
    <div class="teBus-dialog news-dialog-c">
        <h1 class="teBus-dialog-h1"><span class="teBus-dialog-title-img remind-dialog-img" alt=" "></span>設定到站提醒通知</h1>
        <span class="teBus-dialog-close-icon-c"><a href="javascript:void(0);" class="teBus-dialog-close-icon" title="關閉" alt="關閉"></a></span>
        <div class="set-up-remind-dialog-c">
            <a href="javascript:setAlertConfirm(180);" class="set-up-remind-time-dialog">3分鐘前提醒</a>
            <a href="javascript:setAlertConfirm(300);" class="set-up-remind-time-dialog">5分鐘前提醒</a>
            <a href="javascript:setAlertConfirm(600);" class="set-up-remind-time-dialog">10分鐘前提醒</a>
            <a href="javascript:setAlertConfirm(900);" class="set-up-remind-time-dialog">15分鐘前提醒</a>
            <a href="javascript:setAlertConfirm(1200);" class="set-up-remind-time-dialog">20分鐘前提醒</a>
        </div>
    </div>
</div>
<div id="News_Detail_DL" class="teBus-dialog-c" style="display:none">
    <div class="teBus-dialog news-dialog-c">
        <h1 class="teBus-dialog-h1"><span class="teBus-dialog-title-img remind-dialog-img" alt=" "></span>到站提醒通知</h1>
        <span class="teBus-dialog-close-icon-c"><a href="javascript:void(0);" class="teBus-dialog-close-icon" title="關閉" alt="關閉"></a></span>
        <div class="remind-dialog-c">
        </div>
    </div>
</div>
<script>
    $(function () {
        window.setInterval(StartBusArrivalAlert, 1000 * 60);

        $("#News_Detail_DL").dialog({
            autoOpen: false,
            width: $('#News_Detail_DL').width(),
            modal: true,
            show: {
                effect: "clip",
                duration: 600
            },
            buttons: {},
            hide: {
                effect: "clip",
                duration: 500
            },
            close: function (event, ui) {
                $('#News_Detail_DL').find('.remind-dialog-c').html('');
            }
        });

        $(".ui-dialog-titlebar").hide();
    });
    function StartBusArrivalAlert() {
        if (localStorage.bus_alert !== undefined && !$("#News_Detail_DL").dialog("isOpen")) {
            var busAlert = JSON.parse(localStorage.bus_alert);
            var m = $.map(busAlert, function (value, index) {
                return { "UniStationId": value.StopId, "UniRouteId": value.RouteId, "UniBusId": "", "BusLicence": "", "BusType": 0, "RouteDirect": 0, "ETA": 0 };
            });
            $.ajax({
                url: '/Stop/StatusOfRutStp',
                type: 'post',
                dataType: 'json',
                data: {
                    '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                    'X-Requested-With': 'XMLHttpRequest',
                    'models': JSON.stringify(m)
                },
                error: function (response) {

                },
                success: function (response) {
                    $.each(busAlert, function (idx, val) {
                        $.each(response, function (index, value) {
                            if (value.ETA !== 0 && val.RouteId === value.UniRouteId &&
                                val.StopId === value.UniStationId && val.SetTime > value.ETA) {
                                $('#News_Detail_DL').find('.remind-dialog-c').append(
                                    $('<p/>', { 'class': 'remind-content-dialog', 'text': val.RouteName + " " + val.StopName }),
                                    $('<p/>', { 'class': 'remind-time-dialog', 'text': i18n._('Estimate') + Math.floor(value.ETA / 60) + i18n._('Arrives minute(s)') })
                                );
                                for (var i = 0; i < busAlert.length; i++) {
                                    if (busAlert[i].RouteId == value.UniRouteId && busAlert[i].StopId == value.UniStationId && val.SetTime > value.ETA) {
                                        busAlert.splice(i, 1);
                                    }
                                    AlertDelete(i);
                                }
                                localStorage.setItem('bus_alert', JSON.stringify(busAlert));
                            }
                        });
                        if ($('#News_Detail_DL').find('.remind-dialog-c').html().trim() !== '') {
                            if (!$("#News_Detail_DL").dialog("isOpen")) {
                                $("#News_Detail_DL").dialog("open");
                            }
                        }
                    });
                }
            });
        }
    }
</script>

<div id="AddToMyBus" class="teBus-dialog-c" style="display:none;">
    <div class="teBus-dialog alternative-route-dialog-c">
        <h1 class="teBus-dialog-h1">選擇公車群組</h1>
        <span class="teBus-dialog-close-icon-c"><a href="#" class="teBus-dialog-close-icon" title="關閉"></a></span>
        <ul class="dialog-chose-bos-group-pool"></ul>
    </div>
</div>





    </div>
    <!-- end content -->
    <!-- loading dialog -->
    <div id="Loading_DL" class="teBus-dialog-c" style="display: none;">
        <div class="teBus-dialog loading-dialog-c">
            <p class="loading-dialog-p"><img src="/images/dialog_loading_bus_img.gif" class="loading-dialog-img" width="100%" alt=" ">資料載入中，請稍候</p>
        </div>
    </div>
    <!-- end loading dialog -->
    
<footer class="teBUS-main-footer">
    <div class="teBUS-main-footer-logo">
                <a href="https://www.gov.taipei/" target="_blank" class="teBUS-main-footer-taipei" title="臺北市政府" alt="臺北市政府"><img src="/images/taipei_city.svg" width="100%" title="臺北市政府" alt="臺北市政府"></a>
                <a href="https://www.ntpc.gov.tw/" target="_blank" class="teBUS-main-footer-new-taipei" title="新北市政府" alt="新北市政府"><img src="/images/new_taipei_city.svg" width="100%" title="新北市政府" alt="新北市政府"></a>

      
        <span class="teBUS-main-footer-ebus-logo" title="大臺北公車"><img src="/images/logo_img02.svg" width="100%" title="大臺北公車" alt="大臺北公車"></span>
    </div>
    <div class="teBUS-main-footer-text">
        <p class="teBUS-main-footer-Copyright">本網站所有版權歸屬於臺北市政府與新北市政府 Copyright&#169;2014<span></span></p>
        <p>
            建議瀏覽器IE9.0以上版本/Firefox/Google Chrome (最佳螢幕解析1024*768) <br />
            如有大臺北公車網站服務任何問題，請撥1999為您服務
            聯絡地址:110210臺北市信義區松德路300號4樓
        </p>
    </div>
    <div class="teBUS-main-footer-link-pool">
        <a href="/Home/WebSite" class="teBUS-main-footer-link" target="_self">網站導覽</a>
        
        <a href="/Home/CopyrightNotice" class="teBUS-main-footer-link" target="_self">著作權聲明</a>
        <a href="/Home/SecurityPrivacyPolicy" class="teBUS-main-footer-link" target="_self">隱私權及網站安全政策</a>
        <p class="teBUS-main-footer-date">網站更新日期:<span>2025-06-02</span><br />網站檢視日期:2025-06-02</p>
    </div>
</footer>
<!-- end footer -->

    <script src="/bundles/modernizr?v=wBEWDufH_8Md-Pbioxomt90vm6tJN2Pyy9u9zHtWsPo1"></script>

    
    <script src="/jss/tebus-script.js"></script>
    <script src="/bundles/sweetAlert?v=cMcnF9PMfZnW6d_oMLsRilV8d-Fh8HT8X6rfi8S_EV41"></script>

    <script src="/sweetAlert/css?v=Q7l7a83fZdl7_6jt13P3HsHoLWvbYv1YpqCreuQlPuQ1"></script>

    <script src="/bundles/sweetAlert2?v=PwfQxO_e6ZEtKGd2oGReTt3SIS48xCdv8zRgwComWDA1"></script>

    <script src="/sweetAlert2/css?v=fJb18S8FvSIfJsXWl8pwQn02lsvJyZVA2V9a_xRxskI1"></script>

    
    <script src="/bundles/customScrollbar?v=FNWrR0EcYik_CfSZ44D3T7EmJWx0Sy8nttPc_daLKEU1"></script>

    <script src="/bundles/busInfoHelper?v=Bz-GVCVvhrGERqTqUhEyiA19qHoesHwpCKpDnLmBTC81"></script>

    <script src="/bundles/busArrivalAlert?v=MDKgeaTn7JrPx59avQagl_lTQuO4AjqKyXZGq_1HMcs1"></script>

    <script src="/bundles/jqueryval?v=kO9SZjRLUEvNZbFlwaT1hsJ0t0ngQHk32HeNdumCbRM1"></script>

    <script src="/bundles/toastr?v=nU7i1d5lsXeim4T9MB2Gdegj9fc8yXl1nK6hEZMOAm81"></script>

    
<style>
.marker-g {
    background-image: url("../images/mapIcon/station_01.png");
    background-size:24px 24px;
	/*background-color: rgba(218, 94, 94, 0.6);*/
	}
    .marker-b {
    background-image: url("../images/mapIcon/station_02.png");
    background-size:24px 24px;
	/*background-color: rgba(218, 94, 94, 0.6);*/
	}
    .custompopup .leaflet-popup-content-wrapper a {
    color: #ffffff;
}
    .custompopup .leaflet-popup-content p{
    margin: 0;
}
    


    </style>

<script src="/jss/VsSimpleMap.js"></script>

    <script>

        viccknCulture = 'zh-TW';
        //var InfoBox = new google.maps.InfoWindow({ content: " " });
        var routePath;
        var Marker_Bus_Status = [];
        var busFetchInterval = null;
        var stopFetchInterval = null;
        var goStopStationNum = []; //去程站位數量
        var backStopStationNum = []; //返程站位數量



        //#region 時刻表
        $('.stationlist-bus-time-icon').click(function () {
            var _date = new Date();
            var _nowDate = _date.getFullYear() + "/" +( _date.getMonth()+1) + "/" + _date.getDate();
            //var _url = "http://web.taiwanbus.tw/eBUS/subsystem/Timetable/TimeTableAPIByWeek.aspx?RouteId=" + "" + "&SearchDate=" + _nowDate;
            var _url = "../Route/RouteSchedule?routeid=0463001300";

            window.open(_url, "_blank");
        });
        //#endregion


        var existGoNum = 20;
        var existBackNum = 0;

        function getStopStationNum(goBack) {
            switch (goBack) {
                case 1:
                    var go = $("#GoDirectionRoute div > div > li > a > span > span.auto-list-stationlist-number")
                        .text()
                        .trim()
                        .split(' ')
                        .filter(function(v){return v!==''})
                        .map(function(item, index) { return parseInt(item) });

                    if (go && go.length === existGoNum) {
                        goStopStationNum = go;
                    }

                    goStopStationNum = $("#GoDirectionRoute div > div > li > a > span > span.auto-list-stationlist-number")
                        .text()
                        .trim()
                        .split(' ')
                        .filter(function(v){return v!==''})
                        .map(function(item, index) { return parseInt(item) });
                    break;
                case 2:
                    var back = $("#BackDirectionRoute div > div > li > a > span > span.auto-list-stationlist-number")
                        .text()
                        .trim()
                        .split(' ')
                        .filter(function(v){return v!==''})
                        .map(function(item, index) { return parseInt(item) });

                    if (back && back.length === existBackNum) {
                        backStopStationNum = back;
                    }

                    break;

            }
        }

        getStopStationNum(1);
        getStopStationNum(2);

        function bindInfoWindow(marker, map, InfoBox, content) {
            google.maps.event.addListener(marker,
                'click',
                function() {
                    InfoBox.setContent(content);
                    InfoBox.open(map, marker);
                });
        }

        function createBusMarker(lat, lng, title, icon) {
            var marker = new google.maps.Marker({
                position: new google.maps.LatLng(lat, lng),
                map: map,
                title: title,
                icon: icon
            });
            Marker_Bus_Status.push(marker);
        }

        function clearBusMarkers() {
            while (Marker_Bus_Status[0]) {
                Marker_Bus_Status.pop().setMap(null);
            }
        }

        function drawRouteTrack() {
            routePath = new google.maps.Polyline({
                geodesic: true,
                strokeColor: '#9863b6',
                strokeOpacity: 1.0,
                strokeWeight: 4
            });
            routePath.setMap(map);
        }


        function pointRouteStopsLMap(isGoDirection) {
            clearMarkers();
            var stops;
            var iconUrl;
            if (isGoDirection) {
                if (objArr.GoDirStops ==null)
                {stops = objArr.BackDirStops;
                    iconUrl = 'marker-g';
                }
                else
                {
                    stops = objArr.GoDirStops;
                    iconUrl = 'marker-g';
                }
                //stops = objArr.GoDirStops;
                //iconUrl = 'marker-g';
            } else {
                stops = objArr.BackDirStops;
                //iconUrl = "images/mapIcon/station_02.png";
                iconUrl = 'marker-b';
            }
            var arMarker = [];
            for (var i in stops) {
                infoLink =
                    "<div class='inforwindow-bike-c'><div class='inforwindow-1ocation-c'><p class='inforwindow-1ocation'>" + stops[i].Name + "</p><p class='inforwindow-1ocation-number'>"+ "</p></div><a class='inforwindow-transplan-start-end-icon02' href='" + SitePath + "Stop/RoutesOfStop?Stopid=" + stops[i].UniStopId + "'>" + i18n._('List of Routes') + "</a></div>";
                // "<div class='inforwindow-bike-c'><div class='inforwindow-1ocation-c'>" + "<p class='inforwindow-1ocation-number'>" + stops[i].PublicId + "</p></div><a class='inforwindow-transplan-start-end-icon02' href='" + SitePath + "Stop/RoutesOfStop?Stopid=" + stops[i].UniStopId + "'>" + i18n._('List of Routes') + "</a></div>";

                var GoStopsicon = new L.DivIcon({ html: '<div align="center"  valign="center"><span>' + (parseInt(i)+1) + '</span></div>', className:  iconUrl, iconSize: new L.Point(24, 24),iconAnchor: [12, 24], });
                //var GoStopsicon = L.icon({
                //    iconUrl: '/images/mapIcon/station_01.png',
                //    iconSize: [16, 16]
                //});
                m = L.marker([stops[i].Latitude, stops[i].Longitude], { icon: GoStopsicon });
                m.bindPopup(infoLink, {
                    maxWidth : 300,
                    maxHeight:170,
                    className:'custompopup'
                });
                setStationMarkers(m);
                //m.bindTooltip(data[i].tooltip);

                arMarker.push(m);
            }
            StoplayerGroup = L.layerGroup(arMarker).addTo(map)
            //layerMap.set('layername', L.layerGroup(arMarker).addTo(map));
        }

        function stopStatusRecent3Report(stopId) {
            (
                function startFatch() {
                    $.ajax({
                        // url: '/Route/StopStatusRecent3OfRoute?routeid=0463001300',
                        url: './StopStatusRecent3OfRoute?routeid=0463001300&stopid='+stopId,
                        type: 'post',
                        dataType: 'html',
                        data: {
                            '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                            'X-Requested-With': 'XMLHttpRequest'
                        },
                        error: function(xhr) {

                        },
                        success: function(response) {
                            // clearBusMarkers();
                            //var jsonObjArr = JSON.parse(response);// vic
                            // var jsonObjArr = response;
                            //  alert(response);
                            $('#recent3').empty();
                            $('#recent3').append(response);


                        }
                    });
                    //if (busFetchInterval == null) {
                    //    busFetchInterval = window.setInterval(startFatch, 1000 * 13);
                    //}
                })();
        }

        function busStatusReport() {
            (function startFatch() {
                $.ajax({
                    url: '/Route/BusStatusOfRoute?routeid=0463001300',
                    type: 'post',
                    dataType: 'json',
                    data: {
                        '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    error: function(xhr) {

                    },
                    success: function(response) {
                        clearBusMarkers();
                        var jsonObjArr = JSON.parse(response);// vic
                        // var jsonObjArr = response;
                        if (BuslayerGroup != null) {
                            BuslayerGroup.clearLayers();
                        }
                        var arMarker = [];
                        for (var i in jsonObjArr) {
                            if (($('.stationlist-go').hasClass('stationlist-come-go') ||
                                    $('.stationlist-come-go-c').length === 0) &&
                                jsonObjArr[i].RouteDirect === 1) {

                                m = L.marker([jsonObjArr[i].position.Latitude, jsonObjArr[i].position.Longitude], { icon:  L.icon({iconUrl: busIcon(jsonObjArr[i].BusType),iconAnchor: [16, 32]}) });
                                m.bindPopup(jsonObjArr[i].BusLicence);
                                arMarker.push(m);
                                //createBusMarker(value.position.Latitude,
                                //    value.position.Longitude,
                                //    value.BusLicence,
                                //    busIcon(value.BusType));
                            }
                            if ($('.stationlist-come').hasClass('stationlist-come-go') && jsonObjArr[i].RouteDirect === 2) {
                                m = L.marker([jsonObjArr[i].position.Latitude, jsonObjArr[i].position.Longitude], { icon:  L.icon({iconUrl: busIcon(jsonObjArr[i].BusType),iconAnchor: [16, 32]}) });
                                m.bindPopup(jsonObjArr[i].BusLicence);
                                arMarker.push(m);
                            }


                        }
                        BuslayerGroup = L.layerGroup(arMarker).addTo(map)
                        //$.each(jsonObjArr,
                        //    function(idx, value) {
                        //        if (($('.stationlist-go').hasClass('stationlist-come-go') ||
                        //                $('.stationlist-come-go-c').length === 0) &&
                        //            value.RouteDirect === 1) {
                        //            //createBusMarker(value.position.Latitude,
                        //            //    value.position.Longitude,
                        //            //    value.BusLicence,
                        //            //    busIcon(value.BusType));
                        //        }
                        //        if ($('.stationlist-come').hasClass('stationlist-come-go') && value.RouteDirect === 2) {
                        //            //createBusMarker(value.position.Latitude,
                        //            //    value.position.Longitude,
                        //            //    value.BusLicence,
                        //            //    busIcon(value.BusType));
                        //        }
                        //    });
                    }
                });
                if (busFetchInterval == null) {
                    busFetchInterval = window.setInterval(startFatch, 1000 * 13);
                }
            })();
        }

        function stopBusStatusReport() {
            clearBusMarkers();
            clearInterval(busFetchInterval);
            busFetchInterval = null;
        }

        function busIcon(btype) {
            var url;
            if (btype === 2) {
                url = SitePath + "images/mapIcon/LowFloorBus06.png";
                return url;
            }
            if (btype === 51) {
                url = SitePath + "images/mapIcon/FukangBus06.png";
                return url;
            }
            if (btype === 52) {
                url = SitePath + "images/mapIcon/YuanZaiBus06.png";
                return url;
            }
            if (btype === 6) {
                url = SitePath + "images/mapIcon/AccMiniBus06.png";
                return url;
            }
            url = SitePath + "images/mapIcon/NormalBus06.png";
            return url;
        }

        //依據清單，過濾重複項目
        function unique(list) {
            var result = [];
            $.each(list,
                function(i, e) {
                    if ($.inArray(e, result) === -1) result.push(e);
                });
            return result;
        }

        function stationStatusReport() {
            (function startFatch() {
                $.ajax({
                    url: '/Route/StopStatusOfRoute?routeid=0463001300',
                    type: 'post',
                    dataType: 'json',
                    data: {
                        '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    error: function(xhr) {

                    },
                    success: function(response) {
                        // Clearing
                        $('.auto-list-stationlist-bus').remove();
                        $('.auto-list-stationlist-position')
                            .removeClass('auto-list-stationlist-position-none auto-list-stationlist-position-now auto-list-stationlist-position-time')
                            .html('');
                        
                        var jsonObjArr = JSON.parse(response);
                        var goStationList = []; //去程站位及站序
                        var backStationList = []; //返程站位及站序
                        var uniStation = []; //取得車號
                        var tempduplicate = [];//重複站牌編號項目(暫存)
                        var duplicateStation; //重複站排項目
                        var filterDuplicate;//取得有重複的站位及公車編號

                        if (jsonObjArr.length !== 0) {

                            var hasSeq = jsonObjArr[0].StopSequence !== 65535;
                            //hasSeq = jsonObjArr[0].UniRouteId[9] =='0' ?hasSeq:false;
                            // if ($('.stationlist-go').hasClass('stationlist-come-go') ||$('.stationlist-go').hasClass('stationlist-go')) {
                            if ($('.stationlist-go').hasClass('stationlist-come-go') ||objArr.BackDirStops === null) {
                                //if ($('.stationlist-go').hasClass('stationlist-come-go') ||!($('.stationlist-come-go-c').length == 0)) {

                                //取得去程站位及站序
                                $.each( $('#GoDirectionRoute li  '), function( index, item ){
                                    var uniStopId = $(item).find('input#item_UniStopId').val();
                                    var stopSeq =parseInt($(item).find('.auto-list-stationlist-number').text().trim());
                                    goStationList.push({ stopSeq: stopSeq, uniStopId: uniStopId });
                                });

                                //取得相同站牌編號
                                $.grep(jsonObjArr,function(item) {

                                    if (($.inArray(item.UniStationId, uniStation) === -1)) {
                                        //未重複
                                        uniStation.push(item.UniStationId);
                                        
                                    } else {
                                        //有重複
                                        tempduplicate.push(item.UniStationId);
                                    }
                                });

                                if (tempduplicate.length==0)
                                {hasSeq=false;
                                }

                                //重複站排項目
                                duplicateStation = unique(tempduplicate);

                                //取得有重複的站位及公車編號
                                filterDuplicate = $.grep(jsonObjArr,function(item) {

                                    //取得有重複站位
                                    if (($.inArray(item.UniStationId, duplicateStation) !== -1)) {

                                        //確定該站位，有在站位列表中
                                        var result = $.grep(goStationList,function(e) { return e.uniStopId === item.UniStationId; });

                                        if (result && result.length > 0) {

                                            //在資料內找出該站位的進站公車，是否有重複
                                            if (item.Vehicles && item.Vehicles.length > 0) {

                                                //依據該公車編號，取得是否有重複的
                                                var busIdDuplicate = $.grep(item.Vehicles,function(value) {

                                                    var getVehicles = $.grep(jsonObjArr,function(data) {

                                                        //找出有重複的公車編號
                                                        var filterVehicles = $.grep(data.Vehicles,function(vehicles) {
                                                            return value.UniBusId === vehicles.UniBusId;
                                                        });

                                                        //若相同公車編號找尋結果，有2筆以上，則回傳該項目
                                                        if (filterVehicles && filterVehicles.length > 0) {
                                                            return data;
                                                        }
                                                    });

                                                    if (getVehicles && getVehicles.length > 0) {
                                                        return value;
                                                    }
                                                });

                                                if (busIdDuplicate && busIdDuplicate.length > 0) {
                                                    return item;
                                                }


                                            }


                                        }

                                    }
                                });

                                //去程
                                $('#GoDirectionRoute li').map(function(index, item) {

                                    //站排編號
                                    var _UniStopId = $(item).find('input#item_UniStopId').val();
                                    //站牌站序
                                    var _StopSeq =parseInt($(item).find('.auto-list-stationlist-number').text().trim());

                                    var tmp = jsonObjArr.filter(function(item) {

                                        if (hasSeq) {
                                            if (item.UniStationId == _UniStopId &&
                                                item.StopSequence == (_StopSeq - 1))
                                                return true;
                                        } else {
                                            if (item.UniStationId == _UniStopId)
                                                return true;
                                        }
                                        return false;
                                    });

                                    if (tmp && tmp.length > 0) {

                                        var value = tmp[0];

                                        //依據有重複的站位及公車編號，取得下一站位的等待時間
                                        var  filterBusId = filterDuplicate.filter(function(item) {
                                            if (item.UniStationId === value.UniStationId) {
                                                return true;
                                            }
                                            return false;
                                        }).map(function(dirItem) {

                                            var nextStation = jsonObjArr.filter(function (station) {
                                                if ( station.StopSequence ===( parseInt(dirItem.StopSequence) +1)) {

                                                    return true;
                                                }
                                                return false;
                                            });

                                            if (nextStation && nextStation.length > 0 ) {
                                                dirItem.NextETA = nextStation[0].ETA;
                                            }

                                            return dirItem;

                                        });

                                        //若公車站編號相同超過1個以上，表示有重複
                                        if (filterBusId && filterBusId.length > 1) {

                                            //車號編號
                                            var busArray= [];
                                            //重複車號編號
                                            var tempbusArray= [];

                                            //取得重複車號
                                            $.each(filterBusId , function(index, item) {
                                                $.each(item.Vehicles , function(iVehicles, vehicles) {

                                                    if (($.inArray(vehicles.UniBusId, busArray) !== -1)) {
                                                        //未重複
                                                        busArray.push(vehicles.UniBusId);
                                                    } else {
                                                        //有重複
                                                        tempbusArray.push(vehicles.UniBusId);
                                                    }
                                                });
                                            });

                                            //過濾收集重複車號項目
                                            var duplicateBus = unique(tempbusArray);

                                            if (duplicateBus.length > 0 ) {

                                                //依進站時間排序
                                                filterBusId.sort(function (a, b) {
                                                    if (a.NextETA> b.NextETA) {
                                                        return 1;
                                                    }
                                                    if (a.ETA< b.ETA) {
                                                        return -1;
                                                    }
                                                    // a must be equal to b
                                                    return 0;
                                                });

                                                for (var i = 0; i < filterBusId.length; i++) {

                                                    if (i !==0) {
                                                        filterBusId[i].Vehicles =  $.grep(filterBusId[i].Vehicles, function(iVehicles, vehicles) {

                                                            if (($.inArray(vehicles.UniBusId, duplicateBus) === -1)) {
                                                                //未重複
                                                                return vehicles;
                                                            }

                                                        });
                                                    }
                                                }
                                            }
                                        }

                                        if (value.Vehicles.length > 0) {

                                            var _html = "<span class='auto-list-stationlist-bus'>";

                                            for (var i = 0; i < value.Vehicles.length; i++) {
                                                //'<img src=\"../images/seats/seat00.png\">'
                                                var dogimg=""
                                                if($('#doglink').attr('dognum')!=null)
                                                {
                                                    if (value.Vehicles[i].BusLicence.indexOf($('#doglink').attr('dognum')) > -1) {
                                                        value.Vehicles[i].BusLicence=value.Vehicles[i].BusLicence.replace($('#doglink').attr('dognum'), '');
                                                        dogimg="<img src='" +
                                                            SitePath +
                                                            "images/stationlist_dogwhite_bus.png' class='bus-number-img' alt=''>";
                                                    }
                                                }
                                                if (value.Vehicles[i].BusType == 2) {
                                                    _html = _html +
                                                        "<p class='bus-number'><img src='" +
                                                        SitePath +
                                                        "images/stationlist_accessibility_bus.svg' class='bus-number-img' alt='" +
                                                        i18n._('Accessibility Bus') +
                                                        "'>" +
                                                                                                                value.Vehicles[i].BusLicence +setSeatImg(value.Vehicles[i].bSetL)+
                                                        "</p>";
                                                } else {
                                                    _html =
                                                        _html +
                                                        "<p class='bus-number'>" +
                                                                                                                value.Vehicles[i].BusLicence +setSeatImg(value.Vehicles[i].bSetL)+
                                                        "</p>";
                                                }
                                            }
                                            $(item)
                                                .find('span.auto-list-stationlist')
                                                .append(_html.concat("</span>"));
                                        }
                                        if(value.NextDepTime!='FF')
                                        {
                                           
                                            $(item).find('span.auto-list-stationlist-position').addClass('auto-list-stationlist-position-now').html('預計'+value.NextDepTime+'發車');
                                        }
                                        else{
                                            FormatETA($(item).find('span.auto-list-stationlist-position'), value.ETA);
                                        }
                                    }else
                                    {
                                        if (jsonObjArr[0].UniRouteId[9] =='0')
                                        {
                                            FormatETA($(item).find('span.auto-list-stationlist-position'), 65535);
                                        }else
                                        {
                                            FormatETA($(item).find('span.auto-list-stationlist-position'), 65529);
                                        }
                                    }

                                    return item;
                                });

                            } else {

                                //取得返程站位及站序
                                $.each( $('#BackDirectionRoute li  '), function( index, item ){
                                    var uniStopId = $(item).find('input#item_UniStopId').val();
                                    var stopSeq =parseInt($(item).find('.auto-list-stationlist-number').text().trim());
                                    backStationList.push({ stopSeq: stopSeq, uniStopId: uniStopId });
                                });

                                //取得相同站牌編號
                                $.grep(jsonObjArr,function(item) {

                                    if (($.inArray(item.UniStationId, uniStation) === -1)) {
                                        //未重複
                                        uniStation.push(item.UniStationId);
                                    } else {
                                        //有重複
                                        tempduplicate.push(item.UniStationId);
                                    }
                                });

                                //重複站排項目
                                duplicateStation = unique(tempduplicate);

                                //取得有重複的站位及公車編號
                                filterDuplicate = $.grep(jsonObjArr,function(item) {

                                    //取得有重複站位
                                    if (($.inArray(item.UniStationId, duplicateStation) !== -1)) {

                                        //確定該站位，有在站位列表中
                                        var result = $.grep(backStationList,function(e) { return e.uniStopId === item.UniStationId; });

                                        if (result && result.length > 0) {

                                            //在資料內找出該站位的進站公車，是否有重複
                                            if (item.Vehicles && item.Vehicles.length > 0) {

                                                //依據該公車編號，取得是否有重複的
                                                var busIdDuplicate = $.grep(item.Vehicles,function(value) {

                                                    var getVehicles = $.grep(jsonObjArr,function(data) {

                                                        //找出有重複的公車編號
                                                        var filterVehicles = $.grep(data.Vehicles,function(vehicles) {
                                                            return value.UniBusId === vehicles.UniBusId;
                                                        });

                                                        //若相同公車編號找尋結果，有2筆以上，則回傳該項目
                                                        if (filterVehicles && filterVehicles.length > 0) {
                                                            return data;
                                                        }
                                                    });

                                                    if (getVehicles && getVehicles.length > 0) {
                                                        return value;
                                                    }
                                                });

                                                if (busIdDuplicate && busIdDuplicate.length > 0) {
                                                    return item;
                                                }


                                            }


                                        }

                                    }
                                });

                                hasSeq = jsonObjArr[0].UniRouteId[9] =='0' ?hasSeq:false;
                                //返程
                                $('#BackDirectionRoute li').map(function(index, item) {

                                    var _UniStopId = $(item).find('input#item_UniStopId').val();

                                  if ($('.stationlist-come-go-c').length === 0)
                                    { var _StopSeq =parseInt($(item).find('.auto-list-stationlist-number').text().trim()) +objArr.BackDirStops.length;
                                    }
                                    else
                                    {
                                        var _StopSeq =parseInt($(item).find('.auto-list-stationlist-number').text().trim()) +objArr.GoDirStops.length;
                                    }

                                    var tmp = jsonObjArr.filter(function(item) {
                                        if (hasSeq) {
                                            if (item.UniStationId == _UniStopId &&
                                                item.StopSequence == (_StopSeq - 1))
                                                return true;
                                        } else {
                                            if (item.UniStationId == _UniStopId)
                                                return true;
                                        }
                                    });

                                    if (tmp && tmp.length > 0) {

                                        var value = tmp[0];

                                        //依據有重複的站位及公車編號，取得下一站位的等待時間
                                        var  filterBusId = filterDuplicate.filter(function(item) {
                                            if (item.UniStationId === value.UniStationId) {
                                                return true;
                                            }
                                            return false;
                                        }).map(function(dirItem) {

                                            var nextStation = jsonObjArr.filter(function (station) {
                                                if ( station.StopSequence ===( parseInt(dirItem.StopSequence) +1)) {

                                                    return true;
                                                }
                                                return false;
                                            });

                                            if (nextStation && nextStation.length > 0 ) {
                                                dirItem.NextETA = nextStation[0].ETA;
                                            }

                                            return dirItem;

                                        });

                                        //若公車站編號相同超過1個以上，表示有重複
                                        if (filterBusId && filterBusId.length > 1) {

                                            //車號編號
                                            var busArray= [];
                                            //重複車號編號
                                            var tempbusArray= [];

                                            //取得重複車號
                                            $.each(filterBusId , function(index, item) {
                                                $.each(item.Vehicles , function(iVehicles, vehicles) {

                                                    if (($.inArray(vehicles.UniBusId, busArray) !== -1)) {
                                                        //未重複
                                                        busArray.push(vehicles.UniBusId);
                                                    } else {
                                                        //有重複
                                                        tempbusArray.push(vehicles.UniBusId);
                                                    }
                                                });
                                            });

                                            //過濾收集重複車號項目
                                            var duplicateBus = unique(tempbusArray);

                                            if (duplicateBus.length > 0 ) {

                                                //依進站時間排序
                                                filterBusId.sort(function (a, b) {
                                                    if (a.NextETA> b.NextETA) {
                                                        return 1;
                                                    }
                                                    if (a.ETA< b.ETA) {
                                                        return -1;
                                                    }
                                                    // a must be equal to b
                                                    return 0;
                                                });

                                                for (var i = 0; i < filterBusId.length; i++) {

                                                    if (i !==0) {
                                                        filterBusId[i].Vehicles =  $.grep(filterBusId[i].Vehicles, function(iVehicles, vehicles) {

                                                            if (($.inArray(vehicles.UniBusId, duplicateBus) === -1)) {
                                                                //未重複
                                                                return vehicles;
                                                            }

                                                        });
                                                    }
                                                }

                                            }
                                        }


                                        if (value.Vehicles.length > 0) {
                                            var _html = "<span class='auto-list-stationlist-bus'>";
                                            for (var i = 0; i < value.Vehicles.length; i++) {
                                                var dogimg=""
                                                if($('#doglink').attr('dognum')!=null)
                                                { if (value.Vehicles[i].BusLicence.indexOf($('#doglink').attr('dognum')) > -1) {
                                                    value.Vehicles[i].BusLicence=value.Vehicles[i].BusLicence.replace($('#doglink').attr('dognum'), '');
                                                    dogimg="<img src='" +
                                                        SitePath +
                                                        "images/stationlist_dogwhite_bus.png' class='bus-number-img' alt=''>";
                                                }
                                                }
                                                if (value.Vehicles[i].BusType == 2) {
                                                    _html =
                                                        _html +
                                                        "<p class='bus-number'><img src='" +
                                                        SitePath +
                                                        "images/stationlist_accessibility_bus.svg' class='bus-number-img' alt='" +
                                                        i18n._('Accessibility Bus') +
                                                       "'>" +
                                                                                                               value.Vehicles[i].BusLicence +setSeatImg(value.Vehicles[i].bSetL)+
                                                        "</p>";
                                                } else {
                                                    _html =
                                                        _html +
                                                        "<p class='bus-number'>" +
                                                                                                                value.Vehicles[i].BusLicence +setSeatImg(value.Vehicles[i].bSetL)+
                                                        "</p>";
                                                }
                                            }
                                            $(item)
                                                .find('span.auto-list-stationlist')
                                                .append(_html.concat("</span>"));
                                        }

                                        //轉為時間
                                        if(value.NextDepTime!='FF')
                                        {
                                            $(item).find('span.auto-list-stationlist-position').addClass('auto-list-stationlist-position-now').html('預計'+value.NextDepTime+'發車');
                                        }
                                        else{
                                            FormatETA($(item).find('span.auto-list-stationlist-position'), value.ETA);
                                        }
                                    }else{
                                        //if( jsonObjArr[0].UniRouteId[9] !='0')
                                        //    FormatETA($(item).find('span.auto-list-stationlist-position'), 65529);
                                        if (jsonObjArr[0].UniRouteId[9] =='0')
                                        {
                                            FormatETA($(item).find('span.auto-list-stationlist-position'), 65535);
                                        }else
                                        {
                                            FormatETA($(item).find('span.auto-list-stationlist-position'), 65529);
                                        }
                                    }

                                    return item;
                                });
                            }

                        }
                        else{
                            //去程
                            $('#GoDirectionRoute li').map(function(index, item) {
                                FormatETA($(item).find('span.auto-list-stationlist-position'), 65529);
                                return item;
                            });

                            //返程
                            $('#BackDirectionRoute li').map(function(index, item) {
                                FormatETA($(item).find('span.auto-list-stationlist-position'), 65529);
                                return item;
                            });
                        }

                    }

                });
                if (stopFetchInterval === null) {
                    stopFetchInterval = window.setInterval(startFatch, 1000 * 15);
                }
            })();

        }

        function setSeatImg(lv)
        {
            var s = '';
            if (lv>-1)
            {
                //s = '<img src=\"../images/seats/seat'+lv+'.png\" class="bus-number-img" >';
                s = '&ensp;<img width="20px" src=\"../images/seats/people'+lv+'_B.svg\" class="bus-number-img" >';
            }
            return s;
        }

        function stopStationStatusReport() {
            clearInterval(stopFetchInterval);
            stopFetchInterval = null;
        }

        function shownewchart(_id) {

            AptsBusMap.init({
                AptsSpringWebHome: SitePath,
                uniRouteId: _id,
                goBack: 0
            });
            AptsBusMap.load('myMap');

            $('.route-list').hide();
            $('.route-chart').show();

        }

        function hidenewchart() {
            $('.route-list').show();
            $('.route-chart').hide();
            //clearInterval(AptsBusMap.......interval);//沒有停止方法
        }

        function toggleRouteListAndChart() {
            if ($('.route-chart').is(":visible")) {
                $('.route-list').toggle();
                $('.route-chart').toggle();
                google.maps.event.trigger(map, "resize");
                $('.route-chart').html('');
                busStatusReport();
                stationStatusReport();
            } else {
                stopBusStatusReport();
                stopStationStatusReport();
                $('.route-chart')
                    .html('<button onclick="toggleRouteListAndChart()">back</button><div id="myMap" class="left" style="width:900px;margin-top:30px;"></div>');
                shownewchart('0463001300');

            }
        }

        function FormatETA(elem, eta) {
            if (eta < 0) {
                elem.addClass('auto-list-stationlist-position-none').html(ConvertETA(eta));
                return;
            }
            if (eta >= 0 && eta <= 180) {
                elem.addClass('auto-list-stationlist-position-now').html(ConvertETA(eta));
                return;
            }
            if ( eta === 65535 ||
                 eta === 65529 ||
                 eta === 65534 ||
                eta === 65532 ||
                eta === 65533 ||
                eta === 65531 ||
                eta === 65530
               ) {
                elem.addClass('auto-list-stationlist-position-none').html(ConvertETA(eta));
                return;
            }
            elem.addClass('auto-list-stationlist-position-time').html(ConvertETA(eta) + i18n._('Mins'));
        }


        function addToMyBus(routeid, stopid, groupid) {
            $.ajax({
                url: '/MyBus/NewContentOfGroup',
                type: 'post',
                dataType: 'html',
                data: {
                    '__RequestVerificationToken': $('input[name=__RequestVerificationToken]').val(),
                    'X-Requested-With': 'XMLHttpRequest',
                    'unirouteid': routeid,
                    'unistationid': stopid,
                    'groupid': groupid
                },
                beforeSend: function() {
                    $('#ProcessIconSpan').show();
                },
                error: function(response) {
                    toastr["warning"](i18n._('Added Failure'), "");
                },
                success: function(response) {
                    toastr["info"](i18n._('Added Success'), "");
                },
                complete: function() {
                    $('#ProcessIconSpan').hide();
                }
            });
        }

        var routeJsonString = JSON.stringify({"UniRouteId":"0463001300","Name":"林口-板橋","BeginStop":"林口站","GoDirStops":[{"UniStopId":"2444601100","Name":"林口站","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.3690155,"Latitude":25.080542,"PublicId":"2444601100"},{"UniStopId":"2445900600","Name":"未來之丘","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.3736201,"Latitude":25.079054,"PublicId":"2445900600"},{"UniStopId":"2445900240","Name":"文化三路中山路口","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.377965,"Latitude":25.083582,"PublicId":"2445900240"},{"UniStopId":"2444601820","Name":"春城麗池","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.3805347,"Latitude":25.081946,"PublicId":"2444601820"},{"UniStopId":"2445700160","Name":"馥都社區","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.3805499,"Latitude":25.077511,"PublicId":"2445700160"},{"UniStopId":"2444700860","Name":"林口國中","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.3780103,"Latitude":25.074898,"PublicId":"2444700860"},{"UniStopId":"2444802360","Name":"空間樂園社區","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.373143,"Latitude":25.07574,"PublicId":"2444802360"},{"UniStopId":"2444801140","Name":"世貿芳鄰","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.3708094,"Latitude":25.073744,"PublicId":"2444801140"},{"UniStopId":"2444801240","Name":"林口三井","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.3670383,"Latitude":25.070496,"PublicId":"2444801240"},{"UniStopId":"2444801640","Name":"安敦新世界","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.364914,"Latitude":25.068083,"PublicId":"2444801640"},{"UniStopId":"2425001140","Name":"昌平街口","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.454573,"Latitude":25.059899,"PublicId":"2425001140"},{"UniStopId":"2425002540","Name":"頭前國中","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.45958,"Latitude":25.0553,"PublicId":"2425002540"},{"UniStopId":"2425001040","Name":"捷運幸福站","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.459672,"Latitude":25.050278,"PublicId":"2425001040"},{"UniStopId":"2421300040","Name":"臺北醫院","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.45976,"Latitude":25.04304,"PublicId":"2421300040"},{"UniStopId":"2421500040","Name":"捷運頭前庄站(思源路)","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.459856,"Latitude":25.040005,"PublicId":"2421500040"},{"UniStopId":"2204700240","Name":"捷運新埔站","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.467161,"Latitude":25.023861,"PublicId":"2204700240"},{"UniStopId":"2205000340","Name":"致理科技大學","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.466622,"Latitude":25.020964,"PublicId":"2205000340"},{"UniStopId":"2205000260","Name":"板橋車站(文化路)","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.462646,"Latitude":25.016025,"PublicId":"2205000260"},{"UniStopId":"2205000560","Name":"萬坪公園","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.460677,"Latitude":25.01352,"PublicId":"2205000560"},{"UniStopId":"2205500420","Name":"捷運府中站(府中路)","Name_TW":null,"Name_EN":null,"StopOrder":0,"RoutesNumber":null,"BusETA":0,"BType":0,"BLicense":null,"Longitude":121.458454,"Latitude":25.009036,"PublicId":"2205500420"}],"LastStop":"捷運府中站","BackDirStops":null,"RouteMapUrl":"../MapOverview?nid=0463001300","RouteTracks":null,"StopDirection":null,"TicketPrice":"二段票","BusTimeDesc":"0645 - 0645","HeadwayDesc":"班表:0645","HolidayBusTimeDesc":"停駛","HolidayHeadwayDesc":"","RouteNote":"","SegmentBuffer":"國道1號","StopLng":0,"StopLat":0,"IsNtpcMainLine":true,"orgphone":"臺北客運林口站:02-2609-5110","aliasName":null,"aliasEname":null,"memo":null,"memoEn":null,"showBusTimeDesc":true,"RouteStatus":1,"wkt":"LINESTRING (121.368732393134 25.0804859852926, 121.369043481632 25.0807970737905, 121.370720069161 25.0795377636214, 121.372741396588 25.0780406502255, 121.373904921765 25.0796010992123, 121.374454721391 25.0802969705488, 121.37514549528 25.0812290488939, 121.37554727193 25.0817142375526, 121.376160509974 25.0825186250394, 121.376541140485 25.0830357284897, 121.377092702289 25.0837251963587, 121.377365098949 25.0841023890799, 121.378476342958 25.0833261634531, 121.379642177016 25.0825663896219, 121.381279878483 25.0816974356928, 121.382907110626 25.080800065026, 121.381623870572 25.0787735029368, 121.380846897136 25.0777235792566, 121.379923353158 25.0766168221008, 121.3786229135 25.0753679812562, 121.377663648054 25.0745638942658, 121.376546248216 25.0754278059673, 121.375457400837 25.0762685229398, 121.374787773088 25.0767473469499, 121.37453763354 25.0769353886876, 121.373429380766 25.0759602458963, 121.372469194153 25.075038945345, 121.371868703615 25.0745424002427, 121.37091599509 25.0737332710248, 121.36960359049 25.0726594174601, 121.368551424125 25.0717355628825, 121.367777441183 25.0711024793532, 121.366701344192 25.0701258409441, 121.366098471948 25.0695073280504, 121.365723957974 25.069075917264, 121.365359027236 25.0686272319305, 121.364967175378 25.0680125330238, 121.364650852218 25.0673753998503, 121.364059335387 25.0659231549878, 121.363921738551 25.06551784257, 121.363876870018 25.0649300647832, 121.363858922604 25.0642839579031, 121.366782855361 25.0644574495654, 121.368606013432 25.0644724057431, 121.369238659752 25.0646802966143, 121.371127625006 25.0651693636277, 121.372729431646 25.0655118600989, 121.373868344584 25.0657122728811, 121.375735825007 25.065912697593, 121.376909683336 25.0658902513967, 121.377765176705 25.0657795756812, 121.380678640136 25.064823875921, 121.381676217194 25.0645471866321, 121.38227147307 25.0644454846231, 121.382806156426 25.0644215547387, 121.38355022627 25.0644514670943, 121.385833106599 25.0647761850218, 121.386634937937 25.0648792137788, 121.387623541289 25.064918099841, 121.388831252644 25.0648522926588, 121.390035972765 25.0646399149343, 121.39057065612 25.0645008224809, 121.391140787603 25.0642909292514, 121.391771637196 25.0639698781697, 121.392336980716 25.0636408422586, 121.393027208321 25.063118871654, 121.393727157441 25.062532589485, 121.394070401721 25.062155693805, 121.395525637819 25.0606211899647, 121.396589769868 25.05930504632, 121.397546217437 25.058078639742, 121.398279070148 25.0573024141152, 121.399016409713 25.056704167004, 121.399737297482 25.0562435167284, 121.400586063229 25.055836954553, 121.401634488633 25.055491220986, 121.402618605131 25.0553356767371, 121.403144746104 25.0552878091361, 121.404049163536 25.0553267030304, 121.405006358914 25.0554613086304, 121.406380831652 25.0558800816083, 121.407683514737 25.0565605876973, 121.409906750564 25.0579245911109, 121.413411196812 25.060051244454, 121.418543195423 25.0632564684896, 121.420506193757 25.0644828750676, 121.424222056126 25.0667831352102, 121.425841602458 25.0674833661509, 121.426915663744 25.0677717385615, 121.428160765545 25.0680170198771, 121.432166029954 25.0681964940105, 121.433211032059 25.0681856911037, 121.433774929112 25.0681729215951, 121.434515043993 25.0681984606111, 121.435366651999 25.0682563187216, 121.436215546041 25.0682814623762, 121.436526503586 25.0682682836638, 121.436777767373 25.0681755553616, 121.437082125591 25.0679900987571, 121.437329650333 25.0677283656459, 121.43750015076 25.0673753998503, 121.437706546013 25.0664211957079, 121.437892002617 25.0656150577256, 121.438390791146 25.0647640512099, 121.439021941849 25.0635989649608, 121.440261507391 25.0615709073789, 121.44042715215 25.0612963478253, 121.440806213858 25.0606181987291, 121.441099354942 25.0603669349424, 121.441947370222 25.0589505849066, 121.442799872356 25.0579111305509, 121.443140906714 25.0576695499392, 121.443535634651 25.0576248528168, 121.444015061801 25.0577391345064, 121.445214547259 25.0584031887999, 121.446332521548 25.0590537825333, 121.447653899855 25.0597911220979, 121.448286546175 25.0600393946491, 121.4507199163 25.0603609524713, 121.451445290922 25.0603908648269, 121.452316569062 25.0604024287372, 121.454648293494 25.0603548547017, 121.454620375295 25.0587635173856, 121.459717191414 25.0586980841077, 121.459717191414 25.0574051225383, 121.459718300661 25.0544039068614, 121.459742230546 25.0525433583455, 121.459760177959 25.0494773419005, 121.459763169195 25.046954234709, 121.45976616043 25.0446599570375, 121.459775754859 25.0428305232633, 121.459834958848 25.0413561373658, 121.459939652092 25.0400115769833, 121.460032380395 25.0396122470366, 121.460475083257 25.0385264285297, 121.461000792906 25.0372222498273, 121.461484625257 25.0360810934626, 121.462043986306 25.0346423091601, 121.462688597568 25.0332468977732, 121.463558299306 25.0314596345285, 121.464775732178 25.0290546811414, 121.465280503178 25.0279509152212, 121.465355284067 25.0276398267233, 121.466249663498 25.0258002168564, 121.466380530053 25.0256371945185, 121.466892031334 25.0246067138695, 121.467382593965 25.0237228037627, 121.467621892809 25.0234281670604, 121.467759489645 25.0229361088114, 121.467705672054 25.0226475524214, 121.467007849452 25.0214148309845, 121.465948296516 25.0199732899931, 121.464884164467 25.0186721025262, 121.463954638017 25.017487573246, 121.462639989991 25.0158603411035, 121.461365723644 25.0142764818765, 121.460293365697 25.0129543557608, 121.460185681217 25.0127120656807, 121.459620337697 25.0120136121784, 121.458362523145 25.0107393458315, 121.458037974088 25.0104626565425, 121.457871960514 25.0100266839602, 121.457747824239 25.0095241563868, 121.458085833856 25.009374594609, 121.458607804461 25.0090201331956)","wkt0":"LINESTRING (121.368732393134 25.0804859852926, 121.369043481632 25.0807970737905, 121.370720069161 25.0795377636214, 121.372741396588 25.0780406502255, 121.373904921765 25.0796010992123, 121.374454721391 25.0802969705488, 121.37514549528 25.0812290488939, 121.37554727193 25.0817142375526, 121.376160509974 25.0825186250394, 121.376541140485 25.0830357284897, 121.377092702289 25.0837251963587, 121.377365098949 25.0841023890799, 121.378476342958 25.0833261634531, 121.379642177016 25.0825663896219, 121.381279878483 25.0816974356928, 121.382907110626 25.080800065026, 121.381623870572 25.0787735029368, 121.380846897136 25.0777235792566, 121.379923353158 25.0766168221008, 121.3786229135 25.0753679812562, 121.377663648054 25.0745638942658, 121.376546248216 25.0754278059673, 121.375457400837 25.0762685229398, 121.374787773088 25.0767473469499, 121.37453763354 25.0769353886876, 121.373429380766 25.0759602458963, 121.372469194153 25.075038945345, 121.371868703615 25.0745424002427, 121.37091599509 25.0737332710248, 121.36960359049 25.0726594174601, 121.368551424125 25.0717355628825, 121.367777441183 25.0711024793532, 121.366701344192 25.0701258409441, 121.366098471948 25.0695073280504, 121.365723957974 25.069075917264, 121.365359027236 25.0686272319305, 121.364967175378 25.0680125330238, 121.364650852218 25.0673753998503, 121.364059335387 25.0659231549878, 121.363921738551 25.06551784257, 121.363876870018 25.0649300647832, 121.363858922604 25.0642839579031, 121.366782855361 25.0644574495654, 121.368606013432 25.0644724057431, 121.369238659752 25.0646802966143, 121.371127625006 25.0651693636277, 121.372729431646 25.0655118600989, 121.373868344584 25.0657122728811, 121.375735825007 25.065912697593, 121.376909683336 25.0658902513967, 121.377765176705 25.0657795756812, 121.380678640136 25.064823875921, 121.381676217194 25.0645471866321, 121.38227147307 25.0644454846231, 121.382806156426 25.0644215547387, 121.38355022627 25.0644514670943, 121.385833106599 25.0647761850218, 121.386634937937 25.0648792137788, 121.387623541289 25.064918099841, 121.388831252644 25.0648522926588, 121.390035972765 25.0646399149343, 121.39057065612 25.0645008224809, 121.391140787603 25.0642909292514, 121.391771637196 25.0639698781697, 121.392336980716 25.0636408422586, 121.393027208321 25.063118871654, 121.393727157441 25.062532589485, 121.394070401721 25.062155693805, 121.395525637819 25.0606211899647, 121.396589769868 25.05930504632, 121.397546217437 25.058078639742, 121.398279070148 25.0573024141152, 121.399016409713 25.056704167004, 121.399737297482 25.0562435167284, 121.400586063229 25.055836954553, 121.401634488633 25.055491220986, 121.402618605131 25.0553356767371, 121.403144746104 25.0552878091361, 121.404049163536 25.0553267030304, 121.405006358914 25.0554613086304, 121.406380831652 25.0558800816083, 121.407683514737 25.0565605876973, 121.409906750564 25.0579245911109, 121.413411196812 25.060051244454, 121.418543195423 25.0632564684896, 121.420506193757 25.0644828750676, 121.424222056126 25.0667831352102, 121.425841602458 25.0674833661509, 121.426915663744 25.0677717385615, 121.428160765545 25.0680170198771, 121.432166029954 25.0681964940105, 121.433211032059 25.0681856911037, 121.433774929112 25.0681729215951, 121.434515043993 25.0681984606111, 121.435366651999 25.0682563187216, 121.436215546041 25.0682814623762, 121.436526503586 25.0682682836638, 121.436777767373 25.0681755553616, 121.437082125591 25.0679900987571, 121.437329650333 25.0677283656459, 121.43750015076 25.0673753998503, 121.437706546013 25.0664211957079, 121.437892002617 25.0656150577256, 121.438390791146 25.0647640512099, 121.439021941849 25.0635989649608, 121.440261507391 25.0615709073789, 121.44042715215 25.0612963478253, 121.440806213858 25.0606181987291, 121.441099354942 25.0603669349424, 121.441947370222 25.0589505849066, 121.442799872356 25.0579111305509, 121.443140906714 25.0576695499392, 121.443535634651 25.0576248528168, 121.444015061801 25.0577391345064, 121.445214547259 25.0584031887999, 121.446332521548 25.0590537825333, 121.447653899855 25.0597911220979, 121.448286546175 25.0600393946491, 121.4507199163 25.0603609524713, 121.451445290922 25.0603908648269, 121.452316569062 25.0604024287372, 121.454648293494 25.0603548547017, 121.454620375295 25.0587635173856, 121.459717191414 25.0586980841077, 121.459717191414 25.0574051225383, 121.459718300661 25.0544039068614, 121.459742230546 25.0525433583455, 121.459760177959 25.0494773419005, 121.459763169195 25.046954234709, 121.45976616043 25.0446599570375, 121.459775754859 25.0428305232633, 121.459834958848 25.0413561373658, 121.459939652092 25.0400115769833, 121.460032380395 25.0396122470366, 121.460475083257 25.0385264285297, 121.461000792906 25.0372222498273, 121.461484625257 25.0360810934626, 121.462043986306 25.0346423091601, 121.462688597568 25.0332468977732, 121.463558299306 25.0314596345285, 121.464775732178 25.0290546811414, 121.465280503178 25.0279509152212, 121.465355284067 25.0276398267233, 121.466249663498 25.0258002168564, 121.466380530053 25.0256371945185, 121.466892031334 25.0246067138695, 121.467382593965 25.0237228037627, 121.467621892809 25.0234281670604, 121.467759489645 25.0229361088114, 121.467705672054 25.0226475524214, 121.467007849452 25.0214148309845, 121.465948296516 25.0199732899931, 121.464884164467 25.0186721025262, 121.463954638017 25.017487573246, 121.462639989991 25.0158603411035, 121.461365723644 25.0142764818765, 121.460293365697 25.0129543557608, 121.460185681217 25.0127120656807, 121.459620337697 25.0120136121784, 121.458362523145 25.0107393458315, 121.458037974088 25.0104626565425, 121.457871960514 25.0100266839602, 121.457747824239 25.0095241563868, 121.458085833856 25.009374594609, 121.458607804461 25.0090201331956)","wkt1":null,"CustomRouteInfo":null,"CustomRouteInfoEN":null});
        var objArr = jQuery.parseJSON(routeJsonString);
        var TrackObj=null;
        var layerWkt=null;
        var layerWkt0=null;
        var layerWkt1=null;

        $(function() {
            // Configure toastr options
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": true,
                "progressBar": true,
                "positionClass": "toast-top-right",
                "preventDuplicates": false,
                "onclick": null,
                "showDuration": "300",
                "hideDuration": "1000",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            }

            // Init Map
            initialize();
            //// 畫去程的站點
            pointRouteStopsLMap(true);
            //// 畫路線軌跡
            //drawRouteTrack();

            //var routePathBounds = new google.maps.LatLngBounds();
            //var path = new google.maps.MVCArray();

            if ((objArr.wkt != null && objArr.wkt.length != 0)||(objArr.wkt0 != null && objArr.wkt0.length != 0)) {
                var latlngs = [];
                //for (var i = 0; i < objArr.RouteTracks.length; i++) {
                //    var pointA = [objArr.RouteTracks[i]
                //        .Latitude,
                //        objArr.RouteTracks[i].Longitude];
                //    latlngs.push(pointA);
                //}
                if (TrackObj != null)
                {
                    map.removeLayer(TrackObj);
                }
                var wkt = new Wkt.Wkt();
                if (objArr.wkt0==null)
                {
                    wkt.read(objArr.wkt);}
                else{
                    wkt.read(objArr.wkt0);
                }

                if( map==null)
                {}
                else{
                    //map.defaults.color = '#9863b6';
                    TrackObj= wkt.toObject({
                        color: '#9863b6',
                        strokeColor: '#9863b6',
                        strokeOpacity: 0.8,
                        strokeWeight: 2,
                        fillColor: '#9863b6',
                        fillOpacity: 0.35,
                        editable: false
                    }); // Make an object
                    TrackObj.addTo(map);

                    //var firstpolyline = L.polyline(latlngs ,{ color: '#9863b6',
                    //    weight: 4,
                    //    opacity: 1.0,
                    //    smoothFactor: 1}).addTo(map);
                    //map.fitBounds(firstpolyline.getBounds());
                    //routePath=firstpolyline;

                }
            }

            $('.stationlist-go, .stationlist-come')
                .click(function() {
                    if ($(this).hasClass('stationlist-go')) {
                        if ($(this).hasClass('stationlist-come-go')) {
                            event.preventDefault();
                        } else {
                            $('.stationlist-go, .stationlist-come').toggleClass('stationlist-come-go-gray');
                            $('.stationlist-go, .stationlist-come').toggleClass('stationlist-come-go');

                            $('#GoDirectionRoute').toggle("left");
                            $('#BackDirectionRoute').toggle("left");

                            pointRouteStopsLMap(true);

                            TrackObj.setStyle({
                                color: '#9863b6'
                            });
                            TrackObj.options.color="#9863b6";
                            if ((objArr.wkt != null && objArr.wkt.length != 0)||(objArr.wkt0 != null && objArr.wkt0.length != 0)){ if( map==null)
                            {}
                            else{
                                if( map==null)
                                {}
                                else{
                                    if (TrackObj != null)
                                    {
                                        map.removeLayer(TrackObj);
                                    }
                                    var wkt = new Wkt.Wkt();
                                    if (objArr.wkt0==null)
                                    {
                                        wkt.read(objArr.wkt);}
                                    else{
                                        wkt.read(objArr.wkt0);
                                    }
                                    TrackObj= wkt.toObject({
                                        color: '#9863b6',
                                        strokeColor: '#9863b6',
                                        strokeOpacity: 0.8,
                                        strokeWeight: 2,
                                        fillColor: '#9863b6',
                                        fillOpacity: 0.35,
                                        editable: false
                                    }); // Make an object
                                    TrackObj.setStyle({
                                        color: '#9863b6'
                                    });
                                    TrackObj.options.color="#9863b6";
                                    TrackObj.addTo(map);
                                }



                            }
                            }
                            stopStationStatusReport();
                            stationStatusReport();
                            stopBusStatusReport();
                            busStatusReport();


                        }

                    }
                    if ($(this).hasClass('stationlist-come')) {
                        if ($(this).hasClass('stationlist-come-go')) {
                            event.preventDefault();
                        } else {
                            $('.stationlist-go, .stationlist-come').toggleClass('stationlist-come-go-gray');
                            $('.stationlist-go, .stationlist-come').toggleClass('stationlist-come-go');

                            $('#GoDirectionRoute').toggle("right");
                            $('#BackDirectionRoute').toggle("right");
                            pointRouteStopsLMap(false);

                            TrackObj.setStyle({
                                color: '#916955'
                            });
                            TrackObj.options.color="#916955";
                            if ((objArr.wkt != null && objArr.wkt.length != 0)||(objArr.wkt1 != null && objArr.wkt1.length != 0)) {if( map==null)
                            {}
                            else{
                                if (TrackObj != null)
                                {
                                    map.removeLayer(TrackObj);
                                }
                                var wkt = new Wkt.Wkt();
                                if (objArr.wkt1==null)
                                {
                                    wkt.read(objArr.wkt);}
                                else{
                                    wkt.read(objArr.wkt1);
                                }
                                TrackObj= wkt.toObject({
                                    color: '#9863b6',
                                    strokeColor: '#9863b6',
                                    strokeOpacity: 0.8,
                                    strokeWeight: 2,
                                    fillColor: '#9863b6',
                                    fillOpacity: 0.35,
                                    editable: false
                                }); // Make an object
                                TrackObj.setStyle({
                                    color: '#916955'
                                });
                                TrackObj.options.color="#916955";
                                TrackObj.addTo(map);
                            }}

                            stopStationStatusReport();
                            stationStatusReport();
                            stopBusStatusReport();
                            busStatusReport();
                        }

                    }
                });

            $('.stationlist-list-pool li a')
                .click(function() {
                    var idx = $(this).find('.auto-list-stationlist-number').text();
                    var activedMarker = overlays[(parseInt(idx) - 1)];
                    map.flyTo(activedMarker._latlng);
                    activedMarker.openPopup();
                    //google.maps.event.trigger(activedMarker, 'click');
                    //centerMapTo(activedMarker.getPosition().lat(), activedMarker.getPosition().lng());

                    var stopId = $(this).find('input[name="item.UniStopId"]').val();
                    document.getElementById("routeList").href = SitePath + "Stop/RoutesOfStop?stopid=" + stopId;
                    if('0463001300'=='0100020200' || '0463001300'=='0100027700')
                    {
                        stopStatusRecent3Report(stopId);//vic
                    }
                    //Set value to bus arrival alert dialog
                    $('#selected_stop_id').val(stopId);
                    $('#selected_stop_name').val($(this).find('.auto-list-stationlist-place').text());

                    $("#Toolbar")
                        .dialog({
                            autoOpen: true,
                            width: $('#Login_DL').width(),
                            modal: true,
                            show: {
                                effect: "clip",
                                duration: 600
                            },
                            buttons: {},
                            hide: {
                                effect: "clip",
                                duration: 500
                            }
                        });
                    $(".ui-dialog-titlebar").hide();
                });

            $('#busAlert')
                .click(function() {
                    $("#Toolbar").dialog("close");
                    $("#Toolbar").dialog("destroy");
                    $("#Toolbar").hide();

                    $("#SetAlertTime")
                        .dialog({
                            autoOpen: true,
                            width: 500,
                            modal: true,
                            show: {
                                effect: "clip",
                                duration: 600
                            },
                            buttons: {},
                            hide: {
                                effect: "clip",
                                duration: 500
                            }
                        });
                    $(".ui-dialog-titlebar").hide();
                });


            $('#addToMybus')
                .click(function() {
                    $("#Toolbar").dialog("close");
                    $("#Toolbar").dialog("destroy");
                    $("#Toolbar").hide();
                    var isSuccess = true;
                    $('#AddToMyBus').find('ul').html('');
                    $.ajax({
                        url: '/MyBus/MyBusGroup',
                        type: 'post',
                        dataType: 'json',
                        beforeSend: function() {
                        },
                        error: function(response) {
                            isSuccess = false;
                            toastr["error"](i18n._('Not log in'), "");
                        },
                        success: function(response) {
                            $.each(response,
                                function(idx, value) {
                                    $('#AddToMyBus')
                                        .find('ul')
                                        .append(
                                            $('<li></li>')
                                            .append($('<a>')
                                                .attr({ href: "javascript:AddMyBus('" + value.GroupId + "');" })
                                                .addClass('dialog-chose-bos-group')
                                                .append(value.GroupName))
                                        );
                                });
                        },
                        complete: function() {
                            if (isSuccess) {
                                $("#AddToMyBus")
                                    .dialog({
                                        autoOpen: true,
                                        modal: true,
                                        width: $('#Login_DL').width(),
                                        show: {
                                            effect: "clip",
                                            duration: 600
                                        },
                                        buttons: {},
                                        hide: {
                                            effect: "clip",
                                            duration: 500
                                        }
                                    });
                                $(".ui-dialog-titlebar").hide();
                            }
                        }
                    });
                });

            //$('.stationlist-move-table-icon')
            //    .click(function() {
            //        toggleRouteListAndChart();
            //    });

            $('.stationlist-bus-info-table-icon')
                .click(function() {
                    $('.stationlist-move-route-bus-info').slideToggle();
                });

            stationStatusReport();
            busStatusReport();


        });

        function AddMyBus(gid) {
            var RouteId = objArr.UniRouteId;
            var StopId = $('#selected_stop_id').val();
            $('#AddToMyBus').dialog("close");
            $('#AddToMyBus').dialog("destroy");
            $('#AddToMyBus').hide();
            addToMyBus(RouteId, StopId, gid);

        }

        function setAlertConfirm(stime) {
            var RouteId = objArr.UniRouteId;
            var RouteName = objArr.Name;
            var StopId = $('#selected_stop_id').val();
            var StopName = $('#selected_stop_name').val();
            var direction = $('.stationlist-back').hasClass('stationlist-come-go') ? 0 : 1;
            $('#SetAlertTime').dialog("close");
            $('#SetAlertTime').dialog("destroy");
            $('#SetAlertTime').hide();
            AlertAdd(RouteId, RouteName, StopId, StopName, direction, stime);
        }
    </script>


    <script>
       
        $(function () {
            window.alert = sweetAlert;

            // Selected language radio button
            $('input[name=culture]').click(function () {
                $('.teBUS-pad-main-nav-icon').slideToggle({
                    complete: function () {
                        $('#SetCultureForm').submit();
                    }
                })
            });
            $('#Loading_DL').show();
            $('#Loading_DL').dialog({
                autoOpen: false,
                modal: true,
                width: $('#Loading_DL').width(),
                minHeight: 60,
                show: false,
                buttons: {},
                hide: false
            });
            $(".ui-dialog-titlebar").hide();

            // Scroll to Top Action
            $('a.tebus-up').click(function () {
                $('body, html').animate({
                    scrollTop: 0
                }, 700);
                return false;
            });
        });

        function OpenLoadingDialog() {
            if ($('#Loading_DL').dialog("instance") !== undefined) {
                $('#Loading_DL').dialog("open");
            }
        }

        function CloseLoadingDialog() {
            $('#Loading_DL').dialog("close");
        }

        function toggleMenu() {
            $('.teBUS-pad-main-nav-icon').slideToggle();
        }

        function goTop() {
            window.document.body.scrollTop = 0;
        }

        //$(".nav-language-link").click(function () {
        //    href = $(this).attr('href');
        //    lang = href.match('(^|/?)?culture=([^&]*)(&|$)');

        //    localStorage["culture"] = lang[2];
        //});
    </script>
</body>


</html>
